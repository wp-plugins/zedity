/***
Copyright (C) 2013  Zuyoy LLC â€“ http://zuyoy.com/ 

This file is part of the Zedity library, available at http://zedity.com/

The library is distributed under the terms of the Zedity free License, which is
available at http://zedity.com/license/free/, and WITHOUT ANY WARRANTY; without
even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
***/

var Zedity=Zedity||{};(function($){Zedity=function(options){this.$container=null;this.$this=null;this._options=$.extend({container:'#Editor,#editor',width:800,height:550,minWidth:150,minHeight:150,maxWidth:3000,maxHeight:10000,maxTotalBoxes:undefined,content:'',undoSteps:5,resizable:true,snapBoxes:false,snapPage:false,menu:true,onchange:null,onselect:null,onerror:null},options);for(var i=Zedity.requires.length-1;i>=0;--i){if(Zedity.core.supports.hasOwnProperty(Zedity.requires[i])&&!Zedity.core.supports[Zedity.requires[i]]())throw new Error('Browser does not support required feature "'+Zedity.requires[i]+'"')}this.$container=$(this._options.container);if(this.$container.length==0)throw new Error('Could not initialize Zedity. Container not found.');this.$container.data('zedity-editor',this);this.boxes.editor=this;this.propbars.editor=this;Zedity.editors.push(this);this._data={};this.editor=this;this._data.internal=0;this._data.locked=0;this._data.lockmessage=[];if(!Zedity.Page)throw new Error('Zedity needs Zedity.Page.');this.page=new Zedity.Page({editor:this,width:this._options.width,height:this._options.height,minWidth:this._options.minWidth,minHeight:this._options.minHeight,maxWidth:this._options.maxWidth,maxHeight:this._options.maxHeight,content:this._options.content});if('Menu'in Zedity&&this._options.menu){this.menu=new Zedity.Menu({editor:this})}this.contextMenu=new Zedity.ContextMenu({editor:this});this.$container.append($('<div/>',{'class':'zedity-lock'}));this.init();this._changed();this.step=0;Zedity.core.keys._bind();Zedity.core.shortcuts.add('ctrl+z meta+z',this,function(event){this.undo()},true);Zedity.core.shortcuts.add('ctrl+y meta+y',this,function(event){this.redo()},true)};$.extend(Zedity.prototype,{_changed:function(){if(this._data.internal)return this;if(this._data.undoing||this._data.savingundo)return this;this.page._saveUndo();if(this.menu)this.menu.refresh();if(typeof(this._options.onchange)=='function')this._options.onchange.call(this);return this},element:function(){this.$this=this.$container.find('.zedity-editor');return this.$this},options:function(options){this._options=$.extend(this._options,options);return this._options},_error:function(error){if(this._data.internal>0)return;error=$.extend({code:0,type:'ERROR',message:'Zedity error.'},error);if(window.console)window.console.log(error);if(typeof(this._options.onerror)=='function'){this._options.onerror.call(this,error)}else{if(error.type=='ERROR')alert(error.message)}},_getSnap:function(){var snap=[];if(this._options.snapPage)snap.push('.zedity-editor');if(this._options.snapBoxes)snap.push('.zedity-box');return snap.join(',')},boxes:{$selected:null,_boxes:[],_getFromId:function(id){for(var i=this._boxes.length-1;i>=0;--i){if(this._boxes[i].id==id||'#'+this._boxes[i].id==id){return this._boxes[i]}}},_select:function(box){if(box!=null&&box.$this.hasClass('zedity-selected')){if(box.asBackground())this._select(null);return box}var multiselect=Zedity.core.keys.ctrl||Zedity.core.keys.meta;this.editor.$this.children('.zedity-box').each(function(idx,elem){var $elem=$(this);$elem.box().stop();if(!multiselect)$elem.removeClass('zedity-selected');if($elem.data('ui-resizable'))$elem.resizable('destroy');if(!multiselect&&$elem.data('ui-draggable'))$elem.draggable('destroy')});this.editor.boxes.$selected=!box||multiselect?null:box.$this;if(box){box.$this.addClass('zedity-selected');if(!box.asBackground()){box.$this.multiDraggable({group:'.zedity-editor .zedity-selected:not(.zedity-background)',cursor:'move',reposition:true,snapFeedback:true,snapTolerance:12,snap:this.editor._getSnap(),startNative:function(){$(this).editor().propbars.hideall()},dragNative:function(){},stopNative:function(){var editor=$(this).editor();editor.$this.children('.zedity-selected').each(function(idx,elem){$(elem).box().reposition();editor._changed()});if(editor.boxes.$selected)box.showPropBar()}})}else{if(multiselect)box.$this.removeClass('zedity-selected')}}if(this.editor.boxes.$selected){box.showPropBar()}else{this.editor.propbars.hideall()}if(this.editor.menu)this.editor.menu.refresh();if(multiselect){if(typeof(this.editor._options.onselect)=='function')this.editor._options.onselect.call(this,null);return box}if(box&&!box.$this.hasClass('zedity-background')&&Math.abs(box.rotation())<20){box.$this.resizable({handles:'all',reposition:true,minWidth:box._sizeLimits().minWidth,maxWidth:box._sizeLimits().maxWidth,minHeight:box._sizeLimits().minHeight,maxHeight:box._sizeLimits().maxHeight,start:function(event,ui){$(this).editor().propbars.hideall()},stop:function(event,ui){var editor=$(this).editor();editor.boxes.selected().reposition()._resize().showPropBar();editor._changed();editor.boxes.refreshSelected()},resize:function(){}})}if(typeof(this.editor._options.onselect)=='function')this.editor._options.onselect.call(this,box);return box},refreshSelected:function(){var sel=this.selected();if(!sel)return null;this._select(null);sel.select();return sel},get:function(idx){var uidx=Zedity.core.store.get('zedUnIndex');var ids=Zedity.core.store.get('zedUnRef'+uidx);var list=[];if(ids){ids=ids.split(' ');for(var i=ids.length-1;i>=0;--i){list.push(this._getFromId(ids[i]))}}if(idx==null){return list}else if(typeof idx=='string'||idx instanceof String){if(Zedity.Box.types.indexOf(idx)>-1){var sub=[];for(var i=list.length-1;i>=0;--i){if(list[i].type==idx){sub.push(list[i])}}return sub}else{for(var i=list.length-1;i>=0;--i){if(list[i].id==idx||'#'+list[i].id==idx){return list[i]}}return null}}else{if(idx<list.length){return list[idx]}else{return null}}},count:function(){var uidx=Zedity.core.store.get('zedUnIndex');var ids=Zedity.core.store.get('zedUnRef'+uidx);ids=ids.split(' ');return ids.length+1},selected:function(){var $sel=this.editor.$this.children('.zedity-selected');if($sel.length==0)$sel=this.$selected;if(!$sel||$sel.length!=1)return null;return this._getFromId($sel.attr('id'))},add:function(type,options){if(Zedity.Box.types.indexOf(type)==-1){this.editor._error({message:'Box type "'+type+'" doesn\'t exist.'});return null}try{var box=new Zedity.Box[type]($.extend({editor:this.editor},options))}catch(e){this.editor._error({message:'Error during box creation: '+e.message});return null}this._boxes.push(box);box.reposition(true).select();Zedity.core._call(box,'arrange','front');if(!options||(options.id==null&&options.element==null))this.editor._changed();return box},},propbars:{_propbars:[],_getFromId:function(id){for(var i=this._propbars.length-1;i>=0;--i){if(this._propbars[i].id==id||'#'+this._propbars[i].id==id){return this._propbars[i]}}},_getFromType:function(type){for(var i=this._propbars.length-1;i>=0;--i){if(this._propbars[i].type==type){return this._propbars[i]}}return undefined},create:function(options){var propbar=null;try{propbar=new Zedity.PropBar(options);this._propbars.push(propbar);return propbar}catch(e){propbar=this._getFromType(options.type);if(!propbar)throw new Error('Error during PropBar creation.');return propbar}},hideall:function(){if(!this.editor)return;this.editor.$container.find('.zedity-propbar').each(function(){var $this=$(this);var propbar=$this.editor().propbars._getFromId($this.attr('id'));propbar.hide()})}},undo:function(){this.page._undo();return this},redo:function(){this.page._redo();return this},save:function(callback,options){options=$.extend({removeEmpty:true,finalize:true},options);this.lock('<p>Saving content.<br/>Please wait...</p>');if(this.$this.attr('data-href')){this.$this.attr('onclick','window.open(\''+this.$this.attr('data-href')+'\',\''+(this.$this.attr('data-target')||'_self')+'\');');this.$this.css('cursor','pointer')}this.boxes._select(null);var saveq=$({});var list=this.boxes.get();$.each(list,function(idx,box){saveq.queue('save',function(next){box._save(function(){next()},options)})});saveq.queue('save',$.proxy(function(){var content=this.page._getPage(options.removeEmpty);content=content.replace(/data-zedcssbuffer/g,'style');this.page._setPage(content);this.page._saveUndo();this.unlock();if(typeof(callback)=='function')callback.call(this,content)},this));setTimeout(function(){saveq.dequeue('save')},10);return this},_setLockMessage:function(message){if(message==null)message=this._data.lockmessage.pop();if(message){message='<div class="zedity-message">'+message+'</div>'}this.$container.find('.zedity-lock').css('width',this.$this.width()).html(message||'');return this},lock:function(message){if(this._data.locked>0){this._data.lockmessage.push(this.$container.find('.zedity-lock .zedity-message').html())}this._data.locked++;$('body').trigger('click.zedity');$('.zedity-dialog > .ui-dialog-content').dialog('close');this._setLockMessage(message||'');this.$container.addClass('zedity-locked').find('.zedity-lock').show().focus();return this},unlock:function(){if(--this._data.locked>0){this._setLockMessage();return}this._data.locked=0;this.$container.removeClass('zedity-locked').find('.zedity-lock').hide();return this},init:function(){this.$this=this.element();this.$this.on('click.editor',function(event){var $this=$(this);var editor=$this.editor();if(!$(event.target).is(editor.$this))return;editor.boxes._select(null)});var $this=this.$this;$('html,body').off('click.zedity').on('click.zedity',function(event){if($(event.target).closest('.zedity-box.zedity-editing,.zedity-box.zedity-playing,.zedity-dialog').length>0||$(event.target).closest('.zedity-propbar').length>0)return;$this.find('.zedity-box.zedity-editing,.zedity-box.zedity-playing').each(function(){$(this).box().stop()})});return this}});Zedity.requires=['storage','css'];Zedity.editors=[]})(jQuery);(function($){$.fn=$.fn||{};$.fn.editor=function(){return $(this).closest('.zedity-editor-container').data('zedity-editor')};$.fn.box=function(){var $box=$(this).closest('.zedity-editor .zedity-box');if($box.length==0)return null;return $box.editor().boxes._getFromId($box.attr('id'))};$.fn.zdata=function(key,value){var $this=$(this);var data=$this.attr('data-zed');if(value===undefined){if(!data)return null;if(key==null){return JSON.parse(data)}else{data=JSON.parse(data);return data[key]}}else{data=JSON.parse(data||'{}');var ret=data[key];if(value===null){delete data[key]}else{data[key]=value}$this.attr('data-zed',JSON.stringify(data));return ret}};$.widget('ui.menuZedity',$.ui.menu,{delay:10,position:{my:'left top',at:'left bottom'},subposition:{my:'left top',at:'right top'},_open:function(submenu){var position=this.active.parents('.ui-menubar').length==0?this.position:this.subposition;position=$.extend({of:this.active},position);clearTimeout(this.timer);this.element.find('.ui-menu').not(submenu.parents('.ui-menu')).hide().attr('aria-hidden','true');submenu.show().removeAttr('aria-hidden').attr('aria-expanded','true').position(position)},_setOption:function(key,value){this[key]=value}})})(jQuery);
var Zedity=Zedity||{};Zedity.version='1.4.1';Zedity.core=Zedity.core||{};(function($){Zedity.core.genId=function(prefix){prefix=prefix||'';var id;var i=0;do{id=prefix+'_'+Math.floor(Math.random()*1000000000).toString(36)+(new Date()).getUTCMilliseconds().toString(36);if(++i>=1000000)throw Error('Error in generating unique id.')}while($('#'+id).length>0);return id};Zedity.core._call=function(object,method,args){if(!object||!method||!(method in object))throw new Error('Improper internal call.');object.editor._data.internal++;var ret=object[method].apply(object,[].splice.call(arguments,2));object.editor._data.internal--;return ret};Zedity.core.supports={canvas:function(){return!!document.createElement('canvas').getContext},fileapi:function(){return(typeof(FileReader)!='undefined')},storage:function(){try{return(('localStorage'in window)&&(window['localStorage']!==null))}catch(e){return false}},historystate:function(){return('pushState'in window.history)},xhr2:function(){return('XMLHttpRequest'in window)&&('upload'in(new XMLHttpRequest()))},selection:function(){return('getSelection'in window)},gradient:function(){var css="background-image:linear-gradient(left,rgba(255,255,255,1) 0%,rgba(0,0,0,1) 100%);background-image:-o-linear-gradient(left,rgba(255,255,255,1) 0%,rgba(0,0,0,1) 100%);background-image:-ms-linear-gradient(left,rgba(255,255,255,1) 0%,rgba(0,0,0,1) 100%);background-image:-moz-linear-gradient(left,rgba(255,255,255,1) 0%,rgba(0,0,0,1) 100%);background-image:-webkit-linear-gradient(left,rgba(255,255,255,1) 0%,rgba(0,0,0,1) 100%);";var element=$('<div/>');try{element.attr('style',css)}catch(e){}return element[0].style.backgroundImage.indexOf('linear-gradient')>-1},css:function(detailed){var style=document.documentElement.style;var tests={opacity:((style.opacity!==undefined)||(style.filter!==undefined)||false),transform:((style.transform!==undefined)||(style.MozTransform!==undefined)||(style.webkitTransform!==undefined)||(style.msTransform!==undefined)||(style.oTransform!==undefined)||(style.OTransform!==undefined)||false),borderRadius:((style.borderRadius!==undefined)||(style.MozBorderRadius!==undefined)||(style.webkitBorderRadius!==undefined)||(style.oBorderRadius!==undefined)||(style.OBorderRadius!==undefined)||false),boxShadow:((style.boxShadow!==undefined)||(style.MozBoxShadow!==undefined)||(style.webkitBoxShadow!==undefined)||(style.oBoxShadow!==undefined)||(style.OBoxShadow!==undefined)||false),backgroundSize:((style.backgroundSize!==undefined)||(style.MozBackgroundSize!==undefined)||(style.webkitBackgroundSize!==undefined)||(style.oBackgroundSize!==undefined)||(style.OBackgroundSize!==undefined)||false),minimum:false,all:false};tests.minimum=(tests.opacity&&tests.transform&&tests.backgroundSize);tests.all=(tests.opacity&&tests.transform&&tests.borderRadius&&tests.boxShadow&&tests.backgroundSize);return(detailed?tests:tests.all)},minimum:function(){return(this.canvas()&&this.storage()&&this.css(true).minimum)}};Zedity.core.keys={_getKey:function(keyCode){var key;if(Zedity.core.keys._keyCodes.hasOwnProperty(keyCode))key=Zedity.core.keys._keyCodes[keyCode];key=key||String.fromCharCode(keyCode).toLowerCase();return key},_bind:function(){function swapKV(input){var output={};for(var key in input)if(input.hasOwnProperty(key))output[input[key]]=key.toString().replace('_','').toLowerCase();return output}Zedity.core.keys._keyCodes=swapKV($.ui.keyCode);$(document).off('keydown.zedity').on('keydown.zedity',function(event){var key=Zedity.core.keys._getKey(event.keyCode||event.which);Zedity.core.keys[key]=true;Zedity.core.keys[event.keyCode||event.which]=true;Zedity.core.keys['ctrl']=event.ctrlKey;Zedity.core.keys['alt']=event.altKey;Zedity.core.keys['shift']=event.shiftKey;Zedity.core.keys['meta']=event.metaKey;return!Zedity.core.shortcuts.test(event)}).off('keyup.zedity').on('keyup.zedity',function(event){var key=Zedity.core.keys._getKey(event.keyCode||event.which);Zedity.core.keys[key]=false;Zedity.core.keys[event.keyCode||event.which]=false;Zedity.core.keys['ctrl']=event.ctrlKey;Zedity.core.keys['alt']=event.altKey;Zedity.core.keys['shift']=event.shiftKey;Zedity.core.keys['meta']=event.metaKey})},_unbind:function(){$(document).off('keydown.zedity').off('keyup.zedity')}};Zedity.core.shortcuts={_shortcuts:[],_checkKeys:function(keys){keys=keys.split(/[\+\-]/);for(var i=keys.length-1;i>=0;--i){if(!Zedity.core.keys[keys[i]])return false}return true},test:function(event){var handled=false;for(var i=this._shortcuts.length-1;i>=0;--i){if(this._checkKeys(this._shortcuts[i].keys)){if(this._shortcuts[i].disableoninput){var $elem=$(event.target);if($elem.is('input')||$elem.is('textarea')||$elem.attr('contenteditable'))return}var ret=this._shortcuts[i].action.call(this._shortcuts[i].target,event);if(!handled&&ret)handled=true}}return handled},add:function(shortcut,target,action,disableoninput){var shortcuts=shortcut.split(' ');for(var i=shortcuts.length-1;i>=0;--i){this._shortcuts.push({keys:shortcuts[i],target:target,action:action,disableoninput:disableoninput})}}};Zedity.core.store={storage:sessionStorage,get:function(key){try{return this.storage.getItem(key)}catch(e){return undefined}},set:function(key,value){try{this.storage.setItem(key,value)}catch(e){}},del:function(key){try{this.storage.removeItem(key)}catch(e){}},clear:function(key){try{this.storage.clear()}catch(e){}},length:function(){try{return this.storage.length}catch(e){return 0}},key:function(num){try{return this.storage.key(num)}catch(e){return null}},delprefix:function(prefix){try{prefix=prefix||'';for(var i=this.length()-1;i>=0;--i){var key=this.key(i);if(key.substr(0,prefix.length)==prefix){this.del(key)}}}catch(e){}},push:function(key){try{localStorage.setItem(key,sessionStorage.getItem(key))}catch(e){}},pop:function(key){try{var value=localStorage.getItem(key);if(value)sessionStorage.setItem(key,value);localStorage.removeItem(key)}catch(e){}}};Zedity.core.gc={name:'zedGc',getData:function(name){return JSON.parse(Zedity.core.store.get(name||this.name)||'{}')},setData:function(data,name){Zedity.core.store.set(name||this.name,JSON.stringify(data))},flushData:function(name){Zedity.core.store.del(name||this.name)},addReference:function(ref,name){var data=this.getData(name);if(typeof ref==='string')ref=$.trim(ref).split(' ');if($.isArray(ref)){for(var i=ref.length-1;i>=0;--i){if(ref[i]!=''){if(data[ref[i]]){data[ref[i]]++}else{data[ref[i]]=1}}}this.setData(data,name)}},removeReference:function(ref,name){var data=this.getData(name);if(typeof ref==='string')ref=ref.split(' ');if($.isArray(ref)){for(var i=ref.length-1;i>=0;--i){if(ref[i]!=''){if(!data[ref[i]])data[ref[i]]=0;if(data[ref[i]]>0)data[ref[i]]--}}this.setData(data,name)}},deleteReference:function(ref,name){var data=this.getData(name);if(typeof ref==='string')ref=ref.split(' ');if($.isArray(ref)){for(var i=ref.length-1;i>=0;--i){if(data.hasOwnProperty(ref[i]))delete data[ref[i]]}this.setData(data,name)}},getReferenced:function(name){var data=this.getData(name);var list=[];for(var i in data){if(data[i]>0)list.push(i)}return list},getNonReferenced:function(name){var data=this.getData(name);var list=[];for(var i in data){if(data[i]<=0)list.push(i)}return list}};Zedity.core.selection={_savedRange:undefined,_getRange:function(){try{return window.getSelection().getRangeAt(0)}catch(e){return undefined}},save:function(){this._savedRange=this._getRange();return this._savedRange},restore:function(range){range=range||this._savedRange;if(!range)return;var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);return range},unselect:function(){if(document.selection){document.selection.empty()}else{window.getSelection().removeAllRanges()}},selected:function(){return!window.getSelection().isCollapsed},expand:function(onlyifcollapsed){if(onlyifcollapsed&&this.selected())return;try{this.selectElement(this.getElement())}catch(e){}},selectText:function(element){var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range)},selectElement:function(element){var selection=window.getSelection();var range=document.createRange();range.selectNode(element);selection.removeAllRanges();selection.addRange(range)},selectElements:function(elements){var selection=window.getSelection();var range=document.createRange();range.setStartBefore(elements.get(0));range.setEndAfter(elements.get(elements.length-1));selection.removeAllRanges();selection.addRange(range)},insertTextAtCursor:function(text){var range=this._getRange();range.deleteContents();range.insertNode(document.createTextNode(text))},insertElementAtCursor:function(element){var range=this._getRange();range.insertNode(element)},setCursorPosition:function(element,pos){var sel=window.getSelection();sel.collapse(element.firstChild,pos)},isNodeInSelection:function(node){var range=this._getRange();if(range.intersectsNode){return range.intersectsNode(node)}else{var nodeRange=node.ownerDocument.createRange();try{nodeRange.selectNode(node)}catch(e){nodeRange.selectNodeContents(node)}return range.compareBoundaryPoints(Range.END_TO_START,nodeRange)==-1&&range.compareBoundaryPoints(Range.START_TO_END,nodeRange)==1}},getElement:function(){var range=this._getRange();if(!range)return null;try{if(range.parentElement){return range.parentElement()}else if(range.commonAncestorContainer){var container=range.commonAncestorContainer;return container.nodeType===3?container.parentNode:container}else{return null}}catch(e){return null}},getElements:function(){var range=this._getRange();if(!range)return[];var containerElement=range.commonAncestorContainer;if(containerElement.nodeType!=1)containerElement=containerElement.parentNode;var treeWalker=window.document.createTreeWalker(containerElement,NodeFilter.SHOW_ELEMENT,$.proxy(function(node){return this.isNodeInSelection(node)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},this),false);var list=[treeWalker.currentNode];while(treeWalker.nextNode()){list.push(treeWalker.currentNode)}return list},findElements:function(selector){var list=this.getElements();var ret=[];$(list).each(function(){if($(this).is(selector))ret.push(this)});return ret},getParagraph:function(){var elem=this.getElement();if(!elem)return null;var $elem=$(elem);$elem=$elem.closest('p,h1,h2,h3,h4,h5,h6,pre,div');if($elem.length==0)return null;if($elem.is('.zedity-content')){$elem=$elem.children('p,h1,h2,h3,h4,h5,h6,pre,div').first()}if($elem.is('.zedity-box')||$elem.find('.zedity-box,.zedity-content').length>0)return null;return $elem.get(0)},setParagraph:function(ptype){ptype=ptype||'p';window.getSelection().collapseToStart();var par=this.getParagraph();if(!par)return;var $par=$(par);var content=$par.html();var $new=$('<'+ptype+'/>',{html:content});$.each($par.prop('attributes')||[],function(){$new.attr(this.name,this.value)});$par.replaceWith($new);return $new.get(0)},forEachElement:function(action){var elem=this.getElement();$(elem).children().each(action)},unwrap:function(elemtype){},command:function(command,value){try{document.execCommand(command,false,value)}catch(e){}},wrap:function(elemtype,css,classname){if(!this.selected())return $({});elemtype=elemtype||'span';classname=classname||'';var cssneg={};for(var prop in css){cssneg[prop]=''}this.command('stylewithcss',false);this.command('strikethrough');var $elem=$(this.getElement()).parents('.zedity-box .zedity-content').addBack().find('s,strike');var list=[];$elem.each(function(idx,elem){var tempclass=Zedity.core.genId('tfms');var $this=$(this);$this.replaceWith('<'+elemtype+' class="'+tempclass+'">'+$this.html()+'</'+elemtype+'>');var $newelem=$('.'+tempclass);$newelem.addClass(classname).removeClass(tempclass);$newelem[0].parentNode.normalize();while($newelem.parent().is(elemtype+',b,i,u,strong,em')&&$newelem[0].parentNode.childNodes.length==1){$newelem=$($newelem[0].parentNode);$newelem[0].parentNode.normalize()}$newelem.find(elemtype).each(function(idx,elem){var $elem=$(elem);var oldcss=$elem.getCss(Object.keys(cssneg));$elem.css(cssneg).removeClass(classname);if(!$elem.attr('style')||$elem.attr('style')==''){if($elem.parent().is(elemtype)&&(!$elem.parent().attr('style')||$elem.attr('style')=='')){$elem.parent().css(oldcss)}$elem.replaceWith($elem.contents())}elem.normalize()});list.push($newelem[0])});this.selectElements($(list));return $(list)},format:function(css,action,classname){var $elem=this.wrap('span',css,classname);if(typeof action=='function'){$elem.each(function(idx,element){action.call(this,element)})}else{$elem.css(css)}}};Zedity.core.embed={services:{},add:function(service,options){var defaults={type:null,regex:[],parser:function(code,embed){},player:{flash:{},iframe:{command:function(frame_id,func,args){}}},sizeLimits:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null}};if(!service||!options)return;options.service=service;options=$.extend(true,{},defaults,options);this.services[service]=options},parse:function(embed,forcetype){var code;for(var service in this.services){if(!this.services.hasOwnProperty(service))continue;if(forcetype&&this.services[service].type!=forcetype)continue;for(var j=this.services[service].regex.length-1;j>=0;--j){if(code=this.services[service].regex[j].exec(embed)){var links=this.services[service].parser(code,embed);var id=links.id||Zedity.core.genId(this.services[service].service);if(links.flash){var embed_flash='<object id="'+id+'" data-service="'+service+'" type="application/x-shockwave-flash" data="'+links.flash+'" wmode="opaque" style="width:100%;height:100%">'+'<param name="movie" value="'+links.flash+'"/>'+'<param name="allowfullscreen" value="false"/>'+'<param name="wmode" value="opaque"/>'+'<param name="allowScriptAccess" value="always"/> '+'</object>'}if(links.iframe){var embed_iframe='<iframe id="'+id+'" data-service="'+service+'" src="'+links.iframe+'" frameborder="0" scrolling="no" style="width:100%;height:100%"></iframe>'}return{code:links.code,service:service,id:id,flash:embed_flash,iframe:embed_iframe}}}}return{}},player:function($elem,service,func,args){var command;try{if($elem.is('object')){command=this.services[service].player.flash[func];if($elem[0][command])$elem[0][command]()}if($elem.is('iframe')){command=this.services[service].player.iframe[func];this.services[service].player.iframe.command($elem.attr('id'),command,args)}if($elem.is('video')||$elem.is('audio')){if($elem[0][func])$elem[0][func]()}}catch(e){}},getServices:function(type,links){var ret=[];for(var service in this.services){if(this.services.hasOwnProperty(service)&&(!type||this.services[service].type==type)){if(links){ret.push('<a href="'+this.services[service].url+'" target="_blank">'+service+'</a>')}else{ret.push(service)}}}return ret}};Zedity.core.dialog=function(options){options=$.extend({title:'Zedity',message:'',question:'',default:'',mandatory:'Please insert a value.',ok:function(answer){},cancel:function(){}},options);$('<div class="zedity-dialog-popup">'+'<p>'+options.message+'</p>'+(options.question?'<p>'+options.question+'</p>'+'<input id="zedity-txtPopupDialog" type="text" value=""><br/><br/>':'')+'</div>').on('keydown.zedity',function(event){if(event.keyCode==13){$(this).parent().find('.ui-dialog-buttonpane button:eq(0)').trigger('click');return false}}).dialog({title:options.title,dialogClass:'zedity-dialog',autoOpen:true,modal:true,resizable:false,open:function(){$(this).find('.zedity-tooltip').tooltip();$('#zedity-txtPopupDialog').val(options.default).select().focus()},close:function(){setTimeout($.proxy(function(){$(this).dialog('destroy').remove()},this),10)},buttons:[{text:'OK',click:function(){var answer='';if(options.question){answer=$.trim($('#zedity-txtPopupDialog').val());if(options.mandatory&&answer==''){alert(options.mandatory);$('#zedity-txtPopupDialog').val(options.default).select().focus();return}}$(this).dialog('close');options.ok.call(this,answer)}},{text:'Cancel',click:function(){$(this).dialog('close');options.cancel.call(this)}}].slice(0,options.question?2:1)})};Array.prototype.remove=function(){var what,a=arguments,L=a.length,ax;while(L&&this.length){what=a[--L];while((ax=this.indexOf(what))!==-1){this.splice(ax,1)}}return this};$.widget('ui.tooltip',$.ui.tooltip,{options:{content:function(){return $(this).prop('title')}}})})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Page needs Zedity.');Zedity.Page=function(options){this._options=$.extend({width:800,height:550,content:'',minWidth:150,minHeight:150,maxWidth:3000,maxHeight:10000},options);this._sizeConstraints={};this.editor=this._options.editor;this.editor.id=Zedity.core.genId('zed');this.editor.$container.html($('<div/>',{id:this.editor.id,'class':'zedity-editor',css:{position:'relative',width:this._options.width,height:this._options.height,overflow:'hidden'}})).css({position:'relative',width:'auto',height:'auto'}).addClass('zedity-editor-container');this.editor.$this=this.editor.element();this.editor.page=this;Zedity.core._call(this,'content',this._options.content)};$.extend(Zedity.Page.prototype,{_getPage:function(clean){var $content=$(this.editor.$this[0].outerHTML);$content.children().each(function(idx,elem){var $this=$(this);$this.removeClass('zedity-selected zedity-editable ui-draggable ui-resizable ui-draggable-dragging');$this.find('.ui-resizable-handle').remove()});if(clean){$content.find('.zedity-empty').each(function(idx,elem){$(elem).parent().remove()})}return $content[0].outerHTML},_setPage:function(content){var $content=$(content||'');var $this=this.editor.$this;$this.empty();$content.children('.zedity-box').each(function(idx,elem){$this.append($(elem)[0].outerHTML)});$.each($content.prop('attributes')||[],function(){$this.attr(this.name,this.value)});$this.removeAttr('onclick').css('cursor','');this.editor.id=$this.attr('id');this.editor.propbars.hideall();this.editor.$this.children('.zedity-box').each(function(idx,elem){var $this=$(this);var editor=$this.editor();var box=$this.box();if(!box&&Zedity.Box.hasOwnProperty($this.attr('data-boxtype'))){box=new Zedity.Box[$this.attr('data-boxtype')]({editor:editor,id:$this.attr('id'),element:$this});editor.boxes._boxes.push(box)}else if(box){box.$this=$this;box.init()}else{editor._error({type:'WARNING',message:'Removed box. Box type "'+$this.attr('data-boxtype')+'" not supported.'});$this.remove()}});this.editor.boxes.$selected=null;Zedity.core._call(this,'size',this.size())},_destroyUnreferencedObjects:function(){var list=Zedity.core.gc.getNonReferenced();for(var i=list.length-1;i>=0;--i){var box=this.editor.boxes._getFromId(list[i]);if(box)Zedity.core._call(box,'destroy')}Zedity.core.gc.deleteReference(list)},_saveUndo:function(){if(this.editor._data.undoing)return;if(this.editor._data.savingundo)return;this.editor._data.savingundo=true;var idx=Zedity.core.store.get('zedUnIndex')||-1;idx++;Zedity.core.store.set('zedUnIndex',idx);Zedity.core.gc.removeReference(Zedity.core.store.get('zedUnRef'+(idx-this.editor._options.undoSteps)));Zedity.core.store.del('zedUnPage'+(idx-this.editor._options.undoSteps));Zedity.core.store.del('zedUnRef'+(idx-this.editor._options.undoSteps));for(var i=idx,num=idx+this.editor._options.undoSteps;i<=num;i++){Zedity.core.gc.removeReference(Zedity.core.store.get('zedUnRef'+i));Zedity.core.store.del('zedUnPage'+i);Zedity.core.store.del('zedUnRef'+i)}var $content=$(this._getPage());var list=$content.children('.zedity-box').map(function(){return $(this).attr('id')}).get();Zedity.core.store.set('zedUnPage'+idx,$content[0].outerHTML);Zedity.core.store.set('zedUnRef'+idx,list.join(' '));Zedity.core.gc.addReference(list);this._destroyUnreferencedObjects();this.editor._data.savingundo=false},_clearUndo:function(){var idx=Zedity.core.store.get('zedUnIndex');if(!idx)idx=0;var content=Zedity.core.store.get('zedUnPage'+idx)||'';Zedity.core.store.delprefix('zedUn');Zedity.core.store.set('zedUnPage0',content);Zedity.core.store.set('zedUnIndex',0);var list=$(content).children('.zedity-box').map(function(){return $(this).attr('id')}).get();Zedity.core.store.set('zedUnRef0',list.join(' '));Zedity.core.gc.flushData();Zedity.core.gc.addReference(list);this._destroyUnreferencedObjects()},_undo:function(){this.editor._data.undoing=true;var idx=Zedity.core.store.get('zedUnIndex');idx--;var content=Zedity.core.store.get('zedUnPage'+idx);if(content){Zedity.core.store.set('zedUnIndex',idx);this._setPage(content);if(typeof(this.editor._options.onchange)=='function')this.editor._options.onchange.call(this.editor)}this.editor._data.undoing=false},_redo:function(){this.editor._data.undoing=true;var idx=Zedity.core.store.get('zedUnIndex');idx++;var content=Zedity.core.store.get('zedUnPage'+idx);if(content){Zedity.core.store.set('zedUnIndex',idx);this._setPage(content);if(typeof(this.editor._options.onchange)=='function')this.editor._options.onchange.call(this.editor)}this.editor._data.undoing=false},size:function(size){if(!size){size={width:Math.round(this.editor.$this.width()),height:Math.round(this.editor.$this.height())}}else{if(this.editor._options.resizable){size={width:size.width||Math.round(this.editor.$this.width()),height:size.height||Math.round(this.editor.$this.height())}}else{size={width:this.editor._options.width||Math.round(this.editor.$this.width()),height:this.editor._options.height||Math.round(this.editor.$this.height())}}size.width=Math.max(size.width,this._options.minWidth);size.height=Math.max(size.height,this._options.minHeight);size.width=Math.min(size.width,this._options.maxWidth);size.height=Math.min(size.height,this._options.maxHeight);this.editor.$this.css(size);this.editor.$this.children('.zedity-box').each(function(idx,elem){Zedity.core._call($(elem).box(),'reposition')});this.editor.boxes.refreshSelected();this.editor._changed()}return size},extractText:function(type){var text='';var boxes=this.editor.boxes.get(type);for(var i=boxes.length-1;i>=0;--i){text+=boxes[i].extractText()+' '}return Zedity.utils.cleanText(text)},content:function(content){if(content==null){content=this._getPage()}else{this._setPage(content);this.editor.boxes._select(null);this.editor._changed()}return content}});Zedity.core.store.delprefix('zedUn');Zedity.core.gc.flushData()})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Box needs Zedity.');Zedity.Box=function(options){options=options||{};this.editor=options.editor||Zedity.editors[Zedity.editors.length-1];this._options=$.extend({x:undefined,y:undefined,width:100,height:50,maxBoxes:undefined},this._defaults,this.editor._options.Box,this.editor._options[this.type],options);this._can=['background','asBackground','corners','rotation','flip'];this._data={};if(this._options.id){this.id=this._options.id;this.$this=this.editor.$this.find('#'+this.id)}else if(this._options.element){this.$this=this._options.element;this.id=Zedity.core.genId('zeb');this.$this.attr('id',this.id)}else{this.editor.step=(this.editor.step+20)%Math.min(this.editor.page.size().width,this.editor.page.size().height);this._options=$.extend({x:this.editor.step,y:this.editor.step},this._options);this.id=Zedity.core.genId('zeb');this.editor.$this.append($('<div/>',{id:this.id,'class':'zedity-box zedity-box-'+this.type,'data-boxtype':this.type,css:{position:'absolute',left:this._options.x,top:this._options.y,width:this._options.width,height:this._options.height,'background-color':'transparent'}}));this.$this=this.editor.$this.find('#'+this.id)}if(this._options.maxBoxes){var boxes=this.editor.boxes.get(this.type);if(boxes.length>=this._options.maxBoxes){this.$this.remove();throw new Error('Too many "'+this.type+'" boxes (limit: '+this._options.maxBoxes+').')}}if(this.editor._options.maxTotalBoxes){var boxes=this.editor.boxes.get();if(boxes.length>=this.editor._options.maxTotalBoxes){this.$this.remove();throw new Error('Too many total boxes (limit: '+this.editor._options.maxTotalBoxes+').')}}this.init();this.propbar=this.editor.propbars._getFromType(this.type)};$.extend(Zedity.Box.prototype,{_sizeLimits:function(){var sl=Zedity.Box[this.type].sizeLimits;var ps=this.editor.page.size();return{minWidth:sl.minWidth||16,maxWidth:sl.maxWidth,minHeight:sl.minHeight||16,maxHeight:sl.maxHeight}},element:function(){this.$this=$('#'+this.id);return this.$this},content:function(content){if(content==null){content=this.$this.not('.zedity-empty,.ui-resizable-handle').html()}else{this.$this.html(content);this.editor._changed()}return content},extractText:function($elem){var text='';this._data.$clone=this._data.$clone||this.$this.clone();$elem=$('<div/>').append(this._data.$clone);$elem.find('.zedity-empty,.zedity-boxoverlay').remove();$elem.find('p,h1,h2,h3,h4,h5,h6').append('<span> </span>');$elem.find('br').replaceWith('<span> </span>');text+=$elem.text()+' ';$elem.find('[title]').each(function(idx,elem){text+=$(elem).attr('title')+' '});$elem.find('[alt]').each(function(idx,elem){text+=$(elem).attr('alt')+' '});delete this._data.$clone;return Zedity.utils.cleanText(text)},_cssFinalize:function(){function cleanup(css){return css.replace(/\s+/g,' ').replace(/(;|,|:) /g,'$1').replace(/;{2,}/g,';').replace(/(^;|;$)/,'')};var css=(this.$this.attr('style')||'').replace(/background(-color|-image|)\s*?:.*?;/g,'');css+=';'+(this.$this.attr('data-zedcssbuffer')||'');css=cleanup(css);this.$this.attr('data-zedcssbuffer',css);this.$this.prop('style',null);this.$this.removeAttr('style');var checkstyle=this.$this.attr('style');if((typeof checkstyle!=='undefined')&&(checkstyle!==false)){this.editor._error({message:'Unexpected error: could not finalize box style.'})}css=(this.$this.children('.zedity-content').attr('style')||'');css=cleanup(css);this.$this.children('.zedity-content').attr('style',css)},_save:function(callback){if(this.$this.hasClass('zedity-selected'))this.editor.boxes._select(null);if(this.$this.attr('data-href')){this.$this.attr('onclick','window.open(\''+this.$this.attr('data-href')+'\',\''+(this.$this.attr('data-target')||'_self')+'\');');this.$this.css('cursor','pointer')}this.$this.removeAttr('id data-zed');var flip=Zedity.core._call(this,'flip');Zedity.core._call(this,'flip',flip);Zedity.core._call(this,'flip',flip);Zedity.core._call(this,'rotation',Zedity.core._call(this,'rotation'));Zedity.core._call(this,'background',Zedity.core._call(this,'background'));this._cssFinalize();if(typeof(callback)=='function')callback.call(this);return this},init:function(){this.createPropBar();var zthis=this;this.$this.on('click.zedity',function(){zthis.select()});this.$this.on('corners.zedity',function(){var $this=$(this);var size=parseInt(($this.css('border-bottom-right-radius')||'0px').replace('px',''));size=size>0?Math.floor(Math.min(size,$this.width()/2,$this.height()/2)/4):0;$this.find('.ui-resizable-se').css({right:size+'px',bottom:size+'px'})});this.$this.removeAttr('onclick').css('cursor','');return this},options:function(options){this._options=$.extend(this._options,options);return this._options},select:function(){if(this.$this.hasClass('zedity-editing')||this.$this.hasClass('zedity-playing'))return this;this.editor.boxes._select(this);this.$this.trigger('corners.zedity');this.propbar.$this.find('.zedity-menu-asbackground a').html(this.asBackground()?'<span class="zedity-menu-icon zedity-icon-contract"></span> Unset from background':'<span class="zedity-menu-icon zedity-icon-expand"></span> Set as background');this.propbar.$this.find('.zedity-menu-arrange').toggleClass('ui-state-disabled',this.$this.hasClass('zedity-background'));this.propbar.$this.find('.zedity-menu-duplicate').toggleClass('ui-state-disabled',this.$this.hasClass('zedity-background'));this.propbar.$this.find('.zedity-button .zedity-icon-rotate').parent().toggleClass('zedity-disabled',this.$this.hasClass('zedity-background'));return this},can:function(feature){return this._can.indexOf(feature)>-1},createPropBar:function(options){this.propbar=this.editor.propbars.create($.extend(true,{editor:this.editor,type:this.type,minWidth:280,bars:{'0':{bgcolor:{type:'button',icon:'color',label:'Background',title:'Select background color',order:10,panel:{'class':'zedity-backgroundcolor',height:160,scrollable:true,build:function(propbar,$panel,options){$panel.colorPicker({colors:['transparent','#ffffff','#f2f2f2','#d8d8d8','#bdbdbd','#a4a4a4','#6e6e6e','#424242','#000000','#fbefef','#f8e0e0','#f5a9a9','#f78181','#fe2e2e','#df0101','#b40404','#8a0808','#3b0b0b','#fbf5ef','#f8ece0','#f5d0a9','#faac58','#ff8000','#df7401','#b45f04','#8a4b08','#3b240b','#fbfbef','#f5f6ce','#f2f5a9','#f4fa58','#ffff00','#d7df01','#aeb404','#868a08','#393b0b','#f5fbef','#e3f6ce','#d0f5a9','#acfa58','#80ff00','#74df00','#5fb404','#4b8a08','#38610b','#effbef','#cef6ce','#a9f5a9','#58fa58','#00ff00','#01df01','#04b404','#088a08','#0b3b0b','#effbfb','#cef6f5','#a9f5f2','#58faf4','#00ffff','#01dfd7','#04b4ae','#088a85','#0b3b39','#eff5fb','#cee3f6','#81bef7','#2e9afe','#0080ff','#045fb4','#084b8a','#084b8a','#0b243b','#efeffb','#cecef6','#5858fa','#2e2efe','#0000ff','#0404b4','#08088a','#0b0b61','#0b0b3b','#f5effb','#e3cef6','#be81f7','#ac58fa','#9a2efe','#5f04b4','#4b088a','#380b61','#240b3b','#fbeffb','#f6cef5','#f781f3','#fe2ef7','#ff00ff','#df01d7','#b404ae','#610b5e','#3b0b39','#fbeff5','#f6cee3','#f5a9d0','#fa58ac','#ff0080','#df0174','#b4045f','#610b38','#3b0b24'],fills:true,alpha:true,buttons:options.colorButtons,maxcols:9,onchange:function(event,color,fill,alpha){var editor=$(this).editor();Zedity.core._call(editor.boxes.selected(),'background',fill);editor.boxes.$selected.find('.zedity-empty').remove();propbar.$drawer.find('.zedity-sliderbgopacity').sliderSnap('value',Math.round(alpha*100));editor._changed()},onchangealpha:function(event,alpha){var fill=$(this).colorPicker('getfill');Zedity.core._call($(this).editor().boxes.selected(),'background',fill)}})}}},border:{type:'button',icon:'border',label:'Border',title:'Set box border',order:20,panel:{'class':'zedity-border',height:210,scrollable:true,build:function(propbar,$panel,options){$panel.boxer({colorButtons:options.colorButtons,onchange:function(){var $this=$(this);propbar.editor.boxes.selected().$this.css({'border-width':$this.boxer('getsize'),'border-style':$this.boxer('getstyle'),'border-color':Zedity.utils.hash2rgba($this.boxer('getcolor'),$this.boxer('getalpha'))});propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('value',Math.round($this.boxer('getalpha')*100));propbar.editor._changed()},onchangesize:function(size){var box=propbar.editor.boxes.selected();box.$this.css('border-width',size+'px');Zedity.core._call(box,'corners',box.corners())},onchangealpha:function(alpha){propbar.editor.boxes.selected().$this.css({'border-color':Zedity.utils.hash2rgba($(this).boxer('getcolor'),alpha)})},onchangecorners:function(corners,size){var ret={};for(var i=corners.length-1;i>=0;--i){ret[corners[i]]=size}Zedity.core._call(propbar.editor.boxes.selected(),'corners',ret)}})}}},rotate:{type:'button',icon:'rotate',label:'Rotate',title:'Rotate box',order:30,panel:{'class':'zedity-rotate',height:55,build:function(propbar,$panel){$panel.append('<div class="zedity-rotatewrapper">'+'<div class="zedity-sliderrotate" title="Select box rotation angle"></div>'+'</div>');$panel.find('.zedity-sliderrotate').sliderSnap({label:'Rotate',value:0,min:-180,max:180,snaps:[-90,-45,0,45,90],snaptolerance:7,slide:function(event,ui){Zedity.core._call($(this).editor().boxes.selected(),'rotation',ui.value)},change:function(event,ui){if(!event.originalEvent)return;var box=$(this).editor().boxes.refreshSelected();box.rotation(ui.value);box.propbar.open('zedity-rotate')}})}}},opacity:{type:'button',icon:'opacity',label:'Opacity',title:'Change box, background, border opacity',order:40,panel:{'class':'zedity-opacity',height:110,build:function(propbar,$panel){$panel.append('<div class="zedity-opacitywrapper">'+'<div class="zedity-sliderboxopacity" title="Select box opacity"></div>'+'<div class="zedity-sliderbgopacity" title="Select background opacity"></div>'+'<div class="zedity-sliderborderopacity" title="Select border opacity"></div>'+'</div>');$panel.find('.zedity-sliderboxopacity').sliderSnap({label:'Box opacity',min:20,max:100,value:100,change:function(event,ui){if(!event.originalEvent)return;$(this).editor()._changed()},slide:function(event,ui){var $box=$(this).editor().boxes.$selected;var val=ui.value/100;$box.children(':not(.zedity-boxoverlay)').add($box).css('opacity',val==1?'':val)}});$panel.find('.zedity-sliderbgopacity').sliderSnap({label:'Background opacity',min:0,max:100,value:100,change:function(event,ui){if(!event.originalEvent)return;$(this).editor()._changed()},slide:function(event,ui){var box=$(this).editor().boxes.selected();var fill=box.background();fill.alpha=ui.value/100;Zedity.core._call(box,'background',fill);propbar.$drawer.find('.zedity-backgroundcolor').colorPicker('selectalpha',ui.value/100)}});$panel.find('.zedity-sliderborderopacity').sliderSnap({label:'Border opacity',min:0,max:100,value:100,change:function(event,ui){if(!event.originalEvent)return;$(this).editor()._changed()},slide:function(event,ui){var $box=$(this).editor().boxes.$selected;var color=Zedity.utils.rgb2hash($box.css('border-top-color'));if(color=='transparent')color='#000000';$box.css('border-color',Zedity.utils.hash2rgba(color,ui.value/100));propbar.$drawer.find('.zedity-boxer').boxer('selectalpha',ui.value/100)}})}}},editbox:{type:'menu',icon:'box',label:'Edit',title:'Edit box',align:'right',order:1000,menu:{arrange:{label:'Arrange',icon:'arrange-backward','class':'zedity-menu-arrange',order:10,menu:{btf:{label:'Bring to front',icon:'arrange-front',onclick:function(event,propbar){propbar.editor.boxes.selected().arrange('front')}},stb:{label:'Send to back',icon:'arrange-back',onclick:function(event,propbar){propbar.editor.boxes.selected().arrange('back')}},bf:{label:'Bring forward',icon:'arrange-forward',onclick:function(event,propbar){propbar.editor.boxes.selected().arrange('forward')}},sb:{label:'Send backward',icon:'arrange-backward',onclick:function(event,propbar){propbar.editor.boxes.selected().arrange('backward')}}}},flip:{label:'Flip',icon:'flip-horizontal','class':Zedity.utils.opera()?'ui-state-disabled':'',order:20,menu:{fh:{label:'Horizontal',icon:'flip-horizontal',onclick:function(event,propbar){propbar.editor.boxes.selected().flip('horizontal')}},fv:{label:'Vertical',icon:'flip-vertical',onclick:function(event,propbar){propbar.editor.boxes.selected().flip('vertical')}}}},asbackground:{label:'Set as background',icon:'expand','class':'zedity-menu-asbackground',order:30,onclick:function(event,propbar){var box=propbar.editor.boxes.selected();if(box)box.asBackground(!box.asBackground());propbar.editor.boxes.refreshSelected();return false}},duplicate:{label:'Duplicate box',icon:'duplicate','class':'zedity-menu-duplicate',order:40,onclick:function(event,propbar){propbar.editor.boxes.selected().duplicate()}},separator:{label:'--',order:50},delete:{label:'Delete box',icon:'trash',order:60,onclick:function(event,propbar){propbar.editor.boxes.selected().remove()}}}}}}},options));return this},showPropBar:function(){var propbar=this.editor.$container.find('.zedity-propbar-'+this.type);if(propbar.length==0)return this;propbar=this.editor.propbars._getFromId(propbar.attr('id'));propbar.showBelowBox(this);return this},start:function(){return this},stop:function(){return this},reposition:function(forceinside){var ofs=0;var bb=this._boundingBox();var w=this.editor.page.size().width;var h=this.editor.page.size().height;var minpixels=10;if(forceinside||(bb.left>w)||(bb.left+bb.width<0)||(bb.top+bb.height<0)||(bb.top>h)){if(bb.left+bb.width>w){this.$this.css('left',w-bb.width+bb.dx-ofs)}else if(bb.left<0){this.$this.css('left',bb.dx-ofs)}if(bb.top+bb.height>h){this.$this.css('top',h-bb.height+bb.dy-ofs)}else if(bb.top<0){this.$this.css('top',bb.dy-ofs)}}else if((bb.left+minpixels>w)||(bb.left+bb.width-minpixels<0)||(bb.top+bb.height-minpixels<0)||(bb.top+minpixels>h)){if(bb.left+minpixels>w){this.$this.css('left',w-minpixels+bb.dx-ofs)}else if(bb.left+bb.width-minpixels<0){this.$this.css('left',bb.dx-bb.width+minpixels-ofs)}if(bb.top+minpixels>h){this.$this.css('top',h-minpixels+bb.dy-ofs)}else if(bb.top+bb.height-minpixels<0){this.$this.css('top',bb.dy-bb.height+minpixels-ofs)}}return this},arrange:function(where){if(this.asBackground())return this;where=where||'front';var group=$.makeArray(this.$this.editor().$this.children('.zedity-box:not(.zedity-background)')).sort(function(a,b){return(parseInt($(a).css('zIndex'),10)||0)-(parseInt($(b).css('zIndex'),10)||0)});if(group.length){var objidx=null;var min=10;var $this=this.$this;$(group).each(function(i,elem){this.style.zIndex=min+i*2;if($this.is(elem))objidx=i});switch(where.toLowerCase()){case'front':this.$this[0].style.zIndex=min+group.length*2;break;case'back':this.$this[0].style.zIndex=min-1;break;case'forward':this.$this[0].style.zIndex=Math.min(min+(objidx*2)+3,min+group.length*2+1);break;case'backward':this.$this[0].style.zIndex=Math.max(min+(objidx*2)-3,min-1);break;case'background':this.$this[0].style.zIndex=1;break}}this.editor._changed();return this},_resize:function(){if(this.$this.width()<this._sizeLimits().minWidth)this.$this.css('width',this._sizeLimits().minWidth);if(this.$this.width()>this._sizeLimits().maxWidth)this.$this.css('width',this._sizeLimits().maxWidth);if(this.$this.height()<this._sizeLimits().minHeight)this.$this.css('height',this._sizeLimits().minHeight);if(this.$this.height()>this._sizeLimits().maxHeight)this.$this.css('height',this._sizeLimits().maxHeight);return this},_boundingBox:function(){var theta_deg=this.rotation();Zedity.core._call(this,'rotation',0);var w=this.$this.outerWidth();var h=this.$this.outerHeight();var x=this.$this.position().left;var y=this.$this.position().top;Zedity.core._call(this,'rotation',theta_deg);var d=Math.sqrt(w*w+h*h);var t0_rad=Math.acos(w/d);var t_rad=-theta_deg*0.017453292519943295769236907684883;var r=0.5*d;var x0=x+0.5*w;var y0=y+0.5*h;var rcos_sum=r*Math.cos(t_rad+t0_rad);var rsin_sum=r*Math.sin(t_rad+t0_rad);var rcos_dif=r*Math.cos(t_rad-t0_rad);var rsin_dif=r*Math.sin(t_rad-t0_rad);var c1=Array(x0+rcos_sum,y0-rsin_sum);var c2=Array(x0-rcos_dif,y0+rsin_dif);var c3=Array(x0-rcos_sum,y0+rsin_sum);var c4=Array(x0+rcos_dif,y0-rsin_dif);var bounds={};bounds.left=Math.round(Math.min(c1[0],c2[0],c3[0],c4[0]));bounds.right=Math.round(Math.max(c1[0],c2[0],c3[0],c4[0]));bounds.top=Math.round(Math.min(c1[1],c2[1],c3[1],c4[1]));bounds.bottom=Math.round(Math.max(c1[1],c2[1],c3[1],c4[1]));bounds.width=bounds.right-bounds.left;bounds.height=bounds.bottom-bounds.top;bounds.dx=x-bounds.left;bounds.dy=y-bounds.top;return bounds},duplicate:function(){var id=Zedity.core.genId('zeb');this.editor.boxes._select(null);var $new=this.$this.clone();$new.appendTo(this.editor.$this).attr('id',id);var box=this.editor.boxes.add(this.type,{id:id,editor:this.editor});box.init();Zedity.core._call(box,'asBackground',false);$new.css({left:$new.position().left+30,top:$new.position().top+30});this.editor.boxes.refreshSelected();this.editor._changed();return box},asBackground:function(setting){var current=this.$this.hasClass('zedity-background');if(setting===current)return current;if(setting===false){var data=this.$this.zdata('boxbg')||{};this.$this.zdata('boxbg',null);this.$this.removeClass('zedity-background').css({left:data.left||this._options.x,top:data.top||this._options.y,width:data.width||this._options.width,height:data.height||this._options.height,'z-index':100,'box-sizing':''});Zedity.core._call(this,'rotation',data.rotation);Zedity.core._call(this,'arrange','front');this.reposition();this.editor._changed()}else if(setting===true){var $box=this.editor.$this.children('.zedity-background');if($box.length>0){this.editor._data.settingbackground=true;$box.each(function(idx,elem){$(elem).box().asBackground(false)});this.editor._data.settingbackground=false}this.$this.zdata('boxbg',{left:this.$this.css('left'),top:this.$this.css('top'),width:this.$this.css('width'),height:this.$this.css('height'),rotation:this.rotation()});Zedity.core._call(this,'arrange','background');Zedity.core._call(this,'rotation',0);this.$this.addClass('zedity-background').css({left:0,top:0,width:'100%',height:'100%','box-sizing':'border-box'});this.editor._changed()}else{return current}this.editor.boxes.refreshSelected();return current},rotation:function(angle){if(angle!=null){angle=Math.round(parseFloat(angle));var $this=this.$this;this.$this.attr('style',(this.$this.attr('style')||'').replace(/(?:-o-|-ms-|-moz-|-webkit-|)transform.*?;/g,''));if(angle!=0){var css='-webkit-transform:rotate('+angle+'deg);'+'-moz-transform:rotate('+angle+'deg);'+'-ms-transform:rotate('+angle+'deg);'+'-o-transform:rotate('+angle+'deg);'+'transform:rotate('+angle+'deg);';this.$this.attr('style',this.$this.attr('style')+';'+css)}this.editor._changed()}else{var ret=this.$this.css('transform')||this.$this.css('-webkit-transform')||this.$this.css('-o-transform')||this.$this.css('-moz-transform')||this.$this.css('-ms-transform');if(/rotate/.test(ret)){angle=/rotate\s*?\(\s*?(.*?)\s*?deg\s*?\)/.exec(ret);angle=angle?angle[1]:0}else if(/matrix/.test(ret)){var m=/matrix\s*?\(\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?)\s*?\)/.exec(ret);if(m){angle=Math.acos((parseFloat(m[1])+parseFloat(m[4]))/2)*57.295779513082320876798154814114;if(parseFloat(m[2])<0)angle=-angle}else{angle=0}}else{angle=0}angle=Math.round(parseFloat(angle))}return angle},background:function(fill){if(fill){var gradient='';var css='';this.$this.attr('style',(this.$this.attr('style')||'').replace(/background(-color|-image|)\s*?:.*?;/g,''));this.$this.attr('data-zedcssbuffer',(this.$this.attr('data-zedcssbuffer')||'').replace(/background(-color|-image|)\s*?:.*?;/g,''));switch(fill.type.toLowerCase()){case'solid':css='background-color:'+Zedity.utils.hash2rgba(fill.colors[0],fill.alpha)+';';break;case'horizontal':gradient=Zedity.utils.hash2rgba(fill.colors[0],fill.alpha)+' 0%,'+Zedity.utils.hash2rgba(fill.colors[1],fill.alpha)+' 100%);';css='background-image:-webkit-linear-gradient(left,'+gradient+'background-image:-moz-linear-gradient(left,'+gradient+'background-image:-ms-linear-gradient(left,'+gradient+'background-image:-o-linear-gradient(left,'+gradient+'background-image:linear-gradient(to right,'+gradient;break;case'vertical':gradient=Zedity.utils.hash2rgba(fill.colors[0],fill.alpha)+' 0%,'+Zedity.utils.hash2rgba(fill.colors[1],fill.alpha)+' 100%);';css='background-image:-webkit-linear-gradient(top,'+gradient+'background-image:-moz-linear-gradient(top,'+gradient+'background-image:-ms-linear-gradient(top,'+gradient+'background-image:-o-linear-gradient(top,'+gradient+'background-image:linear-gradient(to bottom,'+gradient;break;case'radial':gradient=Zedity.utils.hash2rgba(fill.colors[0],fill.alpha)+' 0%,'+Zedity.utils.hash2rgba(fill.colors[1],fill.alpha)+' 100%);';css='background-image:-webkit-radial-gradient(center,ellipse cover,'+gradient+'background-image:-moz-radial-gradient(center,ellipse cover,'+gradient+'background-image:-ms-radial-gradient(center,ellipse cover,'+gradient+'background-image:-o-radial-gradient(center,ellipse cover,'+gradient+'background-image:radial-gradient(ellipse at center,'+gradient;break}this.$this.attr('style',this.$this.attr('style')+';'+css);this.$this.attr('data-zedcssbuffer',this.$this.attr('data-zedcssbuffer')+';'+css);this.editor._changed();return fill}else{var param='(?:((?!rgb|#|hsl).*?),)?';var color='\\s*(.*?)\\s*\\d*(?:%|px)';var rxlg=new RegExp('linear-gradient\\('+param+color+','+color+'\\)');var rxrg=new RegExp('radial-gradient\\('+param+'\\s*'+param+color+','+color+'\\)');var bg=(this.$this.attr('data-zedcssbuffer')||this.$this.attr('style')||'').toLowerCase();if(bg.indexOf('background-image')>-1){bg=bg.replace(/.*?(background-image:.*?;).*/,'$1')}else{bg='none'}if(bg&&bg.toLowerCase()!='none'){var cfill={};var match=null;if(match=rxlg.exec(bg)){switch((match[1]||'').toLowerCase()){case'left':cfill.type='horizontal';break;case'top':default:cfill.type='vertical';break}cfill.colors=[Zedity.utils.rgb2hash(match[2]),Zedity.utils.rgb2hash(match[3])];return cfill}else if(match=rxrg.exec(bg)){cfill.type='radial';cfill.colors=[Zedity.utils.rgb2hash(match[3]),Zedity.utils.rgb2hash(match[4])];return cfill}}else{bg=(this.$this.css('background-color')||'transparent').toLowerCase();if(bg.charAt(0)=='#'){return{type:'solid',alpha:1,colors:[bg]}}else if(bg.substr(0,3)=='rgb'){var color=Zedity.utils.rgb2hash(bg);return{type:'solid',alpha:color=='transparent'?1:(Zedity.utils.rgba2alpha(bg)||1),colors:[color]}}}return{type:'solid',alpha:1,colors:['transparent']}}},flip:function(flip){var $content=this.$this.children('.zedity-content,.zedity-empty');if($content.length==0){this.editor._error({message:'Unexpected error: box has no content.'});return'none'}if(flip!=null){flip=flip.toLowerCase();var curflip=this.flip();var corners=this.corners();$content.attr('style',($content.attr('style')||'').replace(/(?:-o-|-ms-|-moz-|-webkit-|)transform.*?;/g,''));var scale='';switch(flip.substr(0,3)){case'hor':switch(curflip.substr(0,3)){case'hor':scale='';break;case'ver':scale='scale(-1);';break;case'bot':scale='scaleY(-1);';break;default:scale='scaleX(-1);';break}break;case'ver':switch(curflip.substr(0,3)){case'hor':scale='scale(-1);';break;case'ver':scale='';break;case'bot':scale='scaleX(-1);';break;default:scale='scaleY(-1);';break}break;case'bot':switch(curflip.substr(0,3)){case'bot':scale='';break;default:scale='scale(-1);';break}break}var css='-webkit-transform:'+scale+'-moz-transform:'+scale+'-ms-transform:'+scale+'-o-transform:'+scale+'transform:'+scale;if(scale)$content.attr('style',$content.attr('style')+';'+css);Zedity.core._call(this,'corners',corners);this.editor._changed()}var f='none';var ret=$content.css('transform')||$content.css('-webkit-transform')||$content.css('-o-transform')||$content.css('-moz-transform')||this.$this.css('-ms-transform');if(/scale/.test(ret)){f=/scale(X|Y|)\s*?\(\s*?-1\s*?\)/.exec(ret);f=f?f[1]:'none'}else if(/matrix/.test(ret)){var m=/matrix\s*?\(\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?),\s*?(.*?)\s*?\)/.exec(ret);if(m){var m1=parseFloat(m[1]);var m4=parseFloat(m[4]);if(m1==-1&&m4==1){f='X'}else if(m1==1&&m4==-1){f='Y'}else if(m1==-1&&m4==-1){f=''}}}switch(f){case'X':return'horizontal';case'Y':return'vertical';case'':return'both';case'none':default:return'none'}},corners:function(corners){function switchCorners(corners,flip){var t;if(flip=='hor'||flip=='bot'){t=corners['border-top-left-radius'];corners['border-top-left-radius']=corners['border-top-right-radius'];corners['border-top-right-radius']=t;t=corners['border-bottom-left-radius'];corners['border-bottom-left-radius']=corners['border-bottom-right-radius'];corners['border-bottom-right-radius']=t}if(flip=='ver'||flip=='bot'){t=corners['border-top-left-radius'];corners['border-top-left-radius']=corners['border-bottom-left-radius'];corners['border-bottom-left-radius']=t;t=corners['border-top-right-radius'];corners['border-top-right-radius']=corners['border-bottom-right-radius'];corners['border-bottom-right-radius']=t}return corners};function neg(corners){var newcorners={};for(var corner in corners){if(corners.hasOwnProperty(corner)&&(parseInt(corners[corner])>0)){newcorners[corner]=''}}return newcorners};var flip=this.flip().substr(0,3).toLowerCase();if(corners){corners=switchCorners(corners,flip);var css='';for(var corner in corners){if(corners.hasOwnProperty(corner)&&(parseInt(corners[corner])>=0)){this.$this.attr('style',(this.$this.attr('style')||'').replace(new RegExp(corner+':.*?(?:;|$)',''),''));css+=corner+':'+parseInt(corners[corner])+'px;'}}this.$this.attr('style',this.$this.attr('style')+';'+css);var offset=parseInt(this.$this.css('border-top-width'));offset=offset||0;if(offset>0){for(var i in corners){if(isNaN(corners[i]))corners[i]=parseInt(corners[i]||'0');corners[i]-=(offset+1);if(corners[i]<0)corners[i]=0}}corners=switchCorners(corners,flip);var $content=this.$this.children('.zedity-empty,.zedity-content');var css='';for(var corner in corners){if(corners.hasOwnProperty(corner)&&(parseInt(corners[corner])>=0)){$content.attr('style',($content.attr('style')||'').replace(new RegExp(corner+':.*?(?:;|$)','g'),''));css+=corner+':'+parseInt(corners[corner])+'px;'}}$content.attr('style',$content.attr('style')+';'+css);this.$this.trigger('corners.zedity');this.editor._changed()}corners=this.$this.getCss(['border-top-left-radius','border-top-right-radius','border-bottom-left-radius','border-bottom-right-radius']);return switchCorners(corners,flip)},remove:function(){if(!this.$this)return this;if(this.$this.hasClass('zedity-selected'))this.editor.boxes._select(null);this.$this.remove();this.$this=null;this.editor._changed();return this},destroy:function(){Zedity.core._call(this,'remove');for(var i=this.editor.boxes._boxes.length-1;i>=0;--i){if(this.editor.boxes._boxes[i].id==this.id){this.editor.boxes._boxes.splice(i,1);return this}}return this}});Zedity.Box.types=[];Zedity.Box.register=function(options){var defaults={type:undefined,requires:[]};options=$.extend({},defaults,options);if(!options.type)throw new Error('Box type not supplied during registration.');for(var i=options.requires.length-1;i>=0;--i){if(Zedity.core.supports.hasOwnProperty(options.requires[i])&&!Zedity.core.supports[options.requires[i]]())return false}Zedity.Box.types.push(options.type)}})(jQuery);(function($){Zedity.utils=Zedity.utils||{};Zedity.utils.cleanText=function(text){var invalidChars=/[^\w\s\u0020-\ud7ff\ue000-\uffdd\u10000-\u10ffff]/g;return $.trim(text.replace(invalidChars,'').replace(/\s+/g,' '))}})(jQuery);(function($){$.fn.getCss=function(styles,inherited){var $this=$(this);var css={};if(typeof(styles)=='string')styles=styles.split(' ');for(var i=styles.length-1;i>=0;--i){if(inherited){if($this.css(styles[i])){css[styles[i]]=$this.css(styles[i])}}else{if($this.prop('style')[$.camelCase(styles[i])]){css[styles[i]]=$this.prop('style')[$.camelCase(styles[i])]}}}return css};$.fn.multiDraggable=function(options){var initLeftOffset=[];var initTopOffset=[];options=$.extend(options,{start:function(event,ui){initLeftOffset=[0];initTopOffset=[0];if($(options.group).length>1){var pos=$(this).position();$(options.group).draggable('option','snap',false).each(function(idx,elem){var elemPos=$(elem).position();initLeftOffset[idx]=elemPos.left-pos.left;initTopOffset[idx]=elemPos.top-pos.top})}if(typeof options.startNative=='function')options.startNative.call(this,event,ui)},drag:function(event,ui){var pos=$(this).offset();$(options.group).each(function(idx,elem){$(elem).addClass('ui-draggable-dragging').offset({left:pos.left+initLeftOffset[idx],top:pos.top+initTopOffset[idx]})});if(typeof options.dragNative=='function')options.dragNative.call(this,event,ui)},stop:function(event,ui){var pos=$(this).offset();$(options.group).each(function(idx,elem){$(elem).removeClass('ui-draggable-dragging').offset({left:pos.left+initLeftOffset[idx],top:pos.top+initTopOffset[idx]})});if(typeof options.stopNative=='function')options.stopNative.call(this,event,ui)}});$(this).draggable(options);return this};$.ui.plugin.add('draggable','snapFeedback',{drag:function(event,ui){var inst=$(this).data('ui-draggable');if(!inst.snapElements)return;for(var i=inst.snapElements.length-1;i>=0;--i){if(inst.snapElements[i].snapping){$(inst.snapElements[i].item).stop().addClass('zedity-snapped').delay(1000).queue(function(next){$(this).removeClass('zedity-snapped');next()})}else{$(inst.snapElements[i].item).stop().removeClass('zedity-snapped')}}}});$.ui.plugin.add('draggable','reposition',{start:function(event,ui){var $obj=$(this);var bb=$obj.box()._boundingBox();$obj.data('ui-draggable').offset.click.left-=bb.dx;$obj.data('ui-draggable').offset.click.top-=bb.dy}});$.ui.plugin.add('resizable','reposition',{start:function(event,ui){var $obj=$(this);var bb=$obj.box()._boundingBox();$obj.data('ui-resizable').position.left+=bb.dx;$obj.data('ui-resizable').position.top+=bb.dy}});$.widget('ui.sliderSnap',$.ui.slider,{options:{label:'',snaps:[],snaptolerance:5},_create:function(){this.element.text(this.options.label);$.ui.slider.prototype._create.apply(this,arguments)},_refreshValue:function(){$.ui.slider.prototype._refreshValue.apply(this,arguments);this.handles.eq(0).text(this.value())},_slide:function(event,index,newVal){if(event.type=='mousemove'){for(var snap=this.options.snaps.length-1;snap>=0;--snap){if(Math.abs(newVal-this.options.snaps[snap])<this.options.snaptolerance){newVal=this.options.snaps[snap];break}}}$.ui.slider.prototype._slide.apply(this,arguments)}});$.widget('ui.tabs',$.ui.tabs,{selected:function(id){var idx;var $this=$(this.element);if(id){var idx=$this.find('a[href="#'+id+'"]').parent().index();$this.tabs('option','active',idx)}else{idx=$this.tabs('option','active');return $this.find('a.ui-tabs-anchor').eq(idx).attr('href').replace('#','')}}})})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.PropBar needs Zedity.');Zedity.PropBar=function(options){var defaults={minWidth:200};options=$.extend({},defaults,options);this.type=options.type;this.id=Zedity.core.genId('zepb');this.editor=options.editor;if(this.editor.$container.find('.zedity-propbar-'+this.type).length>0)throw new Error('PropBar of '+this.type+' type already exists.');this.editor.$container.append($('<div/>',{id:this.id,'class':'zedity-propbar zedity-propbar-'+this.type,css:{'min-width':options.minWidth},html:$('<div/>',{'class':'zedity-drawer'})}));this.$this=this.editor.$container.find('#'+this.id);this.$drawer=this.$this.find('.zedity-drawer');for(var bar in options.bars){if(!options.bars.hasOwnProperty(bar))continue;this.$this.append('<div class="zedity-bar"/>');var $bar=this.$this.find('.zedity-bar').last();var actions=[];for(var action in options.bars[bar]){if(!options.bars[bar].hasOwnProperty(action)||!options.bars[bar][action])continue;actions.push({key:action,val:options.bars[bar][action].order||0});actions.sort(function(a,b){return a.val-b.val})}for(var i=0,len=actions.length;i<len;++i){this._createAction($bar,options.bars[bar][actions[i].key])}}this.$bars=this.$this.find('.zedity-bar');this.$bars.first().show()};$.extend(Zedity.PropBar.prototype,{_createAction:function($bar,options){var zthis=this;switch((options.type||'').toLowerCase()){case'button':var $button=$('<span/>',{'class':'zedity-button '+(options['class']||'')+(options.icon?' zedity-has-icon':''),title:options.title,html:$('<a/>',{href:'javascript:;','class':options.icon?'zedity-bar-icon zedity-icon-'+options.icon:'',html:options.label}),'data-panel':options.panel?options.panel['class']:undefined,css:{'float':options.align||'left'}}).on('click.propbar',function(event){if($(this).hasClass('zedity-disabled'))return false;if(options.panel){zthis.toggle(options.panel['class'])}if(typeof options.onclick=='function')options.onclick.call(this,event,zthis)});$bar.append($button);if(options.panel){var $panel=$('<div/>',{'class':'zedity-panel '+options.panel['class']+(options.panel.scrollable?' zedity-scrollable':'')}).data({'height':options.panel.height});this.$drawer.append($panel);if(typeof options.panel.build=='function')options.panel.build.call(this,this,$panel,options.panel)}break;case'toggle':if(options.state.lenght<2)return;var $toggle=$('<span/>',{'class':'zedity-button '+(options['class']||'')+(options.state[0].icon?' zedity-has-icon':''),title:options.state[0].title,html:$('<a/>',{href:'javascript:;','class':options.state[0].icon?'zedity-bar-icon zedity-icon-'+options.state[0].icon:'',html:options.state[0].label}),'data-state':0,css:{'float':options.align||'left'}}).on('click.propbar',function(event){var $this=$(this);if($this.hasClass('zedity-disabled'))return false;var state=$this.data('state');var before=parseInt($this.attr('data-state')||0);var after=(before+1)%state.length;$(this).trigger('toggle.propbar');if(typeof options.onclick=='function')options.onclick.call(this,event,zthis,before,after)}).on('toggle.propbar',function(event,setstate){var $this=$(this);if($this.hasClass('zedity-disabled'))return false;var state=$this.data('state');var before=parseInt($this.attr('data-state')||0);var after=setstate!=null?setstate:(before+1)%state.length;$this.attr('title',state[after].title).attr('data-state',after).find('a').text(state[after].label);if(state[before].icon){$this.find('a').removeClass('zedity-icon-'+state[before].icon).addClass('zedity-icon-'+state[after].icon)}return false}).data('state',options.state);$bar.append($toggle);break;case'menu':function buildMenu(menu){var actions=[];for(var action in menu){if(!menu.hasOwnProperty(action)||!menu[action])continue;actions.push({key:action,val:menu[action].order||0});actions.sort(function(a,b){return a.val-b.val})}var $menu=$('<ul/>',{'class':'zedity-propbar-menu',css:{display:'none'}});for(var i=0,len=actions.length;i<len;++i){var item=menu[actions[i].key];if(item.label=='--'){item['class']=(item['class']||'')+' ui-state-disabled zedity-separator'}if(item.hasOwnProperty('menu')){var $submenu=buildMenu(item.menu);$('<li/>',{'class':item['class']||''}).append($('<a/>',{href:'javascript:;',html:(item.icon?'<span class="zedity-menu-icon zedity-icon-'+item.icon+'"/>':'')+item.label})).append($submenu).appendTo($menu)}else{$('<li/>',{'class':item['class']||'',html:$('<a/>',{href:'javascript:;',html:(item.icon?'<span class="zedity-menu-icon zedity-icon-'+item.icon+'"/>':'')+item.label}).on('click.propbar',function(event){$menu.hide();var onclick=$(this).data('item-onclick');if(typeof onclick=='function')onclick.call(this,event,zthis)}).data('item-onclick',item.onclick)}).appendTo($menu)}}return $menu};var $menu=buildMenu(options.menu);$menu.attr('id',Zedity.core.genId('pbmenu')).menu().appendTo(zthis.$this);var $menubutton=$('<span/>',{'class':'zedity-button zedity-menu '+(options['class']||'')+(options.icon?' zedity-has-icon':''),title:options.title,html:$('<span/>',{html:$('<a/>',{href:'javascript:;','class':options.icon?'zedity-bar-icon zedity-icon-'+options.icon:'',html:options.label}),}),'data-panel':options.panel?options.panel['class']:undefined,css:{'float':options.align||'left'}}).on('click.propbar',function(event){var $this=$(this);if($this.hasClass('zedity-disabled'))return false;$menu.toggle().siblings('.zedity-propbar-menu').hide();if($menu.is(':visible')){$menu.css({left:$this.position().left,top:$this.position().top+$this.parent().outerHeight()})}return false});$bar.append($menubutton);break;case'separator':$bar.append($('<span/>',{'class':'zedity-separator',css:{'float':options.align||'left'}}));break}return this},_menuGroup:function(group,item){this.$this.find('.'+group).each(function(idx,elem){var $elem=$(elem);$elem.find('.zedity-menu-icon').toggleClass('zedity-icon-yes',$elem.hasClass(item)).toggleClass('zedity-icon-empty',!$elem.hasClass(item))})},_menuToggle:function(item,value){var $elem=this.$this.find('.'+item).find('.zedity-menu-icon');if(value==null){$elem.toggleClass('zedity-icon-yes').toggleClass('zedity-icon-empty')}else{$elem.toggleClass('zedity-icon-yes',value).toggleClass('zedity-icon-empty',!value)}},showBelowBox:function(box){this.editor.propbars.hideall();this.showBar(0);var bb=box._boundingBox();var width=this.$this.outerWidth();var offset={left:this.editor.$this.offset().left-this.editor.$container.offset().left,top:this.editor.$this.offset().top-this.editor.$container.offset().top};var left=bb.left-Math.round(width/2-bb.width/2);var top=bb.top+bb.height+3;if(left+width>box.editor.$this.outerWidth())left=box.editor.$this.outerWidth()-width;if(left<0)left=0;if(top>box.editor.$this.outerHeight())top=box.editor.$this.outerHeight();this.$this.css({left:(left+offset.left)+'px',top:(top+offset.top)+'px',width:width+'px'}).show();return this},showBar:function(idx){this.close();this.$this.find('.zedity-bar').eq(idx).show().siblings('.zedity-bar').hide();this.$this.find('.zedity-propbar-menu').hide();return this},close:function(){this.$drawer.css('height',0).find('.zedity-panel').hide().removeClass('zedity-open');this.$bars.find('.zedity-button[data-panel]').removeClass('zedity-pressed zedity-open');return this},open:function(panel){var $panel=this.$drawer.find('.zedity-panel.'+panel);this.$drawer.css('height',$panel.data('height'));$panel.show().addClass('zedity-open').scrollTop(0).siblings().hide().removeClass('zedity-open');this.$bars.find('.zedity-button[data-panel]').removeClass('zedity-pressed zedity-open');this.$bars.find('.zedity-button[data-panel="'+panel+'"]').addClass('zedity-pressed zedity-open');return this},toggle:function(panel){var $panel=this.$drawer.find('.zedity-panel.'+panel);if($panel.hasClass('zedity-open')){this.close();this.$bars.find('.zedity-button[data-panel]').removeClass('zedity-pressed zedity-open')}else{this.open(panel);this.$bars.find('.zedity-button[data-panel="'+panel+'"]').addClass('zedity-pressed zedity-open')}return this},hide:function(){this.close();this.$this.hide();return this}});$('html,body').off('click.propbarmenu').on('click.propbarmenu',function(event){if($(event.target).closest('.zedity-propbar-menu').length>0)return;$('.zedity-propbar-menu').hide()})})(jQuery);(function($){Zedity.utils=Zedity.utils||{};Zedity.utils.dec2hex=function(num,padding){num=Number(num);if(num<0)num=0xffffffff+num+1;padding=padding==null?2:padding;return(new Array(padding).join('0')+num.toString(16)).substr(-padding)};Zedity.utils.rgb2hash=function(color){if(!color)return undefined;if(!isNaN(color))return color;color=$.trim(color);var rgb,match;if(color.indexOf('rgba')!=-1){rgb=/rgba\s*\((.*)\s*,\s*(.*)\s*,\s*(.*)\s*,\s*(.*)\s*\)/i;match=rgb.exec(color);if(match&&match.length==5){if(match[1]=='0'&&match[2]=='0'&&match[3]=='0'&&match[4]=='0'){return'transparent'}else{return'#'+this.dec2hex(match[1])+this.dec2hex(match[2])+this.dec2hex(match[3])}}}if(color.indexOf('rgb')!=-1){rgb=/rgb\s*\((.*)\s*,\s*(.*)\s*,\s*(.*)\s*\)/i;match=rgb.exec(color);if(match&&match.length==4)return'#'+this.dec2hex(match[1])+this.dec2hex(match[2])+this.dec2hex(match[3])}return color};Zedity.utils.rgba2alpha=function(color){if(!color)return undefined;if(!isNaN(color))return undefined;var rgba=/rgba\s*\((.*)\s*,\s*(.*)\s*,\s*(.*)\s*,\s*(.*)\s*\)/i;if(color.indexOf('rgba')!=-1){var match=rgba.exec(color);if(match&&match.length==5){return match[4]}}return undefined};Zedity.utils.hash2rgba=function(hash,alpha){if(typeof(hash)!='string'||hash.charAt(0)!='#')return hash;var hex=parseInt(hash.substring(1),16);if(alpha===undefined||alpha<0||alpha>1)alpha=1;return'rgba('+((hex&0xff0000)>>16)+','+((hex&0x00ff00)>>8)+','+(hex&0x0000ff)+','+alpha+')'};Zedity.utils.hash2rgb=function(hash){if(typeof(hash)!='string'||hash.charAt(0)!='#')return hash;var hex=parseInt(hash.substring(1),16);return'rgb('+((hex&0xff0000)>>16)+','+((hex&0x00ff00)>>8)+','+(hex&0x0000ff)+')'}})(jQuery);(function($){$.fn.colorPicker=function(method){var methods={init:function(options){var settings={colors:['#ffffff','#c0c0c0','#808080','#000000','#ff0000','#800000','#ffff00','#808000','#00ff00','#008000','#00ffff','#008080','#0000ff','#000080','#ff00ff','#800080'],defaultcolor:0,fills:false,alpha:false,buttons:false,onchange:function(event,color,fill,alpha){},onchangealpha:function(event,alpha){},boxwidth:18,maxcols:0};if(options)$.extend(settings,options);settings.fills=Zedity.core.supports.gradient()?settings.fills:false;return this.each(function(){var $cp=$(this);$cp.data('colorPicker',{colors:settings.colors,onchange:settings.onchange,fills:settings.fills,alpha:settings.alpha});var colors='';for(var i=0;i<settings.colors.length;i++){var clear=((i%settings.maxcols)==0?';clear:both':'');var check=(i==settings.defaultcolor?' zedity-check':'');if(settings.colors[i]=='transparent'){colors+='<div class="zedity-color transparent'+check+'" style="width:'+settings.boxwidth+'px;height:'+settings.boxwidth+'px'+clear+'">'+'<a href="javascript:void(0)" title="transparent">&nbsp;&nbsp;&nbsp;</a>'+'</div>'}else{colors+='<div class="zedity-color'+check+'" style="width:'+settings.boxwidth+'px;height:'+settings.boxwidth+'px;background-color:'+settings.colors[i]+clear+'">'+'<a href="javascript:void(0)" title="'+settings.colors[i]+'">&nbsp;&nbsp;&nbsp;</a>'+'</div>'}}var colorbuttons='';if(settings.buttons){colorbuttons='<div class="zedity-colorbuttons">'+'<span class="zedity-label">Current color: </span>'+'<span title="Click to set Hex color" class="zedity-colorbtnhex zedity-button"><a href="javascript:;"></a></span>'+'<span title="Click to set RGB color" class="zedity-colorbtnrgb zedity-button"><a href="javascript:;"></a></span>'+'</div>'}var colortype='';if(settings.fills){colortype='<div class="zedity-colortype">'+'<select class="zedity-colortype">'+'<option value="solid" class="zedity-solid">Solid color</option>'+'<option value="horizontal" class="zedity-horizontal">Horiz. gradient</option>'+'<option value="vertical" class="zedity-vertical">Vert. gradient</option>'+'<option value="radial" class="zedity-radial">Radial gradient</option>'+'</select>'+'<span class="zedity-colorbtn zedity-color1 zedity-selected'+(settings.colors[settings.defaultcolor||0]=='transparent'?' transparent':'')+'" style="background-color:'+settings.colors[settings.defaultcolor||0]+'"></span>'+'<span class="zedity-gradient zedity-ctpnl" style="display:none">'+'<span class="zedity-colorbtn zedity-color2"></span>'+'</span>'+'</div>'}var coloralpha='';if(settings.alpha){coloralpha='<div class="zedity-coloralpha"><div class="zedity-slideralpha" title="Select color opacity"></div></div>'}$cp.append('<div class="zedity-colorpicker">'+colortype+coloralpha+colorbuttons+'<div class="zedity-colors">'+colors+'</div>'+'</div>');var $color=$cp.find('.zedity-colorpicker div.zedity-color');$color.each(function(idx){$(this).children('a').on('click.colorPicker',function(event){$color.removeClass('zedity-check');$(this).parent().addClass('zedity-check');$cp.colorPicker('selectcolor',settings.colors[idx],true);return false})});if(settings.fills){$cp.find('select.zedity-colortype').on('change.colorPicker',function(event,onlyui){var $gr=$cp.find('.zedity-gradient');if($(this).val()!='solid'){$gr.show()}else{$gr.hide();$cp.find('.zedity-colortype .zedity-colorbtn').removeClass('zedity-selected');$cp.find('.zedity-colortype .zedity-colorbtn.zedity-color1').addClass('zedity-selected')}if(onlyui)return false;if(typeof(settings.onchange)=='function'){var color=$cp.colorPicker('getcolor');var fill=$cp.colorPicker('getfill');var alpha=$cp.colorPicker('getalpha');settings.onchange.call($cp[0],event,color,fill,alpha)}})}if(settings.buttons){$cp.find('.zedity-colorbtnhex').on('click.zedity',function(){Zedity.core.selection.save();var color=$cp.colorPicker('getcolor');Zedity.core.dialog({title:'Set custom color (Hex)',default:color,question:'Please enter the color in hex format, e.g. #F31267',mandatory:'You must enter a color.',ok:function(answer){if(answer!='transparent'&&answer.indexOf('#')==-1)answer='#'+answer;$cp.colorPicker('selectcolor',answer,true)}})});$cp.find('.zedity-colorbtnrgb').on('click.zedity',function(){Zedity.core.selection.save();var color=$cp.colorPicker('getcolor');Zedity.core.dialog({title:'Set custom color (RGB)',default:Zedity.utils.hash2rgb(color).replace('rgb(','').replace(')',''),question:'Please enter the color in RGB format, with comma-separated components, e.g. 240,18,103',mandatory:'You must enter a color.',ok:function(answer){if(answer!='transparent')answer='rgb('+answer+')';$cp.colorPicker('selectcolor',Zedity.utils.rgb2hash(answer),true)}})})}if(settings.alpha){$cp.find('.zedity-slideralpha').sliderSnap({label:'Opacity',value:100,min:0,max:100,slide:function(event,ui){if(typeof(settings.onchangealpha)=='function'){settings.onchangealpha.call($cp[0],event,ui.value/100)}},change:function(event,ui){if(!event.originalEvent)return false;if(typeof(settings.onchange)=='function'){var color=$cp.colorPicker('getcolor');var fill=$cp.colorPicker('getfill');settings.onchange.call($cp[0],event,color,fill,ui.value/100)}}})}$cp.find('.zedity-colortype .zedity-colorbtn').on('click.colorPicker',function(event){$cp.find('.zedity-colortype .zedity-colorbtn').removeClass('zedity-selected');var $this=$(this);$this.addClass('zedity-selected');$cp.colorPicker('selectcolor',$this.css('background-color'))})});return this},getcolor:function(){var data=$(this).data('colorPicker');return data.selected},getfill:function(){var $cp=$(this);var data=$cp.data('colorPicker');if(!data.fills){return{type:'solid',alpha:$cp.colorPicker('getalpha'),colors:[$cp.colorPicker('getcolor')]}}var fill={type:$cp.find('select.zedity-colortype').val(),alpha:$cp.colorPicker('getalpha'),colors:[]};fill.colors.push(Zedity.utils.rgb2hash($cp.find('.zedity-colortype .zedity-color1').css('background-color')));if($cp.find('select.zedity-colortype').val()!='solid'){fill.colors.push(Zedity.utils.rgb2hash($cp.find('.zedity-colortype .zedity-color2').css('background-color')))}return fill},getalpha:function(){var $cp=$(this);var data=$cp.data('colorPicker');if(!data.alpha)return 1;return $cp.find('.zedity-slideralpha').sliderSnap('option','value')/100},refresh:function(){var $cp=$(this);var color=$cp.colorPicker('getcolor');$cp.find('.zedity-colorbtnhex a').text(color);$cp.find('.zedity-colorbtnrgb a').text(Zedity.utils.hash2rgb(color));$cp.find('.zedity-colortype .zedity-colorbtn.zedity-selected').css('background-color',color).toggleClass('transparent',color=='transparent')},selectcolor:function(color,triggerevent){return this.each(function(){var $cp=$(this);var data=$cp.data('colorPicker');var alpha=undefined;var c='';if(color!=parseInt(color)){var $fc=$('<div/>').css('color',color);color=$fc.css('color');if(color.indexOf('rgb')>-1){alpha=Zedity.utils.rgba2alpha(color);c=Zedity.utils.rgb2hash(color);color=data.colors.indexOf(c)}else if(color.charAt(0)=='#'||color=='transparent'){c=color;color=data.colors.indexOf(c)}else{return}}$cp.find('.zedity-colorpicker div.zedity-color').removeClass('zedity-check');if(alpha!=undefined&&c!='transparent')$cp.colorPicker('selectalpha',alpha);if(c=='transparent')$cp.colorPicker('selectalpha',1);if(color>=0&&color<data.colors.length){$cp.find('.zedity-colorpicker div.zedity-color:nth-child('+(color+1)+')').addClass('zedity-check')}data.selected=c;$cp.colorPicker('refresh');if(triggerevent){if(typeof(data.onchange)=='function'){var fill=$cp.colorPicker('getfill');var alpha=$cp.colorPicker('getalpha');data.onchange.call($cp[0],null,c,fill,alpha)}}})},selectfill:function(fill,triggerevent){return this.each(function(){if(!fill)return;var $cp=$(this);var data=$cp.data('colorPicker');if(!data.fills)return;fill.colors=fill.colors||['#000000'];fill.colors=[].concat(fill.colors);fill.type=fill.type||(fill.colors.length==1?'solid':'horizontal');fill.alpha=('alpha'in fill?fill.alpha:1);$cp.find('.zedity-color1').css('background-color',fill.colors[0]).toggleClass('transparent',fill.colors[0]=='transparent');if(fill.type!='solid'){$cp.find('.zedity-color2').css('background-color',fill.colors[1]).toggleClass('transparent',fill.colors[1]=='transparent')}if(data.alpha){$cp.find('.zedity-slideralpha').sliderSnap('option','value',Math.round(fill.alpha*100))}$cp.find('select.zedity-colortype').val(fill.type).trigger('change.colorPicker',[true]);$cp.find('div.zedity-colortype .zedity-color1').trigger('click.colorPicker');if(triggerevent){$cp.find('select.zedity-colortype').trigger('change.colorPicker')}})},selectalpha:function(alpha,triggerevent){var $cp=$(this);var data=$cp.data('colorPicker');alpha=alpha<=1?Math.round(alpha*100):alpha;var $slider=$cp.find('.zedity-slideralpha');$slider.sliderSnap('option','value',alpha);if(triggerevent){$slider.trigger('change')}},destroy:function(){return this.each(function(){var $cp=$(this);$cp.data('colorPicker').target.remove();$cp.off('.colorPicker');$cp.removeData('colorPicker')})}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on jQuery.colorPicker')}};$.fn.boxer=function(method){var sizes=[0,1,2,3,4,5];var styles=['solid','dashed','dotted','double','groove','ridge','inset','outset'];var colors=['#ffffff','#f2f2f2','#d8d8d8','#bdbdbd','#a4a4a4','#6e6e6e','#424242','#2e2e2e','#000000','#fbefef','#f8e0e0','#f5a9a9','#f78181','#fe2e2e','#df0101','#b40404','#8a0808','#3b0b0b','#fbf5ef','#f8ece0','#f5d0a9','#faac58','#ff8000','#df7401','#b45f04','#8a4b08','#3b240b','#fbfbef','#f5f6ce','#f2f5a9','#f4fa58','#ffff00','#d7df01','#aeb404','#868a08','#393b0b','#f5fbef','#e3f6ce','#d0f5a9','#acfa58','#80ff00','#74df00','#5fb404','#4b8a08','#38610b','#effbef','#cef6ce','#a9f5a9','#58fa58','#00ff00','#01df01','#04b404','#088a08','#0b3b0b','#effbfb','#cef6f5','#a9f5f2','#58faf4','#00ffff','#01dfd7','#04b4ae','#088a85','#0b3b39','#eff5fb','#cee3f6','#81bef7','#2e9afe','#0080ff','#045fb4','#084b8a','#084b8a','#0b243b','#efeffb','#cecef6','#5858fa','#2e2efe','#0000ff','#0404b4','#08088a','#0b0b61','#0b0b3b','#f5effb','#e3cef6','#be81f7','#ac58fa','#9a2efe','#5f04b4','#4b088a','#380b61','#240b3b','#fbeffb','#f6cef5','#f781f3','#fe2ef7','#ff00ff','#df01d7','#b404ae','#610b5e','#3b0b39','#fbeff5','#f6cee3','#f5a9d0','#fa58ac','#ff0080','#df0174','#b4045f','#610b38','#3b0b24'];var methods={init:function(options){var settings={order:'corners,size,style,color',sizes:sizes,styles:styles,colors:colors,colorButtons:false,defaultsize:sizes[0],defaultstyle:styles[0],defaultcolor:colors[8],curtain:null,onchange:function(){},onchangecorners:function(corners,size){},onchangesize:function(size){},onchangestyle:function(style){},onchangepadding:function(padding){},onchangecolor:function(color){},onchangealpha:function(event,alpha){}};if(options)$.extend(settings,options);return this.each(function(){var $sel=$('<div class="zedity-boxer"/>').appendTo($(this));$sel.data('boxer',{colors:settings.colors,height:$sel.height(),onchange:settings.onchange,onchangecorners:settings.onchangecorners});var data=$sel.data('boxer');var $radiusselector;var $sizeselector;var $styleselector;var $paddingselector;$.each(settings.order.split(','),function(idx,item){switch(item){case'corners':$sel.append('<div class="zedity-radiusselector" title="Rounded corners"></div>'+'<div class="zedity-cornersselector">'+'<div class="zedity-corner zedity-cornertopleft" title="Top left corner" data-cornertype="border-top-left-radius"></div>'+'<div class="zedity-corner zedity-cornertopright" title="Top right corner" data-cornertype="border-top-right-radius"></div>'+'<div class="zedity-corner zedity-cornerbottomleft" title="Bottom left corner" data-cornertype="border-bottom-left-radius"></div>'+'<div class="zedity-corner zedity-cornerbottomright" title="Bottom right corner" data-cornertype="border-bottom-right-radius"></div>'+'</div>');$sel.find('.zedity-corner').on('click.boxer',function(){$(this).toggleClass('zedity-selected')});$radiusselector=$sel.find('.zedity-radiusselector');$radiusselector.sliderSnap({label:'Corners',value:0,min:0,max:300,slide:function(event,ui){var corners=[];$sel.find('.zedity-cornersselector .zedity-corner').each(function(idx,elem){var $elem=$(elem);if($elem.hasClass('zedity-selected')){corners.push($elem.attr('data-cornertype'))}});if(typeof(settings.onchangecorners)=='function')settings.onchangecorners.call($sel,corners,ui.value)},change:function(event,ui){if(!event.originalEvent)return false;if(typeof(settings.onchange)=='function')settings.onchange.call($sel)}});break;case'size':$sel.append('<div class="zedity-sizeselector" title="Select border width"></div>');$sizeselector=$sel.find('.zedity-sizeselector');$sizeselector.sliderSnap({label:'Width',value:settings.defaultsize,min:0,max:50,slide:function(event,ui){if(typeof(settings.onchangesize)=='function')settings.onchangesize.call($sel,ui.value)},change:function(event,ui){if(!event.originalEvent)return false;if(typeof(settings.onchange)=='function')settings.onchange.call($sel)}});break;case'style':$sel.append('<select class="zedity-styleselector" title="Select border style" style="float:left;width:80px"/>');$styleselector=$sel.find('.zedity-styleselector');for(var i=0,len=settings.styles.length;i<len;++i){$styleselector.append('<option value="'+settings.styles[i]+'" '+(settings.defaultstyle==settings.styles[i]?' selected="selected"':'')+'>'+settings.styles[i]+'</option>')}$styleselector.on('change.boxer',function(event){if(typeof(settings.onchangestyle)=='function')settings.onchangestyle.call($sel,event);if(typeof(settings.onchange)=='function')settings.onchange.call($sel,event)});break;case'padding':$sel.append('<div class="zedity-sliderpadding" title="Select box padding"></div>');$paddingselector=$sel.find('.zedity-sliderpadding');$paddingselector.sliderSnap({label:'Padding',value:0,min:0,max:50,slide:function(event,ui){if(typeof(settings.onchangepadding)=='function')settings.onchangepadding.call($sel,ui.value)},change:function(event,ui){if(!event.originalEvent)return false;if(typeof(settings.onchange)=='function')settings.onchange.call($sel)}});break;case'color':break}});if(settings.order.indexOf('color')>0){$sel.append('<div class="zedity-colorselector"></div>');$sel.find('.zedity-colorselector').colorPicker({colors:settings.colors,defaultcolor:settings.defaultcolor,alpha:true,buttons:settings.colorButtons,maxcols:9,onchange:function(event,color){if(typeof settings.onchange=='function')settings.onchange.call($sel,event);if(typeof settings.onchangecolor=='function')settings.onchangecolor.call($sel,event,color)},onchangealpha:function(event,alpha){if(typeof settings.onchangealpha=='function')settings.onchangealpha.call($sel,alpha)}})}})},selectsize:function(size,triggerevent){return this.each(function(){var $sel=$(this);$sel.find('.zedity-sizeselector').sliderSnap('value',size);if(triggerevent)$sel.find('.zedity-sizeselector').trigger('change')})},selectstyle:function(style,triggerevent){return this.each(function(){var $sel=$(this);$sel.find('.zedity-styleselector').val(style);if(triggerevent)$sel.find('.zedity-styleselector').trigger('change.boxer')})},selectcolor:function(color,triggerevent){return this.each(function(){$(this).find('.zedity-colorselector').colorPicker('selectcolor',color,triggerevent)})},selectalpha:function(alpha,triggerevent){return this.each(function(){$(this).find('.zedity-colorselector').colorPicker('selectalpha',alpha,triggerevent)})},selectcorners:function(corners,triggerevent){return this.each(function(){var $sel=$(this);var size=0;var ret=[];for(var i in corners){size+=parseInt(corners[i]);if(parseInt(corners[i])>0)ret.push(i)}size=Math.floor(size/4);$sel.find('.zedity-radiusselector').sliderSnap('value',size);$sel.find('.zedity-cornersselector .zedity-corner').addClass('zedity-selected');if(triggerevent){var data=$sel.data('boxer');if(typeof(data.onchangecorners)=='function')data.onchangecorners.call(this,ret,size);if(typeof(data.onchange)=='function')data.onchange.call(this)}})},selectpadding:function(size,triggerevent){return this.each(function(){var $sel=$(this);$sel.find('.zedity-sliderpadding').sliderSnap('value',size);if(triggerevent)$sel.find('.zedity-sliderpadding').trigger('change')})},getsize:function(){return $(this).find('.zedity-sizeselector').sliderSnap('value')},getstyle:function(){return $(this).find('.zedity-styleselector').val()},getcolor:function(){return $(this).find('.zedity-colorselector').colorPicker('getcolor')},getalpha:function(){return $(this).find('.zedity-colorselector').colorPicker('getalpha')},getcorners:function(){var $sel=$(this);var size=$sel.find('.zedity-radiusselector').sliderSnap('value');var corners={};if($sel.find('.zedity-cornertopleft').hasClass('zedity-selected'))corners['top-left']=size;if($sel.find('.zedity-cornertopright').hasClass('zedity-selected'))corners['top-right']=size;if($sel.find('.zedity-cornerbottomleft').hasClass('zedity-selected'))corners['bottom-left']=size;if($sel.find('.zedity-cornerbottomright').hasClass('zedity-selected'))corners['bottom-right']=size;return corners},getpadding:function(){return $(this).find('.zedity-sliderpadding').sliderSnap('value')},destroy:function(){return this.each(function(){var $sel=$(this);$sel.find('.zedity-sizeselector').remove();$sel.find('.zedity-styleselector').remove();$sel.find('.zedity-colorselector').remove();$sel.removeData('boxer')})}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on jQuery.boxer')}};$.fn.fontSelector=function(method){var fonts=['Arial,Helvetica,sans-serif','Arial Black,Gadget,sans-serif','Arial Narrow,sans-serif','Century Gothic,sans-serif','Comic Sans MS,cursive','Copperplate Gothic Light,sans-serif','Courier New,Courier,monospace','Georgia,serif','Gill Sans,sans-serif','Impact,Charcoal,sans-serif','Lucida Console,Monaco,monospace','Lucida Sans Unicode,Lucida Grande,sans-serif','Palatino Linotype,Book Antiqua,Palatino,serif','Tahoma,Geneva,sans-serif','Times New Roman,Times,serif','Trebuchet MS,Helvetica,sans-serif','Verdana,Geneva,sans-serif'];var sizes=['11','12','14','16','19','21','24','27','29','32','37','48','53','64'];var colors=['#ffffff','#f2f2f2','#d8d8d8','#bdbdbd','#a4a4a4','#6e6e6e','#424242','#2e2e2e','#000000','#fbefef','#f8e0e0','#f5a9a9','#f78181','#fe2e2e','#df0101','#b40404','#8a0808','#3b0b0b','#fbf5ef','#f8ece0','#f5d0a9','#faac58','#ff8000','#df7401','#b45f04','#8a4b08','#3b240b','#fbfbef','#f5f6ce','#f2f5a9','#f4fa58','#ffff00','#d7df01','#aeb404','#868a08','#393b0b','#f5fbef','#e3f6ce','#d0f5a9','#acfa58','#80ff00','#74df00','#5fb404','#4b8a08','#38610b','#effbef','#cef6ce','#a9f5a9','#58fa58','#00ff00','#01df01','#04b404','#088a08','#0b3b0b','#effbfb','#cef6f5','#a9f5f2','#58faf4','#00ffff','#01dfd7','#04b4ae','#088a85','#0b3b39','#eff5fb','#cee3f6','#81bef7','#2e9afe','#0080ff','#045fb4','#084b8a','#084b8a','#0b243b','#efeffb','#cecef6','#5858fa','#2e2efe','#0000ff','#0404b4','#08088a','#0b0b61','#0b0b3b','#f5effb','#e3cef6','#be81f7','#ac58fa','#9a2efe','#5f04b4','#4b088a','#380b61','#240b3b','#fbeffb','#f6cef5','#f781f3','#fe2ef7','#ff00ff','#df01d7','#b404ae','#610b5e','#3b0b39','#fbeff5','#f6cee3','#f5a9d0','#fa58ac','#ff0080','#df0174','#b4045f','#610b38','#3b0b24'];var methods={init:function(options){var settings={order:'font,size,style,color',fonts:fonts,sizes:sizes,colors:colors,colorButtons:false,defaultfont:fonts[0],defaultsize:sizes[3],defaultstyle:{bold:false,italic:false,underline:false},onchange:function(event){},onchangefont:function(font){},onchangesize:function(size){},onchangestyleB:function(style){},onchangestyleI:function(style){},onchangestyleU:function(style){},onchangestyleS:function(style){},onchangecolor:function(event,color){}};if(options)$.extend(settings,options);return this.each(function(){var $sel=$('<div class="zedity-fontselector"/>').appendTo(this);$sel.data('fontSelector',{fonts:settings.fonts,sizes:settings.sizes,defaultsize:settings.defaultsize});var $fontfaceselector;var $fontsizeselector1;var $fontsizeselector2;var $fontstyleselector;$.each(settings.order.split(','),function(i,item){switch(item){case'font':var tempsel='<div class="zedity-fontfaceselector zedity-button zedity-ddmenu zedity-menu" style="float:left;width:200px" data-ddmenu=".zedity-ffs-menu"><span><a href="javascript:;"></a></span></div>'+'<ul class="zedity-ffs-menu zedity-propbar-menu">';var tempcss='';for(var i=0,len=settings.fonts.length;i<len;++i){var tempclass='fontface'+i+'class';tempsel+='<li class="zedity-fontface '+tempclass+'" data-value="'+settings.fonts[i]+'"><a href="javascript:;">'+settings.fonts[i].split(',')[0]+'</a></li>';tempcss+='.'+tempclass+'{font-family:'+settings.fonts[i]+' !important}'}tempsel+='</ul>';$sel.append(tempsel);if($('#fontselectorFontsCss').length==0)$('head').prepend('<style id="zedity-fontselectorFontsCss" type="text/css">'+tempcss+'</style>');$fontfaceselector=$sel.find('.zedity-fontfaceselector');$fontfaceselector.ddmenu({onchange:function(value){if(typeof settings.onchange=='function')settings.onchange.call(this);if(typeof settings.onchangefont=='function')settings.onchangefont.call(this,value)}});break;case'size':var tempsel='<div class="zedity-fontsizeselector1 zedity-button zedity-ddmenu zedity-menu" style="float:left;width:55px" data-ddmenu=".zedity-fss-menu"><span><a href="javascript:;"></a></span></div>'+'<ul class="zedity-fss-menu zedity-propbar-menu">';for(var i=0,len=settings.sizes.length;i<len;++i){tempsel+='<li data-value="'+settings.sizes[i]+'"><a href="javascript:;">'+settings.sizes[i]+'</a></li>'}tempsel+='</ul>';$sel.append(tempsel);$fontsizeselector1=$sel.find('div.zedity-fontsizeselector1');$fontsizeselector1.ddmenu({width:80,onchange:function(value){$fontsizeselector2.attr('data-size',value);if(typeof settings.onchange=='function')settings.onchange.call(this);if(typeof settings.onchangesize=='function')settings.onchangesize.call(this,value)}});$sel.append('<div class="zedity-fontsizeselector2" style="float:left;margin:3px;clear:both;" data-size="'+settings.sizes.indexOf(settings.defaultsize)+'">'+'<span class="zedity-button"><a href="javascript:;" class="zedity-font-increase" title="Increase font size">A+</a></span>'+'<span class="zedity-button"><a href="javascript:;" class="zedity-font-decrease" title="Decrease font size">A-</a></span>'+'</div>');$fontsizeselector2=$sel.find('div.zedity-fontsizeselector2');$fontsizeselector2.find('a.zedity-font-decrease').on('click.fontSelector',function(event){var idx=settings.sizes.indexOf($fontsizeselector2.attr('data-size'));idx=(idx>=0?idx:settings.sizes.indexOf(settings.defaultsize));if(idx<=0)return;var size=settings.sizes[idx-1];$fontsizeselector2.attr('data-size',size);$fontsizeselector1.ddmenu('value',size,false);if(typeof settings.onchange=='function')settings.onchange.call(this,event);if(typeof settings.onchangesize=='function')settings.onchangesize.call(this,size)});$fontsizeselector2.find('a.zedity-font-increase').on('click.fontSelector',function(event){var idx=settings.sizes.indexOf($fontsizeselector2.attr('data-size'));idx=(idx>=0?idx:settings.sizes.indexOf(settings.defaultsize));if(idx>=settings.sizes.length-1)return;var size=settings.sizes[idx+1];$fontsizeselector2.attr('data-size',size);$fontsizeselector1.ddmenu('value',size,false);if(typeof settings.onchange=='function')settings.onchange.call(this,event);if(typeof settings.onchangesize=='function')settings.onchangesize.call(this,size)});break;case'style':$sel.append('<span class="zedity-fontstyleselector" style="float:left;margin:3px">'+'<span class="zedity-button"><a href="javascript:;" class="zedity-btnB" title="Bold"><b>B</b></a></span>'+'<span class="zedity-button"><a href="javascript:;" class="zedity-btnI" title="Italic"><i>I</i></a></span>'+'<span class="zedity-button"><a href="javascript:;" class="zedity-btnU" title="Underline"><u>U</u></a></span>'+'<span class="zedity-button"><a href="javascript:;" class="zedity-btnS" title="Shadow"><span style="text-shadow:2px 2px 2px #000">S</span></a></span>'+'</span>');$fontstyleselector=$sel.find('.zedity-fontstyleselector');$fontstyleselector.find('a').on('click.fontSelector',function(){$(this).parent().click();return false});break;case'color':break}});if(settings.order.indexOf('color')>-1){$sel.append('<div class="zedity-fontcolorselector"/>');var $fontcolorselector=$sel.find('.zedity-fontcolorselector');$fontcolorselector.colorPicker({colors:settings.colors,defaultcolor:-1,alpha:false,buttons:settings.colorButtons,maxcols:9,onchange:function(event,color,fill,alpha){if(typeof settings.onchange=='function')settings.onchange.call(this,event);if(typeof settings.onchangecolor=='function')settings.onchangecolor.call(this,event,color,alpha)}})}if($fontstyleselector){if(typeof settings.onchange=='function'){$fontstyleselector.find('.zedity-btnB').on('change.fontSelector',settings.onchange);$fontstyleselector.find('.zedity-btnI').on('change.fontSelector',settings.onchange);$fontstyleselector.find('.zedity-btnU').on('change.fontSelector',settings.onchange);$fontstyleselector.find('.zedity-btnS').on('change.fontSelector',settings.onchange)}if(typeof settings.onchangestyleB=='function')$fontstyleselector.find('.zedity-btnB').on('click.fontSelector',settings.onchangestyleB);if(typeof settings.onchangestyleI=='function')$fontstyleselector.find('.zedity-btnI').on('click.fontSelector',settings.onchangestyleI);if(typeof settings.onchangestyleU=='function')$fontstyleselector.find('.zedity-btnU').on('click.fontSelector',settings.onchangestyleU);if(typeof settings.onchangestyleS=='function')$fontstyleselector.find('.zedity-btnS').on('click.fontSelector',settings.onchangestyleS)}})},selectfont:function(font,triggerevent){return this.each(function(){var $sel=$(this);var data=$sel.data('fontSelector');if(font!=''){font=font.replace(/(,\s*)/g,',');font=font.replace(/(\'|\")/g,'');for(var i=data.fonts.length-1;i>=0;--i){var f=data.fonts[i].split(',')[0];if(font==f){font=data.fonts[i];break}}}var $fontfaceselector=$sel.find('.zedity-fontfaceselector');$fontfaceselector.ddmenu('value',font,false);if(triggerevent)$fontfaceselector.trigger('change.fontSelector')})},selectfontsize:function(size,triggerevent){return this.each(function(){var $sel=$(this);var data=$sel.data('fontSelector');if(size!=''){if(/px/.test(size))size=size.replace('px','');if(/pt/.test(size))size=$.pt2px(size);if(data.sizes.indexOf(size)==-1){size=Math.round(parseFloat(size));if(data.sizes.indexOf(size.toString())==-1){var closest=null;$.each(data.sizes,function(){if(closest==null||Math.abs(parseInt(this)-size)<Math.abs(closest-size)){closest=parseInt(this)}});size=closest}}}$sel.find('.zedity-fontsizeselector1').ddmenu('value',size,false);$sel.find('.zedity-fontsizeselector2').attr('data-size',size);if(triggerevent)$sel.find('.zedity-fontsizeselector').trigger('change.fontSelector')})},selectfontstyle:function(style,triggerevent){return this.each(function(){var $sel=$(this);var $cb=$sel.find('.zedity-fontstyleselector #zedity-checkB');var $ci=$sel.find('.zedity-fontstyleselector #zedity-checkI');var $cu=$sel.find('.zedity-fontstyleselector #zedity-checkU');if(style.bold==!$cb.is(':checked')){$cb.attr('checked',!$cb.is(':checked'));if(triggerevent)$cb.trigger('change.fontSelector')}if(style.italic==!$ci.is(':checked')){$ci.attr('checked',!$ci.is(':checked'));if(triggerevent)$ci.trigger('change.fontSelector')}if(style.underline==!$cu.is(':checked')){$cu.attr('checked',!$cu.is(':checked'));if(triggerevent)$cu.trigger('change.fontSelector')}})},selectcolor:function(color,triggerevent){return this.each(function(){var $sel=$(this);var data=$sel.data('fontSelector');color=Zedity.utils.rgb2hash(color);$sel.find('.zedity-fontcolorselector').colorPicker('selectcolor',color,triggerevent);if(triggerevent)$sel.find('.zedity-fontcolorselector').trigger('change.boxer')})},getfont:function(){return $(this).find('.zedity-fontfaceselector').ddmenu('value')},getfontsize:function(){return $(this).find('.zedity-fontsizeselector').attr('data-size')},getfontstyle:function(){var $sel=$(this);return{bold:$sel.find('.zedity-fontstyleselector #zedity-checkB').is(':checked'),italic:$sel.find('.zedity-fontstyleselector #zedity-checkI').is(':checked'),underline:$sel.find('.zedity-fontstyleselector #zedity-checkU').is(':checked')}},destroy:function(){return this.each(function(){var $sel=$(this);$sel.find('.zedity-fontfaceselector').remove();$sel.find('.zedity-fontsizeselector').remove();$sel.find('.zedity-fontstyleselector').remove();$sel.removeData('fontSelector')})}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on jQuery.fontSelector')}};$.fn.ddmenu=function(method){var $this=$(this);var $menu=$($this.attr('data-ddmenu'));var methods={init:function(options){var settings={width:200,onchange:function(){}};$.extend(settings,options);$this.data('ddmenu',settings);$menu.hide().addClass('zedity-ddmenu').detach().appendTo('body').menu().css({position:'absolute',width:settings.width}).off('mouseleave.ddmenu').on('mouseleave.ddmenu',function(){$menu.hide()});$this.off('click.ddmenu').on('click.ddmenu',function(){$('.zedity-ddmenu').not($menu).not('.zedity-button').hide();$menu.toggle().position({my:'left top',at:'left bottom',of:this}).css({'min-width':$this.outerWidth()});return false});$menu.find('.ui-menu-item').off('click.ddmenu').on('click.ddmenu',function(event){$this.ddmenu('value',$(this).attr('data-value'));$menu.hide();return false})},value:function(value,triggerevent){triggerevent=triggerevent===false?false:true;if(value!=null){var $item=$menu.find('[data-value="'+value+'"]');var text=($item.length==0?'':$item.text());$this.attr('data-value',value).find('a').text(text);if(text!=''&&triggerevent)$this.ddmenu('change',value)}else{value=$this.attr('data-value')}return value},change:function(value){var data=$this.data('ddmenu');data.onchange.call($this[0],value)}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on jQuery.fontSelector')}}})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.ContextMenu needs Zedity.');Zedity.ContextMenu=function(options){this.editor=options.editor;var menu='<ul class="zedity-contextmenu">';for(var i=0,len=Zedity.Box.types.length;i<len;++i){menu+='<li class="zedity-menu-AddBox" data-boxtype="'+Zedity.Box.types[i]+'"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-'+Zedity.Box.types[i].toLowerCase()+'"></span> Add '+Zedity.Box.types[i]+' box</a></li>'}menu+='<li class="zedity-menu-EditBox zedity-menu-SelArrangeMain"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-backward"></span> Arrange</a>'+'<ul>'+'<li class="zedity-menu-SelArrange" data-type="front"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-front"></span> Bring to front</a></li>'+'<li class="zedity-menu-SelArrange" data-type="back"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-back"></span> Send to back</a></li>'+'<li class="zedity-menu-SelArrange" data-type="forward"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-forward"></span> Bring forward</a></li>'+'<li class="zedity-menu-SelArrange" data-type="backward"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-backward"></span> Send backward</a></li>'+'</ul>'+'</li>'+'<li class="zedity-menu-EditBox zedity-menu-SelFlipMain"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-horizontal"></span> Flip</a>'+'<ul>'+'<li class="zedity-menu-SelFlip" data-type="horizontal"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-horizontal"></span> Horizontal</a></li>'+'<li class="zedity-menu-SelFlip" data-type="vertical"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-vertical"></span> Vertical</a></li>'+'</ul>'+'</li>'+'<li class="zedity-menu-EditBox zedity-menu-SelAsBg"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-expand"></span> Set as background</a></li>'+'<li class="zedity-menu-EditBox zedity-menu-SelDuplicate"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-duplicate"></span> Duplicate</a></li>'+'<li class="zedity-menu-EditBox ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li class="zedity-menu-EditBox zedity-menu-SelDelete"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-trash"></span> Delete</a></li>'+'</ul>';this.editor.$container.prepend(menu);this.$this=this.editor.$container.find('.zedity-contextmenu');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}});this.$this.on('mouseleave.zedity',$.proxy(function(){this.$this.menuZedity('collapseAll',null,true).hide()},this));this.editor.$container.on('contextmenu.zedity',$.proxy(function(event){var box=$(event.target).box();if(box&&box.$this.hasClass('zedity-editing'))return;var ok=(box!==null&&!box.asBackground());if(ok)box.select();this.$this.find('.zedity-menu-EditBox').toggle(ok&&box.editor.boxes.selected()!=null);this.$this.find('.zedity-menu-AddBox').toggle($(event.target).is(this.editor.$this)||(box!==null&&box.asBackground()));this.$this.find('.zedity-menu-AlignBox').toggle(ok&&!this.editor.boxes.selected());this.refresh();this.$this.css({left:event.pageX-this.editor.$container.offset().left+1,top:event.pageY-this.editor.$container.offset().top+1}).show();if(this.$this.find(':visible').length==0)this.$this.hide();return false},this));this.$this.find('.zedity-menu-AddBox').on('click.zedity',function(event){var $this=$(this);var editor=$this.editor();editor.contextMenu.close();editor.boxes.add($this.attr('data-boxtype'),{x:parseInt(editor.contextMenu.$this.css('left').replace('px',''))-editor.$this.position().left,y:parseInt(editor.contextMenu.$this.css('top').replace('px',''))-editor.$this.position().top});return false});this.$this.find('.zedity-menu-SelArrange').on('click.zedity',function(event){var editor=$(this).editor();editor.contextMenu.close();var box=editor.boxes.selected();if(box)box.arrange($(this).attr('data-type'));return false});this.$this.find('.zedity-menu-SelFlip').on('click.zedity',function(event){var editor=$(this).editor();editor.contextMenu.close();var box=editor.boxes.selected();if(box)box.flip($(this).attr('data-type'));return false});this.$this.find('.zedity-menu-SelAsBg').on('click.zedity',function(event){var editor=$(this).editor();editor.contextMenu.close();var box=editor.boxes.selected();if(box)box.asBackground(!box.asBackground());editor.menu.refresh();return false});this.$this.find('.zedity-menu-SelDuplicate').on('click.zedity',function(event){var editor=$(this).editor();editor.contextMenu.close();var box=editor.boxes.selected();if(box)box.duplicate();return false});this.$this.find('.zedity-menu-SelDelete').on('click.zedity',function(event){var editor=$(this).editor();editor.contextMenu.close();var box=editor.boxes.selected();if(box)box.remove();return false})};$.extend(Zedity.ContextMenu.prototype,{close:function(){this.$this.menuZedity('collapseAll',null,true).hide();return this},refresh:function(){var box=this.editor.boxes.selected();this.$this.find('.zedity-menu-Selection').toggleClass('ui-state-disabled',!box);if(box){this.$this.find('.zedity-menu-SelFlip,.zedity-menu-SelFlipMain').toggleClass('ui-state-disabled',!box.can('flip'));this.$this.find('.zedity-menu-SelAsBg').toggleClass('ui-state-disabled',!box.can('asBackground'));this.$this.find('.zedity-menu-SelAsBg a').html(box.asBackground()?'<span class="zedity-menu-icon zedity-icon-contract"></span> Unset from background':'<span class="zedity-menu-icon zedity-icon-expand"></span> Set as background');this.$this.find('.zedity-menu-SelArrangeMain').toggleClass('ui-state-disabled',box.asBackground());this.$this.find('.zedity-menu-SelDuplicate').toggleClass('ui-state-disabled',box.asBackground())}return this}})})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Menu needs Zedity.');Zedity.Menu=function(options){this.editor=options.editor;var menu='<ul class="zedity-mainmenu">'+'<li class="ui-menubar"><a href="javascript:;">Content</a>'+'<ul>'+'<li class="zedity-menu-PageSize" data-type="width"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-width"></span> Width <small></small></a></li>'+'<li class="zedity-menu-PageSize" data-type="height"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-height"></span> Height <small></small></a></li>'+'<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li class="zedity-menu-ClearAll"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-trash"></span> Clear all</a></li>'+'</ul>'+'</li>'+'<li class="ui-menubar"><a href="javascript:;">Edit</a>'+'<ul>'+'<li class="zedity-menu-EditUndoRedo" data-type="undo"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-undo"></span> Undo <span class="menu-shortcut">ctrl+z</span></a></li>'+'<li class="zedity-menu-EditUndoRedo" data-type="redo"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-redo"></span> Redo <span class="menu-shortcut">ctrl+y</span></a></li>'+'</ul>'+'</li>'+'<li class="ui-menubar"><a href="javascript:;">Add box</a>'+'<ul>';for(var i=0,len=Zedity.Box.types.length;i<len;++i){menu+='<li class="zedity-menu-AddBox" data-boxtype="'+Zedity.Box.types[i]+'"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-'+Zedity.Box.types[i].toLowerCase()+'"></span> '+Zedity.Box.types[i]+'</a></li>'}menu+='</ul>'+'</li>'+'<li class="ui-menubar zedity-menu-Selection"><a href="javascript:;">Edit box</a>'+'<ul>'+'<li class="zedity-menu-SelArrangeMain"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-backward"></span> Arrange</a>'+'<ul>'+'<li class="zedity-menu-SelArrange" data-type="front"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-front"></span> Bring to front</a></li>'+'<li class="zedity-menu-SelArrange" data-type="back"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-back"></span> Send to back</a></li>'+'<li class="zedity-menu-SelArrange" data-type="forward"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-forward"></span> Bring forward</a></li>'+'<li class="zedity-menu-SelArrange" data-type="backward"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-arrange-backward"></span> Send backward</a></li>'+'</ul>'+'</li>'+'<li class="zedity-menu-SelFlipMain"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-horizontal"></span> Flip</a>'+'<ul>'+'<li class="zedity-menu-SelFlip" data-type="horizontal"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-horizontal"></span> Horizontal</a></li>'+'<li class="zedity-menu-SelFlip" data-type="vertical"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-flip-vertical"></span> Vertical</a></li>'+'</ul>'+'</li>'+'<li class="zedity-menu-SelAsBg"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-expand"></span> Set as background</a></li>'+'<li class="zedity-menu-SelDuplicate"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-duplicate"></span> Duplicate</a></li>'+'<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li class="zedity-menu-SelDelete"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-trash"></span> Delete</a></li>'+'</ul>'+'</li>'+'</ul>';this.editor.$container.prepend(menu);this.$this=this.editor.$container.find('.zedity-mainmenu');this.$this.menuZedity({position:{my:'left top',at:'left bottom'}});this.$this.on('mouseleave.zedity',function(){$(this).menuZedity('collapseAll',null,true)});this.$this.find('.zedity-menu-PageSize').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var size=editor.page.size();var type=$(this).attr('data-type');var typeUp=type.charAt(0).toUpperCase()+type.slice(1);Zedity.core.dialog({question:'Please enter content '+type+' in pixels<br/>'+'(min: '+editor.page._options['min'+typeUp]+', '+'max: '+editor.page._options['max'+typeUp]+'):',default:size[type],ok:function(val){size[type]=parseInt(val);editor.page.size(size)}});return false});this.$this.find('.zedity-menu-ClearAll').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();editor.page.content('');return false});this.$this.find('.zedity-menu-EditUndoRedo').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();editor[$(this).attr('data-type')]();return false});this.$this.find('.zedity-menu-AddBox').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();editor.boxes.add($(this).attr('data-boxtype'));return false});this.$this.find('.zedity-menu-SelArrange').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var box=editor.boxes.selected();if(box)box.arrange($(this).attr('data-type'));return false});this.$this.find('.zedity-menu-SelFlip').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var box=editor.boxes.selected();if(box)box.flip($(this).attr('data-type'));return false});this.$this.find('.zedity-menu-SelAsBg').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var box=editor.boxes.selected();if(box)box.asBackground(!box.asBackground());editor.menu.refresh();return false});this.$this.find('.zedity-menu-SelDuplicate').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var box=editor.boxes.selected();if(box)box.duplicate();return false});this.$this.find('.zedity-menu-SelDelete').on('click.zedity',function(event){var editor=$(this).editor();editor.menu.close();var box=editor.boxes.selected();if(box)box.remove();return false})};$.extend(Zedity.Menu.prototype,{close:function(){this.$this.menuZedity('collapseAll',null,true);return this},refresh:function(){this.$this.find('.zedity-menu-PageSize').toggleClass('ui-state-disabled',!this.editor._options.resizable);this.$this.find('.zedity-menu-PageSize[data-type=width] a small').html('('+this.editor.page.size().width+'px)');this.$this.find('.zedity-menu-PageSize[data-type=height] a small').html('('+this.editor.page.size().height+'px)');var box=this.editor.boxes.selected();this.$this.find('.zedity-menu-Selection').toggleClass('ui-state-disabled',!box);if(box){this.$this.find('.zedity-menu-SelFlip,.zedity-menu-SelFlipMain').toggleClass('ui-state-disabled',!box.can('flip'));this.$this.find('.zedity-menu-SelAsBg').toggleClass('ui-state-disabled',!box.can('asBackground'));this.$this.find('.zedity-menu-SelAsBg a').html(box.asBackground()?'<span class="zedity-menu-icon zedity-icon-contract"></span> Unset from background':'<span class="zedity-menu-icon zedity-icon-expand"></span> Set as background');this.$this.find('.zedity-menu-SelArrangeMain').toggleClass('ui-state-disabled',box.asBackground());this.$this.find('.zedity-menu-SelDuplicate').toggleClass('ui-state-disabled',box.asBackground())}return this}});Zedity.Menu.type='bar'})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Box.Audio needs Zedity.');if(!Zedity.Box)throw new Error('Zedity.Box.Audio needs Zedity.Box.');Zedity.Box.Audio=function(options){this.type='Audio';this._defaults={width:200,height:100};Zedity.Box.prototype.constructor.call(this,options);this._can.remove('background','asBackground','rotate','flip','corners');if(this.$this.find('object,iframe,audio').length==0){if(this.$this.find('.zedity-empty').length==0){this.$this.append('<div class="zedity-empty"><p>Click <span class="zedity-icon zedity-icon-audio"></span> to insert audio.</p></div>')}}else if(this.$this.find('.zedity-boxoverlay').length==0){this.$this.append('<div class="zedity-boxoverlay"/>')}};Zedity.Box.Audio.prototype=Object.create(Zedity.Box.prototype);Zedity.Box.Audio.prototype.constructor=Zedity.Box.Audio;$.extend(Zedity.Box.Audio.prototype,{createPropBar:function(options){Zedity.Box.prototype.createPropBar.call(this,$.extend(true,{bars:{'0':{audio:{type:'button',icon:'audio',label:'Insert',title:'Insert audio',order:-20,onclick:function(event,propbar){$('.zedity-dialog-audio').data('box',propbar.editor.boxes.selected()).dialog('open')}},audiocontrols:{type:'toggle','class':'zedity-audiocontrol',order:-10,state:[{label:'Play',icon:'play',title:'Play audio'},{label:'Pause',icon:'pause',title:'Pause audio'}],onclick:function(event,propbar,before,after){switch(before){case 0:propbar.editor.boxes.selected().start();break;case 1:propbar.editor.boxes.selected().stop();break}}},overlay:{type:'toggle','class':'zedity-audiooverlay',order:-5,state:[{label:'Show',icon:'read',title:'Show audio'},{label:'Close',icon:'read',title:'Close audio'}],onclick:function(event,propbar,before,after){switch(before){case 0:propbar.editor.boxes.selected().start();break;case 1:propbar.editor.boxes.selected().stop();break}}},separator:{type:'separator',order:0},bgcolor:null,border:{panel:{build:function(propbar,$panel){$panel.boxer({order:'size,style,color',onchange:function(){var $this=$(this);propbar.editor.boxes.selected().$this.css({'border-width':$this.boxer('getsize'),'border-style':$this.boxer('getstyle'),'border-color':Zedity.utils.hash2rgba($this.boxer('getcolor'),$this.boxer('getalpha'))});propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('value',Math.round($this.boxer('getalpha')*100));propbar.editor._changed()},onchangesize:function(size){var $box=propbar.editor.boxes.selected().$this;$box.css('border-width',size+'px')},onchangealpha:function(alpha){propbar.editor.boxes.selected().$this.css({'border-color':Zedity.utils.hash2rgba($(this).boxer('getcolor'),alpha)})}})}}},rotate:null,opacity:null,editbox:{menu:{asbackground:null,flip:null}}}}},options));return this},_sizeLimits:function(){var sl=Zedity.Box.prototype._sizeLimits.call(this);var service=this.getService();if(!service)return sl;return{minWidth:service.sizeLimits.minWidth||sl.minWidth,maxWidth:service.sizeLimits.maxWidth||sl.maxWidth,minHeight:service.sizeLimits.minHeight||sl.minHeight,maxHeight:service.sizeLimits.maxHeight||sl.maxHeight}},_save:function(callback){Zedity.Box.prototype._save.call(this);this.$this.find('.zedity-boxoverlay').remove();if(typeof(callback)=='function')callback.call(this);return this},content:function(content){if(content!=null){if(typeof content=='string'||content instanceof String){var embed=Zedity.core.embed.parse(content,'audio');if(!embed.code){this.editor._error({message:'Please provide a valid link/embed code for any of the supported audio services.'});return Zedity.Box.prototype.content.call(this)}content=(embed.iframe||embed.flash)+'<div class="zedity-boxoverlay"/>';this.$this.css('display','').attr('data-service',embed.service)}else if($.isArray(content)){var html='<div style="display:table-cell;width:100%;vertical-align:middle;">'+'<audio controls="controls" style="width:100%">';for(var i=0,len=content.length;i<len;++i){html+='<source src="'+content[i]+'" />'}html+='<p>Your browser does not support HTML5 audio.</p></audio>'+'</div><div class="zedity-boxoverlay"/>';content=html;this.$this.css('display','table').attr('data-service','html5')}else{this.editor._error({message:'Could not interpret the content as audio.'});return Zedity.Box.prototype.content.call(this)}}content=Zedity.Box.prototype.content.call(this,content);this._resize();this.editor.boxes.refreshSelected();return content},select:function(){if(this.$this.hasClass('zedity-editing')||this.$this.hasClass('zedity-playing'))return this;Zedity.Box.prototype.select.call(this);var service=this.getService();if(service){var canplay=!!(service.player.flash.play||service.player.iframe.play);this.propbar.$bars.find('.zedity-button.zedity-audiocontrol').toggleClass('zedity-disabled',!canplay).attr('title','Audio preview is not available for the "'+service.service+'" service.').trigger('toggle.propbar',[0]);this.propbar.$bars.find('.zedity-button.zedity-audiooverlay').toggle(!canplay).trigger('toggle.propbar',[0])}else{this.propbar.$bars.find('.zedity-button.zedity-audiocontrol').addClass('zedity-disabled').attr('title','').trigger('toggle.propbar',[0]);this.propbar.$bars.find('.zedity-button.zedity-audiooverlay').hide()}this.propbar.$drawer.find('.zedity-boxer').boxer('selectsize',this.$this.css('border-top-width').replace('px','')).boxer('selectstyle',this.$this.css('border-top-style')).boxer('selectpadding',this.$this.css('padding').replace('px','')).boxer('selectcolor',this.$this.css('border-top-color')).boxer('selectalpha',Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1);return this},asBackground:function(setting){if(setting!=null){this.editor._error({message:'Audio box can\'t be set as background.'})}return false},rotation:function(setting){if(setting!=null){this.editor._error({message:'Audio box can\'t be rotated.'})}return 0},background:function(setting){if(setting!=null){this.editor._error({message:'Audio box doesn\'t support background property.'})}return{type:'solid',alpha:1,colors:['transparent']}},corners:function(setting){if(setting!=null){this.editor._error({message:'Audio box doesn\'t support rounded corners.'})}return{'border-top-left-radius':0,'border-top-right-radius':0,'border-bottom-left-radius':0,'border-bottom-right-radius':0}},flip:function(setting){if(setting!=null){this.editor._error({message:'Audio box doesn\'t support flipping.'})}return'none'},start:function(){Zedity.Box.prototype.start.call(this);var $obj=this.$this.find('object,iframe,audio');if($obj.lenght==0)return this;var service=this.getService();if(!service)return this;if(this.$this.data('ui-draggable'))this.$this.draggable('option','disabled',true);if(this.$this.data('ui-resizable'))this.$this.resizable('option','disabled',true);this.$this.removeClass('ui-state-disabled');Zedity.core.embed.player($obj,service.service,'play');this.$this.addClass('zedity-playing').find('.zedity-boxoverlay').hide();return this},stop:function(){Zedity.Box.prototype.stop.call(this);var $obj=this.$this.find('object,iframe,audio');if($obj.lenght==0)return this;var service=this.getService();if(!service)return this;if(this.$this.data('ui-draggable'))this.$this.draggable('option','disabled',false);if(this.$this.data('ui-resizable'))this.$this.resizable('option','disabled',false);Zedity.core.embed.player($obj,service.service,'pause');this.$this.removeClass('zedity-playing').find('.zedity-boxoverlay').show();return this},getService:function(){var service=this.$this.attr('data-service')||this.$this.find('object,iframe,audio').attr('data-service');return Zedity.core.embed.services[service]},duplicate:function(){var newbox=Zedity.Box.prototype.duplicate.call(this);var $obj=newbox.$this.find('object,iframe,audio');var service=newbox.getService();if(service){$obj.attr('id',Zedity.core.genId(service.service))}return newbox},init:function(){Zedity.Box.prototype.init.call(this);if($('.zedity-dialog-audio').length==0){var $dialog=$('<div class="zedity-dialog-audio">'+'<div class="tabs">'+'<ul>'+'<li><a href="#tab-audio-embed">Embed</a></li>'+'<li><a href="#tab-audio-files">Files</a></li>'+'</ul>'+'<div id="tab-audio-embed">'+'Insert audio embed code or url:<br/>'+'<textarea id="zedity-txtAudioEmbed" rows="4"></textarea>'+'<p>Supported services:<br/><span id="zedity-lblAudioServices"></span></p>'+'</div>'+'<div id="tab-audio-files">'+'Select audio from the list of available audios:<br/>'+'<select id="zedity-ddAudioFiles"></select>'+'</div>'+'</div>'+'</div>');$dialog.find('.tabs').tabs({activate:function(event,ui){$(this).find('.ui-tabs-panel:visible').find('input[type=text]:first,textarea:first,select:first').focus()}});this.editor.$container.append($dialog);$dialog.dialog({title:'Insert audio',dialogClass:'zedity-dialog',autoOpen:false,modal:true,resizable:false,open:function(){var $this=$(this);var box=$this.data('box');var disabled=[];if(box._options.files){var files='<option value="-1">--</option>';for(var i=0,len=box._options.files.length;i<len;++i){files+='<option value="'+i+'">'+box._options.files[i].title+'</option>'}$('#zedity-ddAudioFiles').html(files)}else{disabled.push(1)}var services=Zedity.core.embed.getServices('audio',true);$('#zedity-lblAudioServices').html(services.join(', '));$this.find('input[type=text],textarea').val('');$this.find('.tabs').tabs('option',{active:0,disabled:disabled});$('#zedity-txtAudioEmbed').focus()},close:function(){$(this).data('box',null)},buttons:[{text:'OK',click:function(){var box=$(this).data('box');$(this).dialog('close');if(box){var content='';switch($(this).find('.tabs').tabs('option','active')){case 0:content=$('#zedity-txtAudioEmbed').val();break;case 1:var val=parseInt($('#zedity-ddAudioFiles').val());if(val>-1){content=box._options.files[val].src}break}box.content(content)}}},{text:'Cancel',click:function(){$(this).dialog('close')}}]})}return this}});Zedity.Box.Audio.type='Audio';Zedity.Box.Audio.sizeLimits={minWidth:200,minHeight:70,maxWidth:null,maxHeight:165};Zedity.Box.register({type:Zedity.Box.Audio.type});Zedity.core.embed.add('soundcloud',{url:'http://soundcloud.com/',type:'audio',regex:[new RegExp('soundcloud\\.com(?:/|%2F)tracks(?:/|%2F)(.*?)(&|"|\'|$)'),new RegExp('snd\\.sc/(.*?)'),new RegExp('http[s]?://soundcloud\\.com/.+')],parser:function(code,embed){if(!code[1]){try{var data=$.ajax({type:'GET',url:'https://soundcloud.com/oembed?format=json&url='+embed,dataType:'json',async:false});data=JSON.parse(data.responseText);code=this.regex[0].exec(data.html)}catch(e){code=undefined}}if(code){var id=Zedity.core.genId(this.service);return{id:id,code:code[1],flash:'//player.soundcloud.com/player.swf?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F'+code[1]+'&amp;show_comments=false&amp;auto_play=false&amp;buying=false&amp;sharing=false&amp;download=false&amp;show_bmp=false&amp;show_playcount=false&amp;enable_api=true&amp;object_id='+id,iframe:'//w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F'+code[1]+'&amp;auto_play=false&amp;show_artwork=false&amp;show_comments=false&amp;show_playcount=false&amp;buying=false&amp;liking=false&amp;download=false&amp;sharing=false'}}return{}},player:{flash:{play:'play',pause:'pause'},iframe:{play:'play',pause:'pause',command:function(frame_id,func,args){$('#'+frame_id)[0].contentWindow.postMessage(JSON.stringify({method:func,value:args}),'*')}}},sizeLimits:{minWidth:60,minHeight:60}});Zedity.core.embed.add('reverbnation',{url:'http://www.reverbnation.com/',type:'audio',regex:[new RegExp('reverbnation\\.com/widget_code/html_widget(?:_config|)/artist_(.*?)\\?.*?song_ids\\]=(.*?)(&|"|\'|$)'),new RegExp('reverbnation\\.com/artist/artist_songs/(.*?)\\?song_id=(.*?)(&|"|\'|$)')],parser:function(code){if(!code[2])code[2]='';return{code:code[2],iframe:'//www.reverbnation.com/widget_code/html_widget/artist_'+code[1]+'?widget_id=50&pwc[included_songs]=0&pwc[song_ids]='+code[2]+'&pwc[photo]=0&pwc[size]=fit'}},sizeLimits:{minWidth:200,minHeight:65,maxHeight:105}})})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Box.Color needs Zedity.');if(!Zedity.Box)throw new Error('Zedity.Box.Color needs Zedity.Box.');Zedity.Box.Color=function(options){this.type='Color';this._defaults={width:150,height:150};Zedity.Box.prototype.constructor.call(this,options);this._can.remove('flip');if(!this._options.id&&!this._options.element){this.$this.append('<p style="color:transparent">_</p><div class="zedity-empty"><p>Click <span class="zedity-icon zedity-icon-color"></span> to add color.</p></div>')}};Zedity.Box.Color.prototype=Object.create(Zedity.Box.prototype);Zedity.Box.Color.prototype.constructor=Zedity.Box.Color;$.extend(Zedity.Box.Color.prototype,{createPropBar:function(options){Zedity.Box.prototype.createPropBar.call(this,$.extend(true,{bars:{'0':{bgcolor:{order:-20},separator:{type:'separator',order:0},editbox:{menu:{flip:null}}}}},options));return this},_save:function(callback){Zedity.Box.prototype._save.call(this);if(typeof(callback)=='function')callback.call(this);return this},select:function(){Zedity.Box.prototype.select.call(this);this.propbar.$drawer.find('.zedity-sliderboxopacity').sliderSnap('option','value',Math.round((this.$this.css('opacity')||1)*100));var fill=this.background();this.propbar.$drawer.find('.zedity-backgroundcolor').colorPicker('selectfill',fill);this.propbar.$drawer.find('.zedity-sliderbgopacity').sliderSnap('option','value',Math.round(fill.alpha*100));this.propbar.$drawer.find('.zedity-sliderrotate').sliderSnap('value',this.rotation());this.propbar.$drawer.find('.zedity-boxer').boxer('selectsize',this.$this.css('border-top-width').replace('px','')).boxer('selectstyle',this.$this.css('border-top-style')).boxer('selectcolor',this.$this.css('border-top-color')).boxer('selectcorners',this.corners()).boxer('selectalpha',Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1);this.propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('option','value',Math.round((Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1)*100));return this},flip:function(setting){if(setting!=null){this.editor._error({message:'Color box doesn\'t support flipping.'})}return'none'},start:function(){Zedity.Box.prototype.start.call(this);return this},stop:function(){Zedity.Box.prototype.stop.call(this);return this},init:function(){Zedity.Box.prototype.init.call(this);return this}});Zedity.Box.Color.type='Color';Zedity.Box.Color.sizeLimits={minWidth:16,minHeight:16,maxWidth:null,maxHeight:null};Zedity.Box.register({type:Zedity.Box.Color.type,requires:[]})})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Box.Image needs Zedity.');if(!Zedity.Box)throw new Error('Zedity.Box.Image needs Zedity.Box.');Zedity.Box.Image=function(options){this.type='Image';this._defaults={src:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',width:250,height:200,layout:'centerfill',proportionalResize:true,quality:0.88,accept:Object.keys(Zedity.utils.fileTypes.types),maxSize:1000000,descriptionMandatory:true,allowLink:true};Zedity.Box.prototype.constructor.call(this,options);this._can.push('layout');if(this.$this.find('img').length==0){this.$this.append($('<img/>',{'class':'zedity-content',src:this._options.src,css:{width:'100%',height:'100%',margin:0}})).append('<div class="zedity-empty"><p>Click <span class="zedity-icon zedity-icon-image"></span> <!--or <span class="zedity-icon zedity-icon-link"></span>--> to insert image.</p></div>');Zedity.core._call(this,'layout',this._options.layout);if(this._options.proportionalResize)this.$this.attr('data-aspectratio',1)}};Zedity.Box.Image.prototype=Object.create(Zedity.Box.prototype);Zedity.Box.Image.prototype.constructor=Zedity.Box.Image;$.extend(Zedity.Box.Image.prototype,{createPropBar:function(options){Zedity.Box.prototype.createPropBar.call(this,$.extend(true,{minWidth:350,bars:{'0':{image:{type:'button',icon:'image',label:'Insert',title:'Insert image from disk',order:-30,onclick:function(event,propbar){$('.zedity-dialog-image').data('box',propbar.editor.boxes.selected()).dialog('open')}},options:{type:'menu',icon:'imageoptions',label:'Image options',title:'Image options','class':'zedity-disabled',order:-20,menu:{propresize:{label:'Proportional resize','class':'zedity-menu-img-propresize',icon:'empty',onclick:function(event,propbar){var val=!propbar.editor.boxes.selected().proportionalResize();val=propbar.editor.boxes.selected().proportionalResize(val);propbar._menuToggle('zedity-menu-img-propresize',val)}},imglayout:{label:'Image layout',icon:'none','class':'ui-state-disabled zedity-menu-imglayout-menu',menu:{centerfill:{label:'Center & fill','class':'zedity-menu-imglay zedity-menu-imglay-centerfill',icon:'yes',onclick:function(event,propbar){propbar.editor.boxes.selected().layout('centerfill');propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-centerfill')}},fit:{label:'Fit','class':'zedity-menu-imglay zedity-menu-imglay-fit',icon:'empty',onclick:function(event,propbar){propbar.editor.boxes.selected().layout('fit');propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-fit')}},center:{label:'Center','class':'zedity-menu-imglay zedity-menu-imglay-center',icon:'empty',onclick:function(event,propbar){propbar.editor.boxes.selected().layout('center');propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-center')}},stretch:{label:'Stretch','class':'zedity-menu-imglay zedity-menu-imglay-stretch',icon:'empty',onclick:function(event,propbar){propbar.editor.boxes.selected().layout('stretch');propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-stretch')}},tile:{label:'Tile','class':'zedity-menu-imglay zedity-menu-imglay-tile',icon:'empty',onclick:function(event,propbar){propbar.editor.boxes.selected().layout('tile');propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-tile')}},},},quality:{label:'Image quality',icon:'settings','class':'ui-state-disabled zedity-menu-imgqual-menu',menu:{original:{label:'Original','class':'zedity-menu-imgqual zedity-menu-imgqual-original',icon:'empty',onclick:function(event,propbar){propbar._menuGroup('zedity-menu-imgqual','zedity-menu-imgqual-original');propbar.editor.boxes.selected()._options.quality=2}},high:{label:'High','class':'zedity-menu-imgqual zedity-menu-imgqual-high',icon:'empty',onclick:function(event,propbar){propbar._menuGroup('zedity-menu-imgqual','zedity-menu-imgqual-high');propbar.editor.boxes.selected()._options.quality=0.92}},normal:{label:'Normal','class':'zedity-menu-imgqual zedity-menu-imgqual-normal',icon:'yes',onclick:function(event,propbar){propbar._menuGroup('zedity-menu-imgqual','zedity-menu-imgqual-normal');propbar.editor.boxes.selected()._options.quality=0.88}},low:{label:'Low','class':'zedity-menu-imgqual zedity-menu-imgqual-low',icon:'empty',onclick:function(event,propbar){propbar._menuGroup('zedity-menu-imgqual','zedity-menu-imgqual-low');propbar.editor.boxes.selected()._options.quality=0.75}}}}}},separator:{type:'separator',order:0}}}},options));if($('.zedity-dialog-image').length==0){var $dialog=$('<div class="zedity-dialog-image">'+'<div class="tabs">'+'<ul>'+'<li><a href="#tab-image-disk">Disk</a></li>'+'<li><a href="#tab-image-link">Link</a></li>'+'</ul>'+'<div id="tab-image-disk">'+'Supported image file types:<br/><span id="zedity-lblSupportedImages"></span><br/><br/>'+'Select image file from disk (max size <span id="zedity-lblMaxSize"></span>):<br/><br/>'+'<button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only zedity-fileupload"><span class="ui-button-text">Browse...</span></button>'+'<p id="zedity-lblImageDisk" class="selected-file"></p>'+'<p>Image quality: '+'<select id="zedity-ddImageQuality" style="width:150px;">'+'<option value="2">Original</option>'+'<option value="0.92">High</option>'+'<option value="0.88" selected="selected">Normal</option>'+'<option value="0.75">Low</option>'+'</select>'+'</p>'+'</div>'+'<div id="tab-image-link">'+'Insert image URL link:<br/>'+'<textarea id="zedity-txtImageLink" rows="4"></textarea>'+'</div>'+'</div>'+'Image description:<br/>'+'<input id="zedity-txtImageDescription" type="text" value=""><br/><br/>'+'</div>');$dialog.find('.tabs').tabs({activate:function(event,ui){$(this).find('.ui-tabs-panel:visible').find('input[type=text]:first,textarea:first,select:first,button:first,p').focus()}});this.editor.$container.append($dialog);$dialog.dialog({title:'Insert image',dialogClass:'zedity-dialog',autoOpen:false,modal:true,resizable:false,open:function(){var $this=$(this);var box=$this.data('box');var disabled=[];if(!box._options.allowLink)disabled.push(1);$this.find('input[type=text],textarea').val('');$this.find('#zedity-ddImageQuality').val(0.88);$this.find('#zedity-lblMaxSize').text(Math.floor(box._options.maxSize/1000)+'K');$this.find('.tabs').tabs('option',{active:0,disabled:disabled});$this.find('#zedity-lblSupportedImages').text(Object.keys(Zedity.utils.fileTypes.types).join(', '));var content=box.content();if(content&&/^http/.test(content)){$this.find('.tabs').tabs('selected','tab-image-link');$this.find('#zedity-txtImageLink').val(content)}$this.find('#zedity-txtImageDescription').val(box.$this.find('img').attr('alt')||'')},close:function(){var $this=$(this);$('#zedity-lblImageDisk').text('');$this.find('.zedity-fileupload').upload('clear')},buttons:[{text:'OK',click:function(){var $this=$(this);var box=$this.data('box');if(box){var $inputDescription=$('#zedity-txtImageDescription');if(box._options.descriptionMandatory&&$inputDescription.val().length<4){if($inputDescription.val().length==0){box.editor._error({message:'Please insert image description.'})}else if($inputDescription.val().length<4){box.editor._error({message:'Image description is too short.'})}$inputDescription.focus();return}box._data.filterOriginal=null;switch($this.find('.tabs').tabs('selected')){case'tab-image-disk':var $fu=$this.find('.zedity-fileupload');if($fu.upload('getfilename')==''){box.editor._error({message:'No file selected.'});return}box._options.quality=parseFloat($this.find('#zedity-ddImageQuality').val());if(box._options.quality==1)box._options.quality=2;$fu.upload('submit');break;case'tab-image-link':var content=$('#zedity-txtImageLink').val();if(content==''){box.editor._error({message:'Please insert a link.'});return}box.content(content);break}box.description($inputDescription.val())}$(this).dialog('close')}},{text:'Cancel',click:function(){$(this).dialog('close')}}]})}$('.zedity-dialog-image .zedity-fileupload').upload({autosubmit:false,acceptmime:$.map(this._options.accept,function(key){return Zedity.utils.fileTypes.types[key].mime}).join(','),extensions:$.map(this._options.accept,function(key){return Zedity.utils.fileTypes.types[key].extensions}).join(' '),action:this._options.action,maxsize:this._options.maxSize,onselect:$.proxy(function(event,file){var fn=$(file).val();fn=fn.split(/[\\\/]/).pop();$('#zedity-lblImageDisk').html('Selected file:<br/><b>'+fn+'</b>');$('#zedity-txtImageDescription').focus()},this),onsubmit:function(file){var $this=$(this);var data=$this.data('upload');var box=$this.parents('.zedity-dialog-image').data('box');box._loading();data.$input.trigger('mouseout.upload');if(!Zedity.core.supports.fileapi()){box.editor._data.imageupload=box;return true}Zedity.utils.resizeImage(file.files[0],{maxwidth:box._sizeLimits().maxWidth,maxheight:box._sizeLimits().maxHeight,aspectratio:true,quality:box._options.quality,accept:box._options.accept,onerror:function(error){box.editor._error(error)},onresizeend:function(size,data,type){box.content(data,size);box._data.fileType=type}});return false},oncomplete:function(event,response){var box=$(this).parents('.zedity-dialog-image').data('box');if(!box)return;if(response.status=='OK'){if(box.editor._data.imageupload){box.editor._data.imageupload.content(response.data);delete box.editor._data.imageupload}else{box.editor._error({message:'An unexpected error occurred. Please try again.'})}}else{box.editor._error({message:'There was an error during server image resize.'})}},onerror:function(error){var box=$(this).parents('.zedity-dialog-image').data('box');if(!box)return;box.editor._error(error)}});return this},_loading:function(set){if(set===false){this.$this.find('.zedity-loading').remove()}else{this.$this.find('.zedity-empty').remove();this.$this.append('<div class="zedity-loading"><p>Loading...</p></div>')}return this},content:function(content,size,dontresize){function resizeBox(){this.editor._changed();if(dontresize)return;var old=this.proportionalResize();Zedity.core._call(this,'proportionalResize',true);if(!old)Zedity.core._call(this,'proportionalResize',false)};function getSize(content){var img=new Image();img.onload=$.proxy(function(){this.$this.box()._data.size={width:img.width,height:img.height};img=null;resizeBox.call(this)},this);img.src=content};if(content==null){content=this.$this.find('img').css('background-image');if(/data:image\//.test(content)){content=/(url\("?)(data:.*?)("?\))/i.exec(content)[2]}else if(/^url\(/.test(content)){content=/(url\("?)(.*?)("?\))/i.exec(content)[2]}else{content=this.$this.find('img').attr('src')}if(content==this._options.src)content=null}else{if(/^http/.test(content)){this._loading();this.$this.removeNumberedClass('imgDataS');this.$this.find('img').css('background-image','').attr('src',content);this._loading(false);getSize.call(this,content)}else if(/^data:/.test(content)){this._loading();this.$this.find('img').css('background-image','').attr('src',this._options.src);var idx=$('style.imgData').getEmptyNumberedClass('imgDataS');var $imgData=$('<style class="imgData imgDataS'+idx+'" type="text/css"></style>');$imgData.appendTo('head');$imgData.html('#'+this.editor.id+' .imgDataS'+idx+' img{background-image:url("'+content+'")}');this.$this.removeNumberedClass('imgDataS').addClass('imgDataS'+idx);this._addReference();if(this.layout()=='stretch'&&this.$this.find('img')[0].style.backgroundSize=='100%')this.layout('stretch');this._loading(false);if(size){this._data.size=size;resizeBox.call(this)}else{getSize.call(this,content)}}else{this.editor._error({message:'Could not interpret the content as image.'})}}return content},extractText:function(){this._data.$clone=this.$this.clone();this._data.$clone.find('style').remove();return Zedity.Box.prototype.extractText.call(this)},description:function(description){if(description!=null){this.$this.find('img').attr('alt',description)}else{description=this.$this.find('img').attr('alt')}return description},select:function(){Zedity.Box.prototype.select.call(this);this.propbar.$drawer.find('.zedity-sliderboxopacity').sliderSnap('option','value',Math.round((this.$this.css('opacity')||1)*100));var fill=this.background();this.propbar.$drawer.find('.zedity-backgroundcolor').colorPicker('selectfill',fill);this.propbar.$drawer.find('.zedity-sliderbgopacity').sliderSnap('option','value',Math.round(fill.alpha*100));this.propbar.$drawer.find('.zedity-sliderrotate').sliderSnap('value',this.rotation());this.propbar.$drawer.find('.zedity-boxer').boxer('selectsize',this.$this.css('border-top-width').replace('px','')).boxer('selectstyle',this.$this.css('border-top-style')).boxer('selectcorners',this.corners()).boxer('selectpadding',this.$this.css('padding').replace('px','')).boxer('selectcolor',this.$this.css('border-top-color')).boxer('selectalpha',Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1);this.propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('option','value',Math.round((Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1)*100));var hasimg=!!this.content();this.propbar.$this.find('.zedity-icon-imageoptions').closest('.zedity-button').toggleClass('zedity-disabled',!hasimg);this.propbar.$this.find('.zedity-icon-link').closest('.zedity-button').toggleClass('zedity-disabled',!hasimg);this.propbar._menuGroup('zedity-menu-imglay','zedity-menu-imglay-'+this.layout());this.propbar.$this.find('.zedity-icon-filters').closest('.zedity-button').toggleClass('zedity-disabled',this.$this.find('img').css('background-image')=='none');this.propbar._menuToggle('zedity-menu-img-propresize',this.proportionalResize());if(this.$this.is(':data(ui-resizable)')){this.$this.resizable('option','aspectRatio',this.proportionalResize())}this.propbar.$this.find('.zedity-menu-img-propresize').toggleClass('ui-state-disabled',this.$this.hasClass('zedity-background'));this.propbar.$this.find('.zedity-menu-imglayout-menu').toggleClass('ui-state-disabled',this.$this.find('img').css('background-image')=='none');this.propbar.$this.find('.zedity-menu-imgqual-menu').toggleClass('ui-state-disabled',this.$this.find('img').css('background-image')=='none');this.propbar._menuGroup('zedity-menu-imgqual','zedity-menu-imgqual-'+this._getQualityName());return this},_getQualityName:function(){if(this._options.quality<0.8){return'low'}else if(this._options.quality<0.9){return'normal'}else if(this._options.quality<=1){return'high'}else{return'original'}},start:function(){Zedity.Box.prototype.start.call(this);return this},stop:function(){Zedity.Box.prototype.stop.call(this);return this},duplicate:function(){Zedity.Box.prototype.duplicate.call(this);if(this.layout()=='stretch'&&this.$this.find('img')[0].style.backgroundSize=='100%')this.layout('stretch');this.editor.boxes.selected()._addReference();return this},init:function(){Zedity.Box.prototype.init.call(this);if(this.$this.hasNumberedClass('imgDataS')){this._addReference();var nc=this.$this.getNumberedClass('imgDataS');var style=this.editor.$this.children('style.'+nc);if(style){style.detach().appendTo('head')}}return this},layout:function(layout){var $img=this.$this.find('img');if(layout){$img.css({'background-position':'','background-repeat':'','background-size':''});var css='';switch(layout){case'center':css='background-position:center center;'+'background-repeat:no-repeat;'+'background-size:auto;';break;case'tile':css='background-position:left top;'+'background-repeat:repeat;'+'background-size:auto;';break;case'stretch':css='background-position:left top;'+'background-repeat:no-repeat;'+'background-size:100% 100%;';break;case'fit':css='background-position:center center;'+'background-repeat:no-repeat;'+'background-size:contain;';break;case'centerfill':css='background-position:center center;'+'background-repeat:no-repeat;'+'background-size:cover;';break}$img.attr('style',($img.attr('style')||'')+';'+css);this.editor._changed()}else{var position=$img.css('background-position')||'50% 50%';var repeat=$img.css('background-repeat')||'no-repeat';var size=$img.css('background-size')||'cover';position=$.trim(position.toLowerCase());repeat=$.trim(repeat.toLowerCase());size=$.trim(size.toLowerCase());if(position=='top left')position='0% 0%';if(position=='center middle')position='50% 50%';if(position=='50%')position='50% 50%';if(position=='left 50% top 50%')position='50% 50%';if(position=='left 0% top 0%')position='0% 0%';if(size=='100%')size='100% 100%';if(size=='auto auto')size='auto';if(/px/.test(size))size='100% 100%';if(position=='0% 0%'&&size=='auto'&&repeat=='repeat'){layout='tile'}else if(position=='50% 50%'&&size=='cover'&&repeat=='no-repeat'){layout='centerfill'}else if(position=='50% 50%'&&size=='contain'&&repeat=='no-repeat'){layout='fit'}else if(position=='50% 50%'&&size=='auto'&&repeat=='no-repeat'){layout='center'}else if(position=='0% 0%'&&size=='100% 100%'&&repeat=='no-repeat'){layout='stretch'}else{layout=''}}return layout},proportionalResize:function(value){if(this.asBackground())return false;if(this.$this.find('.zedity-empty').length>0)return false;if(value===true){this.$this.attr('data-aspectratio',1);if(!this._data.size){Zedity.core._call(this,'content',Zedity.core._call(this,'content'));setTimeout($.proxy(function(){Zedity.core._call(this,'proportionalResize',true)},this),0);return true}var wratio=this.$this.width()/this._data.size.width;var hratio=this.$this.height()/this._data.size.height;var ratio=(wratio<hratio)?wratio:hratio;var width=Math.round(this._data.size.width*ratio);var height=Math.round(this._data.size.height*ratio);this.$this.css({width:width,height:height});if(this.$this.is(':data(ui-resizable)')){this.$this.resizable('option','aspectRatio',value)}this.editor.boxes.refreshSelected();this.editor._changed()}else if(value===false){this.$this.removeAttr('data-aspectratio');this.editor.boxes.refreshSelected();this.editor._changed()}return this.$this.attr('data-aspectratio')==1},_removeUnreferencedData:function(){var list=Zedity.core.gc.getNonReferenced('imageGc');for(var i=list.length-1;i>=0;--i){$('style.'+list[i]).remove()}Zedity.core.gc.deleteReference(list);return this},_addReference:function(){if(this.$this.hasNumberedClass('imgDataS')){var nc=this.$this.getNumberedClass('imgDataS');Zedity.core.gc.addReference(nc,'imageGc');Zedity.core.gc.addReference(nc,'imageGc-'+this.id)}},_save:function(callback,options){this._removeUnreferencedData();var nc=this.$this.getNumberedClass('imgDataS');if(nc){var style=$('head style.'+nc);if(style.length>0){if(!options.finalize){style.detach().appendTo(this.$this);if(typeof(callback)=='function')callback.call(this);return this}if(['center','tile'].indexOf(this.layout())>-1){style.detach().appendTo(this.$this);if(typeof(callback)=='function')callback.call(this)}else{var box=this;var bsize={w:0,h:0};this.editor.$this.children('.zedity-box-Image.'+nc).each(function(idx,elem){bsize.w=Math.max(bsize.w,$(elem).width());bsize.h=Math.max(bsize.h,$(elem).height())});Zedity.utils.resizeImage(style.html(),{maxwidth:bsize.w,maxheight:bsize.h,aspectratio:true,quality:this._options.quality,accept:this._options.accept,onerror:function(error){box.editor._error(error)},onresizeend:function(size,data,type){Zedity.core._call(box,'content',data,size,true);box._data.fileType=type;var newnc=box.$this.getNumberedClass('imgDataS');box.editor.$this.children('.zedity-box-Image.'+nc).removeClass(nc).addClass(newnc);$('head style.'+newnc).detach().appendTo(box.$this);style.remove();Zedity.Box.prototype._save.call(box);if(typeof(callback)=='function')callback.call(this)}})}}else{Zedity.Box.prototype._save.call(this);if(typeof(callback)=='function')callback.call(this)}}else{Zedity.Box.prototype._save.call(this);if(typeof(callback)=='function')callback.call(this)}return this},destroy:function(){Zedity.Box.prototype.destroy.call(this);var ref=Zedity.core.gc.getReferenced('imageGc-'+this.id);for(var i=ref.length-1;i>=0;--i){Zedity.core.gc.removeReference(ref[i],'imageGc')}Zedity.core.gc.flushData('imageGc-'+this.id);this._removeUnreferencedData();return this}});Zedity.Box.Image.type='Image';Zedity.Box.Image.sizeLimits={minWidth:16,minHeight:16,maxWidth:null,maxHeight:null};Zedity.Box.register({type:Zedity.Box.Image.type,requires:['canvas']});Zedity.core.gc.flushData('imageGc');Zedity.core.store.delprefix('imageGc-')})(jQuery);(function($){$.fn.upload=function(method){var methods={init:function(options){var settings={autosubmit:true,name:'file',acceptmime:'',extensions:undefined,maxsize:undefined,action:'/fake.php',enctype:'multipart/form-data',onsubmit:function(file){},oncomplete:function(event,response){},onselect:function(event,file){},onerror:function(error){}};$.extend(settings,options);if(typeof(settings.extensions)=='string')settings.extensions=settings.extensions.split(' ');return this.each(function(idx,elem){var $upload=$(this);if($upload.data('upload'))return;var id=Zedity.core.genId('upload');var $iframe=$('<iframe/>',{id:id,name:id,src:'javascript:false;',css:{display:'none'}});var $form=$('<form/>',{method:'post',enctype:settings.enctype,action:settings.action,target:id});var $input=$('<input/>',{name:settings.name,type:'file',accept:settings.acceptmime,css:{position:'absolute',right:-4,margin:0,padding:0,'font-size':'480px',opacity:0}}).on('change.upload',function(event){if(typeof(settings.onselect)=='function')settings.onselect.call($upload[0],event,$input[0]);if(settings.autosubmit)$upload.upload('submit')}).appendTo($form);$upload.data('upload',{$input:$input,$form:$form,$iframe:$iframe,extensions:settings.extensions,maxsize:settings.maxsize,onsubmit:settings.onsubmit,oncomplete:settings.oncomplete,onerror:settings.onerror});var $container=$('<div>',{css:{position:'absolute',zIndex:10000,padding:0,overflow:'hidden'}}).append($form).append($iframe);$upload.add($container).on('mouseenter.upload',function(){$container.css({left:$upload.offset().left,top:$upload.offset().top,width:$upload.outerWidth(),height:$upload.outerHeight()});$input.css({cursor:$upload.css('cursor')}).attr('title',$upload.attr('title'));$upload.addClass('zedity-hover')}).on('mouseleave.upload',function(){$upload.removeClass('zedity-hover')});$upload.on('focus.upload',function(){$upload.blur();var tabbables=$(":tabbable:visible");var index=tabbables.index($upload);tabbables.eq(index+1).focus()}).on('click.upload',function(){$input.show().focus().click().hide();return false});$('body').append($container)})},validate:function(){var data=$(this).data('upload');if(data.extensions){var ext=data.$input.val().split('.').pop().toLowerCase();if(data.extensions.indexOf(ext)<0){data.onerror.call(this,{message:'File extension not valid.'});data.$input.val('');return false}}if(data.maxsize&&Zedity.core.supports.fileapi()){if(data.$input[0].files[0].size>data.maxsize){data.onerror.call(this,{message:'File too big (max size: '+Math.floor(data.maxsize/1000)+'K).'});data.$input.val('');return false}}return true},getfilename:function(){var data=$(this).data('upload');if(data.$input){return data.$input.val()}return''},clear:function(){var data=$(this).data('upload');data.$input.val('')},submit:function(){var $this=$(this);var data=$this.data('upload');if(!$this.upload('validate'))return false;if(typeof(data.onsubmit)=='function')var ret=data.onsubmit.call(this,data.$input[0]);if(ret===false){data.$input.val('');return false}data.$iframe.off('load.upload').on('load.upload',function(event){data.$input.val('');var response=$(this).contents().find('body').html();try{response=JSON.parse(response)}catch(e){response={status:'ERROR',message:'Error in reading the response from the server'}}if(typeof(data.oncomplete)=='function')data.oncomplete.call($this[0],event,response)});data.$form.submit()}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{throw new Error('Method '+method+' does not exist on jQuery.upload')}};(function(){var oldSetOption=$.ui.resizable.prototype._setOption;$.ui.resizable.prototype._setOption=function(key,value){oldSetOption.apply(this,arguments);if(key==='aspectRatio')this._aspectRatio=!!value}})();Zedity.utils=Zedity.utils||{};Zedity.utils.resizeImage=function(input,options){if(!input)throw new Error('Input not defined');if(input instanceof jQuery)input=input[0];var MAX_FILE_SIZE=10000000;options=$.extend({maxwidth:1024,maxheight:1024,aspectratio:true,quality:0.88,accept:Object.keys(Zedity.utils.fileTypes.types),onerror:null,onresizeend:null},options);if(typeof(options.onerror)!='function')options.onerror=function(event){};if(typeof(options.onresizeend)!='function')options.onresizeend=function(size,data,type){};options.aspectratio=!!options.aspectratio;function resize(){options.origwidth=options.origwidth||options.image.width;options.origheight=options.origheight||options.image.height;var origImgSize=options.image.src.length;options.ftype=options.ftype||Zedity.utils.fileTypes.parse(options.image.src.substr(0,100),options.accept);var needResize=false;var width=options.maxwidth;var height=options.maxheight;if(!options.ftype.canResize){options.onerror({type:'WARNING',message:'Image file type cannot be resized.'});options.onresizeend({width:width,height:height},options.image.src,options.ftype);return}if(options.quality>1){options.onresizeend({width:width,height:height},options.image.src,options.ftype);return}var $canvas=$('<canvas/>');var canvas=$canvas[0];var context=canvas.getContext('2d');var userQualFactor=1;var wratio=(options.maxwidth/options.origwidth)*userQualFactor;var hratio=(options.maxheight/options.origheight)*userQualFactor;if(!options.aspectratio){width=wratio>1?options.origwidth:options.maxwidth;height=hratio>1?options.origheight:options.maxheight}else{if(wratio>1||hratio>1){wratio=hratio=1}else{if(wratio>hratio)hratio=wratio;else wratio=hratio}width=Math.round(options.origwidth*wratio);height=Math.round(options.origheight*hratio)}canvas.width=width;canvas.height=height;context.drawImage(options.image,0,0,canvas.width,canvas.height);var tmp;try{tmp=canvas.toDataURL(options.ftype.mime,options.quality)}catch(e){tmp=canvas.toDataURL('image/jpeg')}if((0.95*origImgSize)>tmp.length){options.onresizeend({width:width,height:height},tmp,options.ftype)}else{width=options.origwidth;height=options.origheight;options.onresizeend({width:width,height:height},options.image.src,options.ftype)}context=null;canvas=null;$canvas=null};function loadFile(){var fr=new FileReader();options.image=new Image();options.image.src='';fr.onload=function(event){if(event.total>MAX_FILE_SIZE){event.target.abort();return}options.ftype=Zedity.utils.fileTypes.parse(event.target.result.substr(0,100),options.accept);if(options.ftype.type=='other'||options.ftype.type==''){options.onerror($.extend(event,{error:'File is not a supported image.'}));return}options.image.onload=function(event){if(options.image.width==0||options.image.height==0){options.onerror($.extend(event,{error:'File is not recognized as valid image.'}));options.image=null;return}var w=options.image.width;var h=options.image.height;options.origwidth=options.image.width;options.origheight=options.image.height;resize()};options.image.src=event.target.result.replace(/^(data:)(.*?)(base64)/,'$1'+options.ftype.mime+';$3')};fr.onerror=function(event){switch(event.target.error.code){case event.target.error.ABORT_ERR:$.extend(event,{error:'File is too big.'});break;case event.target.error.NOT_FOUND_ERR:case event.target.error.NOT_READABLE_ERR:default:$.extend(event,{error:'Error during loading of the image.'});break};options.onerror(event)};fr.readAsDataURL(input)};function loadData(){options.image=new Image();options.image.src='';options.image.onload=function(){resize()};setTimeout(function(){options.image.src=input},0)};if(typeof input=='string'||input instanceof String){var rx=/(data:.*?)["\)$]/i;input=rx.exec(input)[1];loadData()}else if(input instanceof File){loadFile()}else if(input.nodeName=='IMG'){options.image=input;resize()}};Zedity.utils.fileTypes={types:{jpeg:{type:'jpeg',mime:'image/jpeg',extensions:'jpeg jpg jpe',signature:'/9j',canResize:true},png:{type:'png',mime:'image/png',extensions:'png',signature:'iVBORw0KGgo',canResize:true},gif:{type:'gif',mime:'image/gif',extensions:'gif',signature:'R0lG',canResize:false}},parse:function(data,accept){var notfound={type:'',mime:''};accept=accept||Object.keys(this.types);try{var imgheader=/base64,(.{40})/.exec(data)[1]}catch(e){return notfound}for(var i=accept.length-1;i>=0;--i){var filetype=Zedity.utils.fileTypes.types[accept[i]];if(imgheader.substr(0,filetype.signature.length)==filetype.signature){return filetype}}return notfound}}})(jQuery);(function($){$.fn.hasNumberedClass=function(c){var classes=this.attr('class');var list=classes?classes.split(/\s+/):[];for(var i=0;i<list.length;i++){if(list[i].indexOf(c)!=-1)return true}return false};$.fn.getEmptyNumberedClass=function(c){var list=this.getNumberedClassList(c);var i=0;do{i++}while(list.indexOf(c+i)!=-1);return i};$.fn.getNumberedClass=function(c){var classes=this.attr('class');var list=classes?classes.split(/\s+/):[];for(var i=0,len=list.length;i<len;i++){if(list[i].indexOf(c)!=-1)return list[i]}return''};$.fn.getNumberedClassList=function(c,unique){var cl=[];this.each(function(idx,elem){var nc=$(elem).getNumberedClass(c);if(nc!=''&&(!unique||cl.indexOf(nc)==-1)){cl.push(nc)}});return cl};$.fn.removeNumberedClass=function(c){var numclass;return this.each(function(idx,elem){numclass=$(elem).getNumberedClass(c);if(numclass){$(elem).removeClass(numclass)}})}})(jQuery);
(function($){if(!Zedity)throw new Error('Zedity.Box.Text needs Zedity.');if(!Zedity.Box)throw new Error('Zedity.Box.Text needs Zedity.Box.');Zedity.Box.Text=function(options){this.type='Text';this._defaults={width:200,height:100,maxTextLength:300000,maxTotalTextLength:1000000,fonts:['Arial,Helvetica,sans-serif','Arial Black,Gadget,sans-serif','Arial Narrow,sans-serif','Century Gothic,sans-serif','Comic Sans MS,cursive','Copperplate Gothic Light,sans-serif','Courier New,Courier,monospace','Georgia,serif','Gill Sans,sans-serif','Impact,Charcoal,sans-serif','Lucida Console,Monaco,monospace','Lucida Sans Unicode,Lucida Grande,sans-serif','Palatino Linotype,Book Antiqua,Palatino,serif','Tahoma,Geneva,sans-serif','Times New Roman,Times,serif','Trebuchet MS,Helvetica,sans-serif','Verdana,Geneva,sans-serif'],defaultFont:0,fontSizes:['11','12','14','16','19','21','24','27','29','32','37','48','53','64'],defaultFontSize:2};Zedity.Box.prototype.constructor.call(this,options);this._options.defaultFont=this._options.defaultFont%this._options.fonts.length;this._options.defaultFontSize=this._options.defaultFontSize%this._options.fontSizes.length;this._data.textlength=0;if(this.$this.find('.zedity-content').length==0){this.$this.append('<div class="zedity-content" style="width:100%;height:100%;color:black"/>'+'<div class="zedity-empty"><p>Click <span class="zedity-icon zedity-icon-text"></span> to insert text.</p></div>');this.$this.find('.zedity-content').css({'font-size':this._options.fontSizes[this._options.defaultFontSize]+'px','line-height':Math.round(this._options.fontSizes[this._options.defaultFontSize]*1.2)+'px','font-family':this._options.fonts[this._options.defaultFont]})}};Zedity.Box.Text.prototype=Object.create(Zedity.Box.prototype);Zedity.Box.Text.prototype.constructor=Zedity.Box.Text;$.extend(Zedity.Box.Text.prototype,{createPropBar:function(options){Zedity.Box.prototype.createPropBar.call(this,$.extend(true,{minWidth:330,bars:{'0':{text:{type:'button',icon:'text',label:'Edit',title:'Edit text',order:-30,onclick:function(event,propbar){propbar.editor.boxes.selected().start()}},aligntext:{type:'menu',icon:'textalign',label:'Align',title:'Align text','class':'zedity-disabled',order:-20,menu:{left:{label:'Left',icon:'align-left',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('text-align','left');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor._changed()}},center:{label:'Center',icon:'align-center',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('text-align','center');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor._changed()}},right:{label:'Right',icon:'align-right',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('text-align','right');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor._changed()}},justify:{label:'Justify',icon:'align-justify',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('text-align','justify');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor._changed()}},sep1:{label:'--'},top:{label:'Top',icon:'align-top',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('vertical-align','top');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor.boxes.selected()._checkScrollbar();propbar.editor._changed()}},middle:{label:'Middle',icon:'align-middle',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('vertical-align','middle');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor.boxes.selected()._checkScrollbar();propbar.editor._changed()}},bottom:{label:'Bottom',icon:'align-bottom',onclick:function(event,propbar){var box=propbar.editor.boxes.selected();box.$this.find('.zedity-content').css('vertical-align','bottom');var oldflip=box.flip();box.flip('none');box.flip(oldflip);propbar.editor.boxes.selected()._checkScrollbar();propbar.editor._changed()}}}},separator:{type:'separator',order:0}},'1':{done:{type:'button',icon:'yes',label:'Done',title:'Done editing',order:10,onclick:function(event,propbar){var $box=propbar.editor.$this.children('.zedity-editing');$box.box().stop()}},font:{type:'button',icon:'font',label:'Font',title:'Change font properties',order:20,onclick:function(event,propbar){var $box=propbar.editor.$this.children('.zedity-editing');$box.find('.zedity-content').focus();$box.box()._refreshFontProperties()},panel:{'class':'zedity-font',height:160,scrollable:true,build:$.proxy(function(propbar,$panel,options){$panel.fontSelector({fonts:this._options.fonts,defaultfont:this._options.defaultFont,sizes:this._options.fontSizes,defaultsize:this._options.defaultFontSize,colorButtons:options.colorButtons,onchangefont:function(font){Zedity.core.selection.restore();Zedity.core.selection.format({'font-family':font});Zedity.core.selection.save()},onchangesize:function(size){Zedity.core.selection.restore();Zedity.core.selection.format({'font-size':size+'px','line-height':Math.round(size*1.2)+'px'});Zedity.core.selection.save()},onchangestyleB:function(event){Zedity.core.selection.restore();Zedity.core.selection.command('bold');Zedity.core.selection.save()},onchangestyleI:function(event){Zedity.core.selection.restore();Zedity.core.selection.command('italic');Zedity.core.selection.save()},onchangestyleU:function(event){Zedity.core.selection.restore();Zedity.core.selection.command('underline');Zedity.core.selection.save()},onchangestyleS:function(event){if(!Zedity.core.selection.selected())return;Zedity.core.selection.restore();var styled=null;Zedity.core.selection.format({'text-shadow':''},function(elem){var $elem=$(elem);if(styled==null){var ts=$elem.css('text-shadow')||'none';styled=(ts!='none'&&ts.indexOf('px')>-1)}$elem.add($elem.find('span')).css({'text-shadow':(!styled?'4px 4px 4px #666':'none')})});Zedity.core.selection.save()},onchangecolor:function(event,color,alpha){Zedity.core.selection.restore();Zedity.core.selection.format({color:color});Zedity.core.selection.save()}})},this)}},link:{type:'button',icon:'link',label:'Link',title:'Insert link',order:40,onclick:function(event,propbar){Zedity.core.selection.save();Zedity.core.dialog({question:'Insert link url:',default:'http://',ok:function(url){if(url){Zedity.core.selection.restore();Zedity.core.selection.command('createlink',url);Zedity.core.selection.save()}}})}}}}},options));return this},_checkScrollbar:function(){var $content=this.$this.find('.zedity-content');if(!$content)return;var oldy=$content[0].scrollTop;this.$this.addClass('zedity-calculate');this.$this.attr('style',(this.$this.attr('style')||'').replace(/display:.*?(;|$)/g,'').replace(/table-layout:.*?(;|$)/g,''));$content.attr('style',($content.attr('style')||'').replace(/display:.*?(;|$)/g,'').replace(/overflow:.*?(;|$)/g,''));if($content.height()<this.$this.height()){this.$this.attr('style',this.$this.attr('style')+';display:table;table-layout:fixed;');$content.attr('style',$content.attr('style')+';display:table-cell;overflow:hidden;')}else{$content.attr('style',$content.attr('style')+';overflow:auto;')}this.$this.removeClass('zedity-calculate');$content[0].scrollTop=oldy},_calcLength:function(onlythis){if(onlythis){this._data.textlength=this.$this.find('.zedity-content').html().length}else{var boxes=this.editor.boxes.get(this.type);var total=0;for(var i=boxes.length-1;i>0;--i){var $content=boxes[i].$this.find('.zedity-content');if($content.length>0){var len=$content.html().length;total+=len;boxes[i]._data.textlength=len}}}return true},_checkLength:function(){if(this._data.textlength>this._options.maxTextLength)return false;var boxes=this.editor.boxes.get(this.type);var total=0;for(var i=boxes.length-1;i>0;--i){total+=boxes[i]._data.textlength}if(total>this._options.maxTotalTextLength)return false;return true},_refreshFontProperties:function(){var $fsel=this.propbar.$drawer.find('.zedity-fontselector');var elem=Zedity.core.selection.getElement();if(elem){elem=$(elem);var size=elem.css('font-size')||this._options.fontSizes[this._options.defaultFontSize];var font=elem.css('font-family')||this._options.fonts[this._options.defaultFont];$fsel.fontSelector('selectfontsize',size);$fsel.fontSelector('selectfont',font);$fsel.fontSelector('selectcolor',elem.css('color')||'#000000')}else{$fsel.fontSelector('selectfontsize',this._options.fontSizes[this._options.defaultFontSize]);$fsel.fontSelector('selectfont',this._options.fonts[this._options.defaultFont]);$fsel.fontSelector('selectcolor','#000000')}var $psel=this.propbar.$drawer.find('.zedity-paragraphselector');$psel.val('');elem=Zedity.core.selection.getParagraph();if(elem){$psel.val(elem.nodeName.toLowerCase())}},_save:function(callback){var css=(this.$this.find('.zedity-content').attr('style')||'');css=css.replace(/\s+/g,' ').replace(/(;|,|:) /g,'$1').replace(/;{2,}/g,';').replace(/(^;|;$)/,'');this.$this.find('.zedity-content').attr('style',css);Zedity.Box.prototype._save.call(this);if(typeof(callback)=='function')callback.call(this);return this},select:function(){if(this.$this.hasClass('zedity-editing')||this.$this.hasClass('zedity-playing'))return this;Zedity.Box.prototype.select.call(this);if(this.$this.is(':data(ui-resizable)')){this.$this.resizable('option',{resize:$.proxy(function(){this._checkScrollbar()},this)})}this.propbar.$drawer.find('.zedity-sliderboxopacity').sliderSnap('option','value',Math.round((this.$this.css('opacity')||1)*100));var fill=this.background();this.propbar.$drawer.find('.zedity-backgroundcolor').colorPicker('selectfill',fill);this.propbar.$drawer.find('.zedity-sliderbgopacity').sliderSnap('option','value',Math.round(fill.alpha*100));this.propbar.$drawer.find('.zedity-sliderrotate').sliderSnap('value',this.rotation());this.propbar.$drawer.find('.zedity-boxer').boxer('selectsize',this.$this.css('border-top-width').replace('px','')).boxer('selectstyle',this.$this.css('border-top-style')).boxer('selectcorners',this.corners()).boxer('selectpadding',this.$this.css('padding').replace('px','')).boxer('selectcolor',this.$this.css('border-top-color')).boxer('selectalpha',Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1);this.propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('option','value',Math.round((Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1)*100));this.propbar.$this.find('.zedity-icon-textalign').closest('.zedity-button').toggleClass('zedity-disabled',this.$this.find('.zedity-empty').length>0);return this},start:function(){Zedity.Box.prototype.start.call(this);this.editor.boxes._select(null);this.editor.boxes._select(this);this.propbar.showBar(1);var $this=this.$this;var $content=this.$this.find('.zedity-content');this.revert=$this.html();if($this.data('ui-draggable'))$this.draggable('option','disabled',true);if($this.data('ui-resizable'))$this.resizable('option','disabled',true);$this.find('.zedity-empty').remove();$this.addClass('zedity-editing zedity-edited').removeClass('zedity-selected ui-state-disabled');$content.attr('contenteditable','true').focus();this._normalizeContent();Zedity.core.selection.setCursorPosition($content[0],0);this._calcLength(true);this.reposition(true);$content.focus();return this},stop:function(){if(this._data.stopping)return this;this._data.stopping=true;Zedity.Box.prototype.stop.call(this);this.propbar.showBar(0);var $this=this.$this;var $content=this.$this.find('.zedity-content');this._normalizeContent();if($this.hasClass('zedity-editing')){Zedity.core.selection.unselect();Zedity.core.selection._savedRange=null;$this.removeClass('zedity-editing');$content.removeAttr('contenteditable').blur();$content[0].normalize();if($this.data('ui-draggable'))$this.draggable('option','disabled',false);if($this.data('ui-resizable'))$this.resizable('option','disabled',false);this.select();this._checkScrollbar();this.editor._changed()}this._calcLength();if(!this._checkLength()){this.editor._error({message:'Text length overcomes the maximum limit.'})}this._data.stopping=false;return this},_normalizeContent:function(){var $content=this.$this.find('.zedity-content');$content.contents().filter(function(){return this.nodeType==3}).each($.proxy(function(idx,elem){var $elem=$(elem);var $new=$('<p/>',{html:$elem.html()||$elem.text(),css:{margin:0,color:'black','font-size':this._options.fontSizes[this._options.defaultFontSize]+'px','line-height':Math.round(this._options.fontSizes[this._options.defaultFontSize]*1.2)+'px','font-family':this._options.fonts[this._options.defaultFont]}});$elem.replaceWith($new)},this));$content.find('a:empty').remove();if($.trim($content.text())==''){$content.html('<p style="margin:0;color:black">&nbsp;</p>');$content.find('p').css({'font-size':this._options.fontSizes[this._options.defaultFontSize]+'px','line-height':Math.round(this._options.fontSizes[this._options.defaultFontSize]*1.2)+'px','font-family':this._options.fonts[this._options.defaultFont]});Zedity.core.selection.setCursorPosition($content[0],0);$content.focus()}return this},init:function(){Zedity.Box.prototype.init.call(this);var zthis=this;this.$this.off('click.zedity').on('click.zedity',function(){if(!zthis.$this.hasClass('zedity-editing'))zthis.select();Zedity.core.selection._savedRange=undefined}).off('dblclick.zedity').on('dblclick.zedity',function(){if($(this).hasClass('zedity-editing')){Zedity.core.selection.save()}else{zthis.select().start()}}).off('blur.zedity').on('blur.zedity',function(){if(Zedity.utils.opera())Zedity.core.selection.save();Zedity.core.selection.restore()}).off('mouseup.zedity').on('mouseup.zedity',function(){Zedity.core.selection.save();zthis._refreshFontProperties()}).off('keydown.zedity').on('keydown.zedity',$.proxy(function(event){if(event.keyCode==13){this._checkScrollbar()}else if(event.keyCode==32||(event.keyCode>=48&&event.keyCode<=90)){this._data.textlength++}else if(event.keyCode==8||event.keyCode==46){this._data.textlength--;this._normalizeContent();if($.trim(this.$this.find('.zedity-content').text())==''){return false}}if(!this._checkLength()){this.editor._error({message:'Text length exceeds the maximum limit.'});this._calcLength(true);return false}},this)).off('keyup.zedity').on('keyup.zedity',$.proxy(function(event){if(event.keyCode==13){var $el=$(Zedity.core.selection.getElement());if($el.closest('ol,ul').length)return;$el=$(Zedity.core.selection.getParagraph());var $prev=$el.prev();if($el.prop('tagName')!=$prev.prop('tagName')||$el.attr('style')==null){$el.css({margin:0,color:'black','font-weight':'','font-style':'','font-size':this._options.fontSizes[this._options.defaultFontSize]+'px','line-height':Math.round(this._options.fontSizes[this._options.defaultFontSize]*1.2)+'px','font-family':this._options.fonts[this._options.defaultFont]});el=Zedity.core.selection.setParagraph('p');$el=$(el);if($.trim($el.text())==''){$(el).html('&nbsp;');Zedity.core.selection.selectText(el)}}}this._refreshFontProperties()},this)).off('paste.zedity').on('paste.zedity',$.proxy(function(event){Zedity.core.selection.save();var $content=this.$this.find('.zedity-content');var old=$content.html();$content.blur();var $ta=$('<div contentEditable="true" style="width:1px;height:1px;position:absolute;overflow:hidden"></div>').appendTo('body');$ta.css({top:document.body.scrollTop+100,left:document.body.scrollLeft+10});$ta.focus();if(window.clipboardData){text=window.clipboardData.getData('text');$ta.html(text)}setTimeout($.proxy(function(){var text=$ta.text();$content.focus();Zedity.core.selection.restore();Zedity.core.selection.insertTextAtCursor(text);$ta.remove();this._calcLength(true);if(!this._checkLength()){this.editor._error({message:'Text length exceeds the maximum limit.'});$content.html(old);old=null;this._calcLength(true);Zedity.core.selection.restore();return false}this._normalizeContent();this._checkScrollbar()},this),200);if(window.clipboardData)return false},this)).off('click.zedity','a').on('click.zedity','a',function(event){return false});return this}});Zedity.Box.Text.type='Text';Zedity.Box.Text.sizeLimits={minWidth:100,minHeight:30,maxWidth:null,maxHeight:null};Zedity.Box.register({type:Zedity.Box.Text.type,requires:['selection']})})(jQuery);(function(){Zedity.utils=Zedity.utils||{};Zedity.utils.opera=function(){return/opera/i.test(navigator.userAgent)}})();
(function($){if(!Zedity)throw new Error('Zedity.Box.Video needs Zedity.');if(!Zedity.Box)throw new Error('Zedity.Box.Video needs Zedity.Box.');Zedity.Box.Video=function(options){this.type='Video';this._defaults={width:300,height:200};Zedity.Box.prototype.constructor.call(this,options);this._can.remove('background','rotate','flip','corners');if(this.$this.find('object,iframe,video').length==0){if(this.$this.find('.zedity-empty').length==0){this.$this.append('<div class="zedity-empty"><p>Click <span class="zedity-icon zedity-icon-video"></span> to insert video.</p></div>')}}else if(this.$this.find('.zedity-boxoverlay').length==0){this.$this.append('<div class="zedity-boxoverlay"/>')}};Zedity.Box.Video.prototype=Object.create(Zedity.Box.prototype);Zedity.Box.Video.prototype.constructor=Zedity.Box.Video;$.extend(Zedity.Box.Video.prototype,{createPropBar:function(options){Zedity.Box.prototype.createPropBar.call(this,$.extend(true,{bars:{'0':{video:{type:'button',icon:'video',label:'Insert',title:'Insert video',order:-20,onclick:function(event,propbar){$('.zedity-dialog-video').data('box',propbar.editor.boxes.selected()).dialog('open')}},videocontrols:{type:'toggle','class':'zedity-videocontrol',order:-10,state:[{label:'Play',icon:'play',title:'Play video'},{label:'Pause',icon:'pause',title:'Pause video'}],onclick:function(event,propbar,before,after){switch(before){case 0:propbar.editor.boxes.selected().start();break;case 1:propbar.editor.boxes.selected().stop();break}}},overlay:{type:'toggle','class':'zedity-videooverlay',order:-5,state:[{label:'Show',icon:'read',title:'Show video'},{label:'Close',icon:'read',title:'Close video'}],onclick:function(event,propbar,before,after){switch(before){case 0:propbar.editor.boxes.selected().start();break;case 1:propbar.editor.boxes.selected().stop();break}}},separator:{type:'separator',order:0},bgcolor:null,border:{panel:{build:function(propbar,$panel){$panel.boxer({order:'size,style,color',onchange:function(){var $this=$(this);propbar.editor.boxes.selected().$this.css({'border-width':$this.boxer('getsize'),'border-style':$this.boxer('getstyle'),'border-color':Zedity.utils.hash2rgba($this.boxer('getcolor'),$this.boxer('getalpha'))});propbar.$drawer.find('.zedity-sliderborderopacity').sliderSnap('value',Math.round($this.boxer('getalpha')*100));propbar.editor._changed()},onchangesize:function(size){var $box=propbar.editor.boxes.selected().$this;$box.css('border-width',size+'px')},onchangealpha:function(alpha){propbar.editor.boxes.selected().$this.css({'border-color':Zedity.utils.hash2rgba($(this).boxer('getcolor'),alpha)})}})}}},rotate:null,opacity:null,editbox:{menu:{flip:null}}}}},options));return this},_sizeLimits:function(){var sl=Zedity.Box.prototype._sizeLimits.call(this);var service=this.getService();if(!service)return sl;return{minWidth:service.sizeLimits.minWidth||sl.minWidth,maxWidth:service.sizeLimits.maxWidth||sl.maxWidth,minHeight:service.sizeLimits.minHeight||sl.minHeight,maxHeight:service.sizeLimits.maxHeight||sl.maxHeight}},_save:function(callback){Zedity.Box.prototype._save.call(this);this.$this.find('.zedity-boxoverlay').remove();if(typeof(callback)=='function')callback.call(this);return this},content:function(content){if(content!=null){if(typeof content=='string'||content instanceof String){var embed=Zedity.core.embed.parse(content,'video');if(!embed.code){this.editor._error({message:'Please provide a valid link/embed code for any of the supported video services.'});return Zedity.Box.prototype.content.call(this)}content=(embed.iframe||embed.flash)+'<div class="zedity-boxoverlay"/>';this.$this.attr('data-service',embed.service)}else if($.isArray(content)){var thumbnail='';for(var i=0,len=content.length;i<len;++i){if(['jpeg','jpg','jpe','png'].indexOf(content[i].split('.').pop())>-1){thumbnail=' poster="'+content[i]+'"';break}}var html='<video controls="controls" style="width:100%;height:100%" preload="none"'+thumbnail+'>';for(var i=0,len=content.length;i<len;++i){var ext=content[i].split('.').pop();if(['jpeg','jpg','jpe','png'].indexOf(content[i].split('.').pop())==-1){html+='<source src="'+content[i]+'" type="video/'+ext+'" />'}}html+='<p>Your browser does not support HTML5 videos.</p></video><div class="zedity-boxoverlay"/>';content=html;this.$this.attr('data-service','html5')}else{this.editor._error({message:'Could not interpret the content as video.'});return Zedity.Box.prototype.content.call(this)}}content=Zedity.Box.prototype.content.call(this,content);this._resize();this.editor.boxes.refreshSelected();return content},select:function(){if(this.$this.hasClass('zedity-editing')||this.$this.hasClass('zedity-playing'))return this;Zedity.Box.prototype.select.call(this);var service=this.getService();if(service){var canplay=!!(service.player.flash.play||service.player.iframe.play);this.propbar.$bars.find('.zedity-button.zedity-videocontrol').toggleClass('zedity-disabled',!canplay).attr('title','Video preview is not available for the "'+service.service+'" service.').trigger('toggle.propbar',[0]);this.propbar.$bars.find('.zedity-button.zedity-videooverlay').toggle(!canplay).trigger('toggle.propbar',[0])}else{this.propbar.$bars.find('.zedity-button.zedity-videocontrol').addClass('zedity-disabled').attr('title','').trigger('toggle.propbar',[0]);this.propbar.$bars.find('.zedity-button.zedity-videooverlay').hide()}this.propbar.$drawer.find('.zedity-boxer').boxer('selectsize',this.$this.css('border-top-width').replace('px','')).boxer('selectstyle',this.$this.css('border-top-style')).boxer('selectpadding',this.$this.css('padding').replace('px','')).boxer('selectcolor',this.$this.css('border-top-color')).boxer('selectalpha',Zedity.utils.rgba2alpha(this.$this.css('border-top-color'))||1);return this},rotation:function(setting){if(setting!=null){this.editor._error({message:'Video box can\'t be rotated.'})}return 0},background:function(setting){if(setting!=null){this.editor._error({message:'Video box doesn\'t support background property.'})}return{type:'solid',alpha:1,colors:['transparent']}},corners:function(setting){if(setting!=null){this.editor._error({message:'Video box doesn\'t support rounded corners.'})}return{'border-top-left-radius':0,'border-top-right-radius':0,'border-bottom-left-radius':0,'border-bottom-right-radius':0}},flip:function(setting){if(setting!=null){this.editor._error({message:'Video box doesn\'t support flipping.'})}return'none'},start:function(){Zedity.Box.prototype.start.call(this);var $obj=this.$this.find('object,iframe,video');if($obj.lenght==0)return this;var service=this.getService();if(!service)return this;if(this.$this.data('ui-draggable'))this.$this.draggable('option','disabled',true);if(this.$this.data('ui-resizable'))this.$this.resizable('option','disabled',true);this.$this.removeClass('ui-state-disabled');Zedity.core.embed.player($obj,service.service,'play');this.$this.addClass('zedity-playing').find('.zedity-boxoverlay').hide();return this},stop:function(){Zedity.Box.prototype.stop.call(this);var $obj=this.$this.find('object,iframe,video');if($obj.lenght==0)return this;var service=this.getService();if(!service)return this;if(this.$this.data('ui-draggable'))this.$this.draggable('option','disabled',false);if(this.$this.data('ui-resizable'))this.$this.resizable('option','disabled',false);Zedity.core.embed.player($obj,service.service,'pause');this.$this.removeClass('zedity-playing').find('.zedity-boxoverlay').show();return this},getService:function(){var service=this.$this.attr('data-service')||this.$this.find('object,iframe,video').attr('data-service');return Zedity.core.embed.services[service]},duplicate:function(){var newbox=Zedity.Box.prototype.duplicate.call(this);var $obj=newbox.$this.find('object,iframe,video');var service=newbox.getService();if(service){$obj.attr('id',Zedity.core.genId(service.service))}return newbox},init:function(){Zedity.Box.prototype.init.call(this);if($('.zedity-dialog-video').length==0){var $dialog=$('<div class="zedity-dialog-video">'+'<div class="tabs">'+'<ul>'+'<li><a href="#tab-video-embed">Embed</a></li>'+'<li><a href="#tab-video-files">Files</a></li>'+'</ul>'+'<div id="tab-video-embed">'+'Insert video embed code or url:<br/>'+'<textarea id="zedity-txtVideoEmbed" rows="4"></textarea>'+'<p>Supported services:<br/><span id="zedity-lblVideoServices"></span></p>'+'</div>'+'<div id="tab-video-files">'+'Select video from the list of available videos:<br/>'+'<div id="zedity-ddVideoFiles" class="zedity-button zedity-ddmenu zedity-menu" data-ddmenu="#zedity-videosel-menu" style="width:260px"><span><a href="javascript:;">--</a></span></div>'+'<ul id="zedity-videosel-menu" class="zedity-propbar-menu"></ul>'+'<img id="zedity-video-preview" src=""/>'+'</div>'+'</div>'+'</div>');$dialog.find('.tabs').tabs({activate:function(event,ui){$(this).find('.ui-tabs-panel:visible').find('input[type=text]:first,textarea:first,select:first').focus()}});this.editor.$container.append($dialog);$dialog.dialog({title:'Insert video',dialogClass:'zedity-dialog',autoOpen:false,modal:true,resizable:false,open:function(){var $this=$(this);var box=$this.data('box');var disabled=[];$('#zedity-video-preview').attr('src','').hide();$('#zedity-ddVideoFiles a').html('--');if($('#zedity-videosel-menu').data('ui-menu'))$('#zedity-videosel-menu').menu('destroy').html('');if(box._options.files){var files='<li data-value="-1"><a href="javascript:;">--</a></li>';for(var i=0,len=box._options.files.length;i<len;++i){var tn=box._options.files[i].thumbnail?'<img class="zedity-pic-preview" src="'+box._options.files[i].thumbnail+'"/>':'';files+='<li data-value="'+i+'"><a href="javascript:;">'+tn+box._options.files[i].title+'</a></li>'}$('#zedity-videosel-menu').html(files);$('#zedity-ddVideoFiles').ddmenu({onchange:function(){$('#zedity-video-preview').attr('src','').hide();var val=$(this).ddmenu('value');if(val==-1)return;if(box._options.files[val].thumbnail){$('#zedity-video-preview').attr('src',box._options.files[val].thumbnail).show()}}})}else{disabled.push(1)}var services=Zedity.core.embed.getServices('video',true);$('#zedity-lblVideoServices').html(services.join(', '));$this.find('input[type=text],textarea').val('');$this.find('.tabs').tabs('option',{active:0,disabled:disabled});$('#zedity-txtVideoEmbed').focus()},close:function(){$(this).data('box',null)},buttons:[{text:'OK',click:function(){var box=$(this).data('box');$(this).dialog('close');if(box){var content='';switch($(this).find('.tabs').tabs('option','active')){case 0:content=$('#zedity-txtVideoEmbed').val();break;case 1:var val=parseInt($('#zedity-ddVideoFiles').ddmenu('value'));if(val>-1){content=box._options.files[val].src;if(box._options.files[val].thumbnail){content.unshift(box._options.files[val].thumbnail)}}break}box.content(content)}}},{text:'Cancel',click:function(){$(this).dialog('close')}}]})}return this}});Zedity.Box.Video.type='Video';Zedity.Box.Video.sizeLimits={minWidth:220,minHeight:200,maxWidth:null,maxHeight:null};Zedity.Box.register({type:Zedity.Box.Video.type});Zedity.core.embed.add('youtube',{url:'http://www.youtube.com',type:'video',regex:[new RegExp('youtube\\.com/watch\\?.*v=(.+?)(&|"|\'|$)'),new RegExp('youtu\\.be/(.+?)(\\?|&|$)'),new RegExp('youtube(?:-nocookie|)\\.com/(?:v|embed)/(.+?)(\\?|&|"|\'|$)')],parser:function(code){return{code:code[1],flash:'//www.youtube.com/v/'+code[1]+'?rel=0&amp;loop=0&amp;autoplay=0&amp;showsearch=0&amp;showinfo=0&amp;enablejsapi=1',iframe:'//www.youtube.com/embed/'+code[1]+'?wmode=opaque;rel=0&amp;modestbranding=1&amp;showinfo=0&amp;fs=0'}},player:{flash:{play:'playVideo',pause:'pauseVideo'},iframe:{play:'playVideo',pause:'pauseVideo',command:function(frame_id,func,args){$('#'+frame_id)[0].contentWindow.postMessage(JSON.stringify({event:'command',func:func,args:args||[],id:frame_id}),'*')}}}});Zedity.core.embed.add('vimeo',{url:'http://vimeo.com',type:'video',regex:[new RegExp('vimeo\\.com/.*?clip_id=(.*?)("|\'|&|$)'),new RegExp('vimeo\\.com/.*?([^/]+?)("|\'|\\?|&|$)')],parser:function(code){return{code:code[1],flash:'//vimeo.com/moogaloop.swf?clip_id='+code[1]+'&amp;server=vimeo.com&amp;show_title=0&amp;show_byline=0&amp;show_portrait=0&amp;color=00adef&amp;fullscreen=0&amp;autoplay=0&amp;loop=0&amp;api=1',iframe:'//player.vimeo.com/video/'+code[1]+'?title=0&amp;byline=0&amp;portrait=0&amp;api=1'}},player:{flash:{play:'api_play',pause:'api_pause'},iframe:{play:'play',pause:'pause',command:function(frame_id,func,value){$('#'+frame_id)[0].contentWindow.postMessage(JSON.stringify({method:func,value:value}),'*')}}}})})(jQuery);
var ZedityPromo=ZedityPromo||{};(function($){ZedityPromo=$.extend(true,{product:'Zedity Commercial',productShort:'Commercial',message:'This is a Zedity Commercial feature.<br/>For information, please visit <a href="http://zedity.com" target="_blank">zedity.com</a>.',feature:{linkOnBox:true,boxSize:true,textParagraph:true,textLink:true,imageFilters:true,additionalMedia:true,multiboxAlignment:true,colorButtons:true,additionalBoxes:true,snapBoxes:true,alignToPage:true,globalLink:true}},ZedityPromo);var keepTooltipOpen=function(event){var $target=$(event.target);if(!$target.hasClass('zedity-promo'))$target=$target.parents('.zedity-promo');if($target.length==0)return;event.stopImmediatePropagation();var fixed=setTimeout(function(){$target.tooltip('close')},200);$('.ui-tooltip').hover(function(){clearTimeout(fixed)},function(){$target.tooltip('close')});false};(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_createPropBar=Zedity.Box.prototype.createPropBar;Zedity.Box.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{bars:{'0':{boxlink:{type:'button',icon:'link',label:'Link',title:'Add link to box',order:-10,onclick:function(event,propbar){Zedity.core.dialog({message:message})}}}}},options))}})(ZedityPromo.feature.linkOnBox);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_createPropBar=Zedity.Box.prototype.createPropBar;Zedity.Box.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{bars:{'0':{boxsize:{type:'button',title:'Box size','class':'zedity-boxsize',align:'right',order:1050,panel:{'class':'zedity-boxsize',height:120,scrollable:false,build:function(propbar,$panel){$panel.addClass('zedity-promo').append('<p>'+message+'</p>')}}}}}},options))};var old_select=Zedity.Box.prototype.select;Zedity.Box.prototype.select=function(options){old_select.apply(this,arguments);this.propbar.$this.find('.zedity-button.zedity-boxsize a').html('<span>Box</span><br/>'+'<span>Size</span>')}})(ZedityPromo.feature.boxSize);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_createPropBar=Zedity.Box.Text.prototype.createPropBar;Zedity.Box.Text.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{bars:{'1':{paragraph:{type:'button',icon:'paragraph',label:'Paragraph',title:'SEO Paragraph settings',order:30,panel:{'class':'zedity-paragraph',height:90,scrollable:false,build:function(propbar,$panel){$panel.addClass('zedity-promo').append('<p>'+message+'</p>')}}}}}},options))}})(ZedityPromo.feature.textParagraph);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_createPropBar=Zedity.Box.Text.prototype.createPropBar;Zedity.Box.Text.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{bars:{'1':{link:{onclick:function(event,propbar){Zedity.core.dialog({question:'Insert link url:',default:'http://',ok:function(url){if(url){Zedity.core.selection.restore();Zedity.core.selection.command('createlink',url);Zedity.core.selection.save()}}});$('.zedity-dialog-popup').append('<div class="zedity-promo" style="opacity:.5">'+'<input type="radio" disabled="disabled" checked="checked"/> Open link in the same tab.<br/>'+'<input type="radio" disabled="disabled"/> Open link in a new tab.'+'</div>');$('.zedity-dialog-popup .zedity-promo').attr('title',message).tooltip().on('mouseleave',keepTooltipOpen)}}}}},options))}})(ZedityPromo.feature.textLink);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_createPropBar=Zedity.Box.Image.prototype.createPropBar;Zedity.Box.Image.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{minWidth:370,bars:{'0':{filters:{type:'button',icon:'filters',label:'Filters',title:'Apply image filters',order:-10,panel:{'class':'zedity-imagefilters',height:90,scrollable:true,build:function(propbar,$panel){$panel.addClass('zedity-promo').append('<p>'+message+'</p>')}}}}}},options))}})(ZedityPromo.feature.imageFilters);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;$(document).on('dialogopen','.zedity-dialog-audio',function(event,ui){var $this=$(this);if($this.find('.zedity-promo').length==0){$this.find('#tab-audio-embed').append('<p>Additional audio services: <span class="zedity-tooltip zedity-promo">?</span></p>')}$this.find('.zedity-promo').attr('title','Supported in '+ZedityPromo.product+':<br/>vocaroo, myspace_music, shoutcast, bandcamp<br/>'+message).tooltip().on('mouseleave',keepTooltipOpen)});$(document).on('dialogopen','.zedity-dialog-video',function(event,ui){var $this=$(this);if($this.find('.zedity-promo').length==0){$this.find('#tab-video-embed').append('<p>Additional video services: <span class="zedity-tooltip zedity-promo">?</span></p>')}$this.find('.zedity-promo').attr('title','Supported in '+ZedityPromo.product+':<br/>dailymotion, metacafe, justintv, ustream, myspace_video, veoh, metatube, vine, snotr, bliptv, 5min, tunepk, coub<br/>'+message).tooltip().on('mouseleave',keepTooltipOpen)})})(ZedityPromo.feature.additionalMedia);(function(feature){if(!feature)return;var old_constructor=Zedity.ContextMenu;var old_prototype=Zedity.ContextMenu.prototype;var old_map=[];for(var i in Zedity.ContextMenu){if(Zedity.ContextMenu.hasOwnProperty(i))old_map[i]=Zedity.ContextMenu[i]}Zedity.ContextMenu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.append('<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-left"></span> Align left <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-center"></span> Align center <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-right"></span> Align right <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-top"></span> Align top <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-middle"></span> Align middle <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="zedity-menu-AlignBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-align-box-bottom"></span> Align bottom <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};Zedity.ContextMenu.prototype=old_prototype;for(var i in old_map){if(old_map.hasOwnProperty(i))Zedity.ContextMenu[i]=old_map[i]}})(ZedityPromo.feature.multiboxAlignment);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;$(document).on('click.zedity','.zedity-propbar .zedity-button',function(event,ui){var $cp=$(this).closest('.zedity-propbar').find('.zedity-colorpicker');if($cp.find('.zedity-colorbuttons').length==0){$cp.find('.zedity-coloralpha').after('<div class="zedity-colorbuttons">'+'<span class="zedity-label">Current color: </span>'+'<span class="zedity-colorbtnhex-promo zedity-button zedity-promo"><a href="javascript:;">#000000</a></span>'+'<span class="zedity-colorbtnrgb-promo zedity-button zedity-promo"><a href="javascript:;">rgb(0,0,0)</a></span>'+'</div>');$cp.find('.zedity-colorbtnhex-promo,.zedity-colorbtnrgb-promo').attr('title',message).tooltip({show:{delay:200}})}})})(ZedityPromo.feature.colorButtons);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_constructor=Zedity.Menu;var old_prototype=Zedity.Menu.prototype;var old_map=[];for(var i in Zedity.Menu){if(Zedity.Menu.hasOwnProperty(i))old_map[i]=Zedity.Menu[i]}switch(Zedity.Menu.type){case'bar':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.ui-menubar:nth-child(3) ul').append('<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-document"></span> Document <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-html"></span> Html <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity({position:{my:'left top',at:'left bottom'}})};break;case'popup':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.children('li:nth-child(3)').find('ul').append('<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-document"></span> Document <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-html"></span> Html <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};break;case'accordion':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.find('.zedity-subacc').accordion('destroy');this.$this.accordion('destroy');this.$this.find('.zedity-accpanel').eq(2).append('<a class="ui-state-disabled" href="javascript:;"><span class="zedity-menu-icon zedity-icon-document"></span> Document <small style="color:blue">('+ZedityPromo.productShort+')</small></a>'+'<a class="ui-state-disabled" href="javascript:;"><span class="zedity-menu-icon zedity-icon-html"></span> Html <small style="color:blue">('+ZedityPromo.productShort+')</small></a>');this.$this.accordion({heightStyle:'content'});this.$this.find('.zedity-subacc').accordion({active:false,collapsible:true,heightStyle:'content'})};break}Zedity.Menu.prototype=old_prototype;for(var i in old_map){if(old_map.hasOwnProperty(i))Zedity.Menu[i]=old_map[i]}})(ZedityPromo.feature.additionalBoxes);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_constructor=Zedity.Menu;var old_prototype=Zedity.Menu.prototype;var old_map=[];for(var i in Zedity.Menu){if(Zedity.Menu.hasOwnProperty(i))old_map[i]=Zedity.Menu[i]}switch(Zedity.Menu.type){case'bar':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.ui-menubar:nth-child(2) ul').append('<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Snap boxes to</a>'+'<ul>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Page <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Boxes <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'</ul>'+'</li>');this.$this.menuZedity({position:{my:'left top',at:'left bottom'}})};break;case'popup':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.find('li:nth-child(2) ul').append('<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Snap boxes to</a>'+'<ul>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Page <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Boxes <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>'+'</ul>'+'</li>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};break;case'accordion':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.find('.zedity-subacc').accordion('destroy');this.$this.accordion('destroy');this.$this.children('.zedity-accpanel').eq(1).append('<div class="zedity-subacc">'+'<h4 class="zedity-menu-SnapMain">Snap boxes to</h4>'+'<div class="zedity-accpanel">'+'<a class="ui-state-disabled" href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Page <small style="color:blue">('+ZedityPromo.productShort+')</small></a>'+'<a class="ui-state-disabled" href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Boxes <small style="color:blue">('+ZedityPromo.productShort+')</small></a>'+'</div>'+'</div>');this.$this.accordion({heightStyle:'content'});this.$this.find('.zedity-subacc').accordion({active:false,collapsible:true,heightStyle:'content'})};break}Zedity.Menu.prototype=old_prototype;for(var i in old_map){if(old_map.hasOwnProperty(i))Zedity.Menu[i]=old_map[i]}})(ZedityPromo.feature.snapBoxes);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_constructor1=Zedity.Menu;var old_prototype1=Zedity.Menu.prototype;var old_map1=[];for(var i in Zedity.Menu){if(Zedity.Menu.hasOwnProperty(i))old_map1[i]=Zedity.Menu[i]}switch(Zedity.Menu.type){case'bar':Zedity.Menu=function(options){old_constructor1.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.zedity-menu-SelArrangeMain').after('<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Align to page <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity({position:{my:'left top',at:'left bottom'}})};break;case'popup':Zedity.Menu=function(options){old_constructor1.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.zedity-menu-SelArrangeMain').after('<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Align to page <small style="color:blue">('+ZedityPromo.productShort+')</small></a>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};break;case'accordion':Zedity.Menu=function(options){old_constructor1.call(this,options);this.$this.find('.zedity-subacc').accordion('destroy');this.$this.accordion('destroy');this.$this.find('.zedity-menu-SelFlipMain').before('<h4>Align to page</h4>'+'<div class="zedity-accpanel">'+message+'</div>');this.$this.accordion({heightStyle:'content'});this.$this.find('.zedity-subacc').accordion({active:false,collapsible:true,heightStyle:'content'})};break}Zedity.Menu.prototype=old_prototype1;for(var i in old_map1){if(old_map1.hasOwnProperty(i))Zedity.Menu[i]=old_map1[i]}var old_createPropBar=Zedity.Box.prototype.createPropBar;Zedity.Box.prototype.createPropBar=function(options){old_createPropBar.call(this,$.extend(true,{bars:{'0':{editbox:{menu:{align:{label:'Align to page <small style="color:blue">('+ZedityPromo.productShort+')</small>',class:'ui-state-disabled',order:15}}}}}},options))};var old_constructor2=Zedity.ContextMenu;var old_prototype2=Zedity.ContextMenu.prototype;var old_map2=[];for(var i in Zedity.ContextMenu){if(Zedity.ContextMenu.hasOwnProperty(i))old_map2[i]=Zedity.ContextMenu[i]}Zedity.ContextMenu=function(options){old_constructor2.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.zedity-menu-SelArrangeMain').after('<li class="zedity-menu-EditBox ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-none"></span> Align to page <small style="color:blue">('+ZedityPromo.productShort+')</small></a>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};Zedity.ContextMenu.prototype=old_prototype2;for(var i in old_map2){if(old_map2.hasOwnProperty(i))Zedity.ContextMenu[i]=old_map2[i]}})(ZedityPromo.feature.alignToPage);(function(feature){if(!feature)return;var message=feature===true?ZedityPromo.message:feature;var old_constructor=Zedity.Menu;var old_prototype=Zedity.Menu.prototype;var old_map=[];for(var i in Zedity.Menu){if(Zedity.Menu.hasOwnProperty(i))old_map[i]=Zedity.Menu[i]}switch(Zedity.Menu.type){case'bar':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.zedity-menu-PageSize').eq(1).after('<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-link"></span> Content link <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity({position:{my:'left top',at:'left bottom'}})};break;case'popup':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.menuZedity('destroy');this.$this.find('.zedity-menu-PageSize').eq(1).after('<li class="ui-state-disabled zedity-separator"><a href="javascript:;"></a></li>'+'<li class="ui-state-disabled"><a href="javascript:;"><span class="zedity-menu-icon zedity-icon-link"></span> Content link <small style="color:blue">('+ZedityPromo.productShort+')</small></a></li>');this.$this.menuZedity().hide().menuZedity('option',{position:{my:'left top',at:'right top'}})};break;case'accordion':Zedity.Menu=function(options){old_constructor.call(this,options);this.$this.find('.zedity-subacc').accordion('destroy');this.$this.accordion('destroy');this.$this.find('.zedity-menu-PageSize').eq(1).after('<a class="ui-state-disabled" href="javascript:;"><span class="zedity-menu-icon zedity-icon-link"></span> Content link <small style="color:blue">('+ZedityPromo.productShort+')</small></a>');this.$this.accordion({heightStyle:'content'});this.$this.find('.zedity-subacc').accordion({active:false,collapsible:true,heightStyle:'content'})};break}Zedity.Menu.prototype=old_prototype;for(var i in old_map){if(old_map.hasOwnProperty(i))Zedity.Menu[i]=old_map[i]}})(ZedityPromo.feature.globalLink)})(jQuery);
